<?xml version="1.0" encoding="EUC-JP" ?>
<?bml bml-version="100.0" ?>

<bml>
<head>
<title>Caption Test</title>
<style><![CDATA[
	
	.button {width:140px;height:32px;}
	p:focus {background-color-index:82;}
	p.button {text-align:center;color-index:0;line-height:30px;}
	#display	{color-index:3;text-align:left;padding-top:5px;padding-left:5px;padding-right:5px;padding-bottom:5px;font-size:24px;
		top:30px;height:26px;width:700px;}
]]></style>


<script><![CDATA[

var cnt = 0;
var CounterID = NaN;
var tArr = Array();
var lNum= Number();
var fSize;
var vHost = '175.41.244.154';
var pHost = '175.41.243.162'; 
/* sns.astem-co.co.jp */
var eventID;
 var sLines;
         
         
       /* var gline = document.getElementById("display");*/
 var obj = document.getElementById("display");
/* fSize =36;*/

        /*var gBcolor =;*/
           
            /* sns.astem-co.co.jp/eucconvert.php?PJ_LimeDemo"*/
    var url ="http://"+pHost+"/eucconvert.php?PJ_LimeDemo";
	var url1 = "http://sns.astem-co.co.jp/test2.php";
	var url2 = "http://"+ vHost+ "/AtNet/DpTxt/Refresh5?id=PJ_LimeDemo&lines=3";
	
	var url3 = "http://"+ pHost +"/eucconvert.php?id=ZT1_LIME_TEST&lines=50";
	var url4 = "http://"+ pHost +"/eucconvert2.php";

/*?id=ZT1_LIME_TEST&lines=1000&lastMsgNo=0&ofsStTime=0*/

/*var ret = browser.transmitTextDataOverIP(url2,"","EUC-JP");*/



function alert(str){

	obj.firstChild.data = str+"\r\n" ;
}


function startCounter(){
	if(!isNaN(CounterID)){	browser.clearTimer(CounterID);} else {	
	CounterID = browser.setInterval("changeText();", 2000, 0);
	}
}

function changeText(){ 

fSize=parseInt(obj.normalStyle.fontSize);
 var lineLen = fSize * 15;
	var ret = browser.transmitTextDataOverIP(url4,"id=ZT1_LIME_TEST&startTime="+ 2000*cnt + "&timeSpan=2000","EUC-JP");

var msg =ret[2];
		var txt = ret[2];
		
	tArr= txt.split('\n');
	tPos = txt.indexOf('\n');
	tTailLen= txt.length - tPos;
    lNum = tArr.length;
	
	
if(tPos >0){
   if(tTailLen>tPos){tLen=tTailLen * fSize;}else{tLen=tPos *fSize;}
}

	/*
var tLen = abs(ret[2].length -tPos) * fSize;

*/
/*
if(tArr[1]>0){
	if (tArr[1].length>tArr[2].length){ tLen= tArr[1].length * fSize;}    else{tLen=tArr[2].length * fSize;}
	} else if (tArr[1]) {tLen = tArr[1].length * fSize;}
else {tLen=tPos*fSize;}	*/ 

	
	if( ret[0] == 1 ){
	/*	alert( cnt +" :  " + ret[2] );*/
	alert(""+ msg);
	
	  obj.normalStyle.backgroundColorIndex = 80;
        obj.normalStyle.width= tLen +10;

	    if (lNum<3){
      
         obj.normalStyle.left = (960 - tLen)/2;    
         obj.normalStyle.height=fSize+10;
        }else {  
         obj.normalStyle.left = (960- tLen/2)/2; 
                obj.normalStyle.height=fSize*2+10;}
       
 if (ret[2].length < 1) {
     obj.normalStyle.backgroundColorIndex = 8;
             	
}	}else{
		alert("Transmission failed"+cnt);
	}
	
	
	
cnt++;

}

function handler(){
	var evt = document.currentEvent;
	var kcode =evt.keyCode;
	
	if (kcode == 19){goback();}
	
}
function goback(){ browser.launchDocument("../startup.xml", "cut");	}



function chgSmall(){ obj.normalStyle.fontSize=24;}

function chgMedium(){obj.normalStyle.fontSize=30;}
function chgLarge(){ obj.normalStyle.fontSize=36;}

function abs(a){
 if (a<0){
v= a * -1;}else { v = a;}

return v;
}

]]></script>

</head>
<body onload="startCounter();" style="background-color-index:7;">

	<div style="top:0px;left:0px;width:960px;height:540px;visibility:visible;">
		<object id="vod" type="application/X-arib-contentPlayControl" data="http://hls.okimediaserver.com/pcs/resolvecontent?contents_path=/moviebox/ntt-ev/h264-sd-tts/Docu-white-J_out.mp4&protocol=http_tts" streamstatus="play" style="top:0px;left:0px;width:960px;height:540px;" />
	</div>
	
<!--  -->
<!--
		<p id="p01" class="button" style="top:10px;left:790px;color-index:0;background-color-index:1;font-size:24px;width:160px;nav-index:0;nav-up:1;nav-down:1;" accessKey="R" onclick="startCounter();">Start Caption</p>

		<p id="p02" class="button"  style="top:50;left:0;nav-index:1;nav-up:0;nav-down:0" onclick="changeText();">Button2</p>

-->

<p id="display" style="top:400px;left:130px;"><![CDATA[]]></p>




<p style="top:0px;left:0px;height:1px;width:1px;background-color-index:8;nav-index:0;" onkeydown="handler();" onkeyup="handler();" onclick="handler();"><![CDATA[]]></p>
 

 <p class="button" style="top:10px;left:10px;height:36px;width:64px;color-index:1;font-size:24pt;" accesskey="R" onclick="chgSmall();">S</p>

<p class="button" style="top:10px;left:74px;height:36px;width:64px;color-index:2;font-size:24pt;" accesskey="G" onclick="chgMedium();">M</p>

<p class="button" style="top:10px;left:138px;height:36px;width:64px;color-index:3;font-size:24pt;" accesskey="Y" onclick="chgLarge();">L</p>


 
</body>
</bml>
