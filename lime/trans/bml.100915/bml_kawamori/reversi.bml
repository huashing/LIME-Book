<?xml version="1.0" encoding="EUC-JP" ?>
<!DOCTYPE bml PUBLIC "-//ARIB STD-B24:1999//DTD BML Document for IPTV//JA" "http://www.arib.or.jp/B24/DTD/bml_x_x_iptv.dtd">
<?bml bml-version="100.0" ?>
<!--

-->

<bml>
<head>
<title>Reversi</title>
<style><![CDATA[

p {width:50px;
	height:50px;
	border-style:solid;
	border-width:1px;
	border-top-color-index:7;
	border-left-color-index:7;
	border-bottom-color-index:7;
	border-right-color-index:7}
	
p:focus { 	border-style:solid;
	border-width:1px;
	border-top-color-index:0;
	border-left-color-index:0;
	border-bottom-color-index:0;
	border-right-color-index:0; }
	
p.no 	{color-index:21;}
p.bl {color-index:0;}
p.wh {color-index:7;}
p.cell	{width:50px;height:50px;background-color-index:18;}

#display	{ font-size:20px;background-color-index:16;color-index:7;top:30px;left:330px;width:600px;height:480px;}


#alert	{ font-size:20px;background-color-index:12;color-index:7;top:130px;left:330px;width:380px;height:280px;}

]]>
</style>


<script><![CDATA[

function goback(){ browser.launchDocument("top.xml", "cut");	}

function print(str,display){
	var obj = document.getElementById(display);
	obj.firstChild.data += str + "\r\n";
}



//variables
flag = true;
player = 1;
pnlnum = new Array(4, 2, 2);
//pnlcol = new Array('green', 'black', 'white');
pnlcol = new Array(2, 0, 7);

//set arra¾õÂÖÊÝ»ýÇÛÎóÊÑ¿ôÀßÄê
// 0 => Ìµ¤·, 1 => ¹õ, -1 => Çò
// 2=> Çò¡©
stat = new Array(7);
for (i = 0; i <= 7; i++) {
	stat[i] = new Array(0, 0, 0, 0, 0, 0, 0, 0);
}
stat[3][3] = 1;
stat[3][4] = 2;
stat[4][3] = 2;
stat[4][4] = 1;




function Revert(){

	var target = document.currentEvent.target;
	var tid =target.id;
	var loc = tid.substring(1,3);
	var left = loc.substring(0,1);
	var right = loc.substring(1,2);


rev(parseInt(left,10),parseInt(right,10));


}

//functions to be run on Click 
function rev(X, Y)
{


	if (!flag || stat[X][Y] != 0) {return; }
	flag = false;


	num = revnum(X, Y, true);
	if (num == 0) {
		flag = true;
		return;
	}

	stat[X][Y] = player;
	

	document.getElementById("p"+X+Y).normalStyle.colorIndex = pnlcol[player];

	pnlnum[0]++;
	pnlnum[player] += 1 + num;
	pnlnum[(player == 1) ? 2 : 1] -= num;

	if (pnlnum[0] >= 64 || pnlnum[1] <= 0 || pnlnum[2] <= 0) {
		winner = (pnlnum[1] > pnlnum[2]) ? 'Black!' : 'White!';
		if (pnlnum[1] == pnlnum[2]) { winner = 'Draw'; }
		print('Black has taken ' + pnlnum[1] + ' pieces\nWhite has taken ' + pnlnum[2] + ' pieces;\nAnd the winner is ' + winner,"alert");
		return;
	}

	player = (player == 1) ? 2 : 1;
	if (pass()) {
		player = (player == 1) ? 2 : 1;

		if (pass()) {
		print('Neither Black nor White have no more moves to make; the end of Game',"alert");

			winner = (pnlnum[1] > pnlnum[2]) ? 'Black!' : 'White!';
			if (pnlnum[1] == pnlnum[2]) { winner = 'Draw'; }
		print('Black has taken ' + pnlnum[1] + ' pieces\nWhite has taken ' + pnlnum[2] + ' pieces\nAnd the winner is ' + winner,"alert");
			return;
		}

		print(((player == 1) ? 'White' : 'Black') + ' has no valid move to make, and play passes',"alert");
	}

	document.getElementById("navi").innerHTML = (player == 1) ? 'Black' : 'White';
	document.getElementById("navi").normalStyle.colorIndex = pnlcol[player];

	if (player == 2) { complay(); }
	flag = true;
	
}

//È¿Å¾¿ô¼èÆÀ¡¢µÚ¤ÓÈ¿Å¾½èÍý
function revnum(cx, cy, revflag)
{

	num = 0;

	num += pnlrev(cx, cy,  0, -1, revflag);
	num += pnlrev(cx, cy,  1, -1, revflag);
	num += pnlrev(cx, cy,  1,  0, revflag);
	num += pnlrev(cx, cy,  1,  1, revflag);
	num += pnlrev(cx, cy,  0,  1, revflag);
	num += pnlrev(cx, cy, -1,  1, revflag);
	num += pnlrev(cx, cy, -1,  0, revflag);
	num += pnlrev(cx, cy, -1, -1, revflag);


	return num;
}

//¥Ñ¥Í¥ëÈ¿Å¾
function pnlrev(x, y, sx, sy, revflag)
{

	n = 0;

	while (1) {
		x += sx; y += sy;

	if (x < 0 || 7 < x || y < 0 || 7 < y || stat[x][y] == 0) { return 0; }
	
	
		if (stat[x][y] == player) {
			if (n == 0) { return 0; }
			if (revflag) { 
				for (i = 1; i <= n; i++) {
					x -= sx; y -= sy;
					stat[x][y] = player;
						document.getElementById("p"+x+y).normalStyle.colorIndex = pnlcol[player];
					
				}
			}
			return n;
		}

		n++;
	}
}

//¥Ñ¥¹È½Äê
function pass()
{
	for (i = 0; i <= 7; i++) {
		for (j = 0; j <= 7; j++) {
			if (stat[i][j] == 0) {
				if (revnum(i, j, false) > 0) { return false; }
			}
		}
	}

	return true;
}

//¥³¥ó¥Ô¥å¡¼¥¿»þ´Ö²Ô¤®
function complay()
{

//print("I am complay","display");
	// 0.5 ¡Á 1.5 ÉÃ
	//	setTimeout("comgo()", 500 + Math.floor(Math.random() * 1000));
		setTimeout("comgo()", 500 + browser.random(1000));
		
}


function setTimeout(code,interval){
browser.setInterval(code,interval,1);

}

//¥³¥ó¥Ô¥å¡¼¥¿¥×¥ì¥¤
function comgo()
{
	getnum = 0;
	getX = new Array();
	getY = new Array();
	XYnum = 0;


	if (stat[0][0] == 0 && revnum(0, 0, false) > getnum) {
		getnum = revnum(0, 0, false);
		getX[0] = 0; getY[0] = 0;
		XYnum = 1;
	}
	if (stat[7][0] == 0 && revnum(7, 0, false) > getnum) {
		getnum = revnum(7, 0, false);
		getX[0] = 7; getY[0] = 0;
		XYnum = 1;
	}
	if (stat[0][7] == 0 && revnum(0, 7, false) > getnum) {
		getnum = revnum(0, 7, false);
		getX[0] = 0; getY[0] = 7;
		XYnum = 1;
	}
	if (stat[7][7] == 0 && revnum(7, 7, false) > getnum) {
		getnum = revnum(7, 7, false);
		getX[0] = 7; getY[0] = 7;
		XYnum = 1;
	}

	if (getnum == 0) {
		for (i = 0; i <= 7; i++) {
			for (j = 0; j <= 7; j++) {
				if (stat[i][j] == 0) {
					if (revnum(i, j, false) > getnum) {
						getnum = revnum(i, j, false);
						getX = new Array(); getX[0] = i;
						getY = new Array(); getY[0] = j;
						XYnum = 1;
					}
					else if (revnum(i, j, false) == getnum) {
						getX[XYnum] = i;
						getY[XYnum] = j;
						XYnum++;
					}
				}
			}
		}
	}

//print("XYnum "+ XYnum,"display");

	//setnum = Math.floor(Math.random() * XYnum);
	//	setnum = browser.random(XYnum);
	setnum = XYnum-1;
//		print("I am comgo 3 "+ setnum,"display");
	flag = true;
//	print(X,"display");

//print("getX[setnum]"+getX,"display");
	rev(getX[setnum], getY[setnum]);
	
//	print("getX[setnum]"+getX[setnum],"display");
//	print("I am comgo out","display");
}


]]></script>

</head>

<body style="background-color-index:7;">
<!-- <div style="left:10px;top:10px;width:760px;height:400px;background-color-index:2;">-->

<p  style="width:760px;height:100px;color-index:0">Reversi
</p>


<div style="left:420px;top:80px;width:400px;height:400px;background-color-index:21;">
	

<p onclick="Revert();" id="p00" class="no" style="left:0px;top:0px;nav-index: 0; nav-down: 10; nav-up:0;nav-right: 1;nav-left:0;"><![CDATA[¡ü]]></p>	
<p onclick="Revert();" id="p10" class="no" style="left:0px;top:50px;nav-index:10; nav-down: 20; nav-up:0; nav-right: 11;nav-left:10;" ><a href="javascript:Revert();">¡ü</a></p>
<p onclick="Revert();" id="p20" class="no" style="left:0px;top:100px;nav-index:20; nav-down: 30; nav-up:10; nav-right: 21;nav-left:20;">¡ü</p>
<p onclick="Revert();" id="p30" class="no" style="left:0px;top:150px;nav-index:30; nav-down: 40; nav-up:20; nav-right: 31;nav-left:30;">¡ü</p>
<p onclick="Revert();" id="p40" class="no" style="left:0px;top:200px;nav-index:40; nav-down: 50; nav-up:30; nav-right: 41;nav-left:40;">¡ü</p>
<p onclick="Revert();" id="p50" class="no" style="left:0px;top:250px;nav-index:50; nav-down: 60; nav-up:40; nav-right: 51;nav-left:50;">¡ü</p>
<p onclick="Revert();" id="p60" class="no" style="left:0px;top:300px;nav-index:60; nav-down: 70; nav-up:50; nav-right: 61;nav-left:60;">¡ü</p>
<p onclick="Revert();" id="p70" class="no" style="left:0px;top:350px;nav-index:70; nav-down: 70; nav-up:60; nav-right: 71;nav-left:70;">¡ü</p>

<p onclick="Revert();" id="p01" class="no" style="left:50px;top:0px;nav-index:1; nav-down:11; nav-up:1; nav-right:2;nav-left:0;">¡ü</p>
<p onclick="Revert();" id="p11" class="no" style="left:50px;top:50px;nav-index:11; nav-down:21; nav-up:1; nav-right:12;nav-left:10;">¡ü</p>
<p onclick="Revert();" id="p21" class="no" style="left:50px;top:100px;nav-index:21; nav-down:31; nav-up:11; nav-right:22;nav-left:20;">¡ü</p>
<p onclick="Revert();" id="p31" class="no" style="left:50px;top:150px;nav-index:31; nav-down:41; nav-up:21; nav-right:32;nav-left:30;">¡ü</p>
<p onclick="Revert();" id="p41" class="no" style="left:50px;top:200px;nav-index:41; nav-down:51; nav-up:31; nav-right:42;nav-left:40;">¡ü</p>
<p onclick="Revert();" id="p51" class="no" style="left:50px;top:250px;nav-index:51; nav-down:61; nav-up:41; nav-right:52;nav-left:50;">¡ü</p>
<p onclick="Revert();" id="p61" class="no" style="left:50px;top:300px;nav-index:61; nav-down:71; nav-up:51; nav-right:62;nav-left:60;">¡ü</p>
<p onclick="Revert();" id="p71" class="no" style="left:50px;top:350px;nav-index:71; nav-down:71; nav-up:61; nav-right:72;nav-left:70;">¡ü</p>



<p onclick="Revert();" id="p02" class="no" style="left:100px;top:0px;nav-index:2; nav-down:12; nav-up:2; nav-right:3;nav-left:1;">¡ü</p>
<p onclick="Revert();" id="p12" class="no" style="left:100px;top:50px;nav-index:12; nav-down:22; nav-up:2; nav-right:13;nav-left:11;">¡ü</p>
<p onclick="Revert();" id="p22" class="no" style="left:100px;top:100px;nav-index:22; nav-down:32; nav-up:12; nav-right:23;nav-left:21;">¡ü</p>
<p onclick="Revert();" id="p32" class="no" style="left:100px;top:150px;nav-index:32; nav-down:42; nav-up:22; nav-right:33;nav-left:31;">¡ü</p>
<p onclick="Revert();" id="p42" class="no" style="left:100px;top:200px;nav-index:42; nav-down:52; nav-up:32; nav-right:43;nav-left:41;">¡ü</p>
<p onclick="Revert();" id="p52" class="no" style="left:100px;top:250px;nav-index:52; nav-down:62; nav-up:42; nav-right:53;nav-left:51;">¡ü</p>
<p onclick="Revert();" id="p62" class="no" style="left:100px;top:300px;nav-index:62; nav-down:72; nav-up:52; nav-right:63;nav-left:61;">¡ü</p>
<p onclick="Revert();" id="p72" class="no" style="left:100px;top:350px;nav-index:72; nav-down:72; nav-up:62; nav-right:73;nav-left:71;">¡ü</p>



<p onclick="Revert();" id="p03" class="no" style="left:150px;top:0px;nav-index:3; nav-down:13; nav-up:3; nav-right:4;nav-left:2;">¡ü</p>
<p onclick="Revert();" id="p13" class="no" style="left:150px;top:50px;nav-index:13; nav-down:23; nav-up:3; nav-right:14;nav-left:12;">¡ü</p>
<p onclick="Revert();" id="p23" class="no" style="left:150px;top:100px;nav-index:23; nav-down:33; nav-up:13; nav-right:24;nav-left:22;">¡ü</p>
<p onclick="Revert();" id="p33" class="bl" style="left:150px;top:150px;nav-index:33; nav-down:43; nav-up:23; nav-right:34;nav-left:32;">¡ü</p>
<p onclick="Revert();" id="p43" class="wh" style="left:150px;top:200px;nav-index:43; nav-down:53; nav-up:33; nav-right:44;nav-left:42;">¡ü</p>
<p onclick="Revert();" id="p53" class="no" style="left:150px;top:250px;nav-index:53; nav-down:63; nav-up:43; nav-right:54;nav-left:52;">¡ü</p>
<p onclick="Revert();" id="p63" class="no" style="left:150px;top:300px;nav-index:63; nav-down:73; nav-up:53; nav-right:64;nav-left:62;">¡ü</p>
<p onclick="Revert();" id="p73" class="no" style="left:150px;top:350px;nav-index:73; nav-down:73; nav-up:63; nav-right:74;nav-left:72;">¡ü</p>



<p onclick="Revert();" id="p04" class="no"  style="left:200px;top:0px;nav-index:4; nav-down:14; nav-up:4; nav-right:5;nav-left:3;">¡ü</p>
<p onclick="Revert();" id="p14" class="no" style="left:200px;top:50px;nav-index:14; nav-down:24; nav-up:4; nav-right:15;nav-left:13;">¡ü</p>
<p onclick="Revert();" id="p24" class="no" style="left:200px;top:100px;nav-index:24; nav-down:34; nav-up:14; nav-right:25;nav-left:23;">¡ü</p>
<p onclick="Revert();" id="p34" class="wh" style="left:200px;top:150px;nav-index:34; nav-down:44; nav-up:24; nav-right:35;nav-left:33;">¡ü</p>
<p onclick="Revert();" id="p44" class="bl" style="left:200px;top:200px;nav-index:44; nav-down:54; nav-up:34; nav-right:45;nav-left:43;">¡ü</p>
<p onclick="Revert();" id="p54" class="no" style="left:200px;top:250px;nav-index:54; nav-down:64; nav-up:44; nav-right:55;nav-left:53;">¡ü</p>
<p onclick="Revert();" id="p64" class="no" style="left:200px;top:300px;nav-index:64; nav-down:74; nav-up:54; nav-right:65;nav-left:63;">¡ü</p>
<p onclick="Revert();" id="p74" class="no" style="left:200px;top:350px;nav-index:74; nav-down:74; nav-up:64; nav-right:75;nav-left:73;">¡ü</p>

                                                      


<p onclick="Revert();" id="p05" class="no" style="left:250px;top:0px;nav-index:5; nav-down:15; nav-up:5; nav-right:6; nav-left:4;">¡ü</p>
<p onclick="Revert();" id="p15" class="no" style="left:250px;top:50px;nav-index:15; nav-down:25; nav-up:5; nav-right:16;nav-left:14;">¡ü</p>
<p onclick="Revert();" id="p25" class="no" style="left:250px;top:100px;nav-index:25; nav-down:35; nav-up:15; nav-right:26;nav-left:24;">¡ü</p>
<p onclick="Revert();" id="p35" class="no" style="left:250px;top:150px;nav-index:35; nav-down:45; nav-up:25; nav-right:36;nav-left:34;">¡ü</p>
<p onclick="Revert();" id="p45" class="no" style="left:250px;top:200px;nav-index:45; nav-down:55; nav-up:35; nav-right:46;nav-left:44;">¡ü</p>
<p onclick="Revert();" id="p55" class="no" style="left:250px;top:250px;nav-index:55; nav-down:65; nav-up:45; nav-right:56;nav-left:54;">¡ü</p>
<p onclick="Revert();" id="p65" class="no" style="left:250px;top:300px;nav-index:65; nav-down:75; nav-up:55; nav-right:66;nav-left:64;">¡ü</p>
<p onclick="Revert();" id="p75" class="no" style="left:250px;top:350px;nav-index:75; nav-down:75; nav-up:65; nav-right:76;nav-left:74;">¡ü</p>

                                                          

<p onclick="Revert();" id="p06" class="no" style="left:300px;top:0px;nav-index:6; nav-down:16; nav-up:6; nav-right:7;nav-left:5;">¡ü</p>
<p onclick="Revert();" id="p16" class="no" style="left:300px;top:50px;nav-index:16; nav-down:26; nav-up:6; nav-right:17;nav-left:15;">¡ü</p>
<p onclick="Revert();" id="p26" class="no" style="left:300px;top:100px;nav-index:26; nav-down:36; nav-up:16; nav-right:27;nav-left:25;">¡ü</p>
<p onclick="Revert();" id="p36" class="no" style="left:300px;top:150px;nav-index:36; nav-down:46; nav-up:26; nav-right:37;nav-left:35;">¡ü</p>
<p onclick="Revert();" id="p46" class="no" style="left:300px;top:200px;nav-index:46; nav-down:56; nav-up:36; nav-right:47;nav-left:45;">¡ü</p>
<p onclick="Revert();" id="p56" class="no" style="left:300px;top:250px;nav-index:56; nav-down:66; nav-up:46; nav-right:57;nav-left:55;">¡ü</p>
<p onclick="Revert();" id="p66" class="no" style="left:300px;top:300px;nav-index:66; nav-down:76; nav-up:56; nav-right:67;nav-left:65;">¡ü</p>
<p onclick="Revert();" id="p76" class="no" style="left:300px;top:350px;nav-index:76; nav-down:76; nav-up:66; nav-right:77;nav-left:75;">¡ü</p>
                                                   

<p onclick="Revert();" id="p07" class="no" style="left:350px;top:0px;nav-index:7; nav-down:17; nav-up:7; nav-right:7;nav-left:6;">¡ü</p>
<p onclick="Revert();" id="p17" class="no" style="left:350px;top:50px;nav-index:17; nav-down:27; nav-up:7; nav-right:17;nav-left:16;">¡ü</p>
<p onclick="Revert();" id="p27" class="no" style="left:350px;top:100px;nav-index:27; nav-down:37; nav-up:17; nav-right:27;nav-left:26;">¡ü</p>
<p onclick="Revert();" id="p37" class="no" style="left:350px;top:150px;nav-index:37; nav-down:47; nav-up:27; nav-right:37;nav-left:36;">¡ü</p>
<p onclick="Revert();" id="p47" class="no" style="left:350px;top:200px;nav-index:47; nav-down:57; nav-up:37; nav-right:47;nav-left:46;">¡ü</p>
<p onclick="Revert();" id="p57" class="no" style="left:350px;top:250px;nav-index:57; nav-down:67; nav-up:47; nav-right:57;nav-left:56;">¡ü</p>
<p onclick="Revert();" id="p67" class="no" style="left:350px;top:300px;nav-index:67; nav-down:77; nav-up:57; nav-right:67;nav-left:66;">¡ü</p>
<p onclick="Revert();" id="p77" class="no" style="left:350px;top:350px;nav-index:77; nav-down:77; nav-up:67; nav-right:77;nav-left:76;">¡ü</p>



</div>

<p id="navi" style="top:180px;left:200px;color-index:0;background-color-index:15;">Play</p>





<p id="alert" style="top:300px;left:10px;"><![CDATA[]]></p>
<p style="top:470px;left:840px;height:36px;width:60px;background-color-index:4;color-index:7;" accesskey="B" onclick="goback();">Back</p>
</body>
</bml>
