<?xml version="1.0" encoding="EUC-JP" ?><!DOCTYPE html  PUBLIC '-//W3C//DTD XHTML 1.0 Transitional//JA'  'http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd'><html>
<head><meta content="IE=8" http-equiv="X-UA-Compatible"/><style>body 
{
	z-index				:auto;
	display				:block;
	visibility			:visible;
	background-image		:none;
	background-repeat		:repeat;

	margin				:0px;
	padding				:0px;
	border-width			:0px;
	position			:absolute;

	background-color		:#000000;
	width				:960px;
	height				:540px;

}

div 
{
	position			:absolute;
	margin				:0px;
	padding				:0px;
	border-width			:0px;
	border-style			:none;
	border-color			:#000000;

	left				:0px;
	top				:0px;
	width				:0px;
	height				:0px;
	z-index				:auto;
	display				:block;
	visibility			:inherit;
	overflow			:hidden;
	font-size			:100%;
	white-space			:normal;
	

}

p
{
	position			:absolute;
	margin				:0px;
	padding				:0px;
	border-width			:0px;
	border-style			:none;
	border-color			:#000000;

	left				:0px;
	top				:0px;
	width				:0px;
	height				:0px;
	z-index				:auto;
	display				:block;
	visibility			:inherit;
	overflow			:hidden;

	line-height			:normal;
	font-family			:'ARISAKA-ðÈ¾£','IPA¥´¥·¥Ã¥¯';
	font-size			:24px;
	font-weight			:normal;
	text-align			:left;
	letter-spacing			:normal;
	white-space			:normal;
	line-height			:100%;
	word-break			:break-all;
	
	word-wrap			:break-word;
	
}

input
{
	position			:absolute;
	margin				:0px;
	padding				:0px;
	border-width			:0px;
	border-style			:none;
	border-color			:#000000;

	left				:0px;
	top				:0px;
	width				:0px;
	height				:0px;
	z-index				:auto;
	display				:block;
	visibility			:inherit;
	overflow			:hidden;

	line-height			:normal;
	font-family			:'ARISAKA-ðÈ¾£','IPA¥´¥·¥Ã¥¯';
	font-size			:24px;
	font-weight			:normal;
	text-align			:left;
	letter-spacing			:normal;
	white-space			:normal;
	line-height			:100%;
	
	
}

span
{
	border-width			:0px;
	border-style			:none;
	border-color			:#000000;

	position			:static;
	z-index				:auto;
	line-height			:inherit;
	display				:inline;
	visibility			:inherit;
	font-family			:'ARISAKA-ðÈ¾£','IPA¥´¥·¥Ã¥¯';
	font-size			:24px;
	font-weight			:normal;
	letter-spacing			:inherit;
	font-size			:100%;
	line-height			:100%;

	
}

a
{
	border-width			:0px;
	border-style			:none;
	border-color			:#000000;

	position			:static;
	z-index				:auto;
	line-height			:inherit;
	display				:inline;
	visibility			:inherit;
	font-family			:'ARISAKA-ðÈ¾£','IPA¥´¥·¥Ã¥¯';
	font-size			:24px;
	font-weight			:normal;
	letter-spacing			:inherit;
	font-size			:100%;
	white-space			:normal;
	line-height			:100%;
	color				:#000000;
	text-decoration		:none;
}




br
{
	position			:static;
	z-index				:auto;
	line-height			:inherit;
	display				:inline;
	line-height			:100%;
}

object
{
	position			:absolute;
	margin				:0px;
	padding				:0px;
	border-width			:0px;
	border-style			:none;
	border-color			:#000000;

	left				:0px;
	top				:0px;
	width				:0px;
	height				:0px;
	z-index				:auto;
	display				:block;
	visibility			:inherit;
	overflow			:hidden;

	
}

img
{
	position			:absolute;
	margin				:0px;
	padding				:0px;
	border-width			:0px;
	border-style			:none;
	border-color			:#000000;

	left				:0px;
	top				:0px;
	width				:0px;
	height				:0px;
	z-index				:auto;
	display				:block;
	visibility			:inherit;
	overflow			:hidden;

	
}</style>
<title></title>


<style media="all" type="text/css">
body
{
background-color:#000000; clut:url(c_0.clt); 
}
p
{
font-size:20px; 
}
.view
{
width:512px; top:-10px; left:-10px; background-color:'transparent'; height:384px; 
}
.scope
{
width:492px; top:0px; left:0px; height:364px; 
}
object.wall
{
visibility:hidden; height:384px; 
}
img.wall
{
visibility:hidden; height:384px; 
}
object.enemy
{
width:284px; top:0px; left:114px; visibility:hidden; height:384px; 
}
img.enemy
{
width:284px; top:0px; left:114px; visibility:hidden; height:384px; 
}
.map
{
width:420px; height:420px; 
}
p.map
{
color:#aaaaaa; background-color:#555555; 
}
p.hero
{
color:#ffff00; width:20px; height:20px; 
}
p.alien
{
color:#ffff00; width:20px; height:20px; 
}
</style>


</head>


<body onLoad="BML.Navigation.initialize();start();;" style="behavior:url(#default#download);">
<div>
<object classid="CLSID:22d6f312-b0f6-11d0-94ab-0080c74c7e95" id="walk_1"><param name="FileName" value="walk_1.aif"/><param name="AutoRewind" value="False"/><param name="ShowControls" value="False"/><param name="autostart" value="false"/></object>
<object classid="CLSID:22d6f312-b0f6-11d0-94ab-0080c74c7e95" id="walk_2"><param name="FileName" value="walk_2.aif"/><param name="AutoRewind" value="False"/><param name="ShowControls" value="False"/><param name="autostart" value="false"/></object>
</div>

<div _onKeyDown="keydown();" _onKeyUp="keyup();" class="scope" nav_index="0" style="top:60px; left:100px; ">
<div class="view" id="view">

	
	<img class="wall" id="l_1_V_S" src="l_1_V_S.png" style="width:65px; left:0px; "/>
	<img class="wall" id="l_1_H_S" src="l_1_H_S.png" style="width:65px; left:0px; "/>

	<img class="wall" id="l_2_V_S" src="l_2_V_S.png" style="width:85px; left:65px; "/>
	<img class="wall" id="l_2_H_S" src="l_2_H_S.png" style="width:85px; left:65px; "/>

	<img class="wall" id="l_3_V_S" src="l_3_V_S.png" style="width:33px; left:150px; "/>
	<img class="wall" id="l_3_H_S" src="l_3_H_S.png" style="width:33px; left:150px; "/>

	<img class="wall" id="l_4_V_S" src="l_4_V_S.png" style="width:17px; left:183px; "/>
	<img class="wall" id="l_4_H_S" src="l_4_H_S.png" style="width:17px; left:183px; "/>

	
	<img class="wall" id="r_1_V_S" src="r_1_V_S.png" style="width:64px; left:448px; "/>
	<img class="wall" id="r_1_H_S" src="r_1_H_S.png" style="width:64px; left:448px; "/>

	<img class="wall" id="r_2_V_S" src="r_2_V_S.png" style="width:85px; left:363px; "/>
	<img class="wall" id="r_2_H_S" src="r_2_H_S.png" style="width:85px; left:363px; "/>

	<img class="wall" id="r_3_V_S" src="r_3_V_S.png" style="width:33px; left:330px; "/>
	<img class="wall" id="r_3_H_S" src="r_3_H_S.png" style="width:33px; left:330px; "/>

	<img class="wall" id="r_4_V_S" src="r_4_V_S.png" style="width:17px; left:313px; "/>
	<img class="wall" id="r_4_H_S" src="r_4_H_S.png" style="width:17px; left:313px; "/>

	
	<img class="wall" id="f_5_V_S" src="f_5_V_S.png" style="width:113px; left:200px; "/>
	<img class="wall" id="f_5_H_S" src="f_5_H_S.png" style="width:113px; left:200px; "/>
	<img class="wall" id="f_4_V_S" src="f_4_V_S.png" style="width:147px; left:183px; "/>
	<img class="wall" id="f_3_V_S" src="f_3_V_S.png" style="width:213px; left:150px; "/>
	<img class="wall" id="f_2_V_S" src="f_2_V_S.png" style="width:383px; left:65px; "/>



	
	<img class="wall" id="l_2_V_T" src="l_2_V_T.png" style="width:120px; left:0px; "/>
	<img class="wall" id="l_2_H_T" src="l_2_H_T.png" style="width:120px; left:0px; "/>

	<img class="wall" id="l_3_V_T" src="l_3_V_T.png" style="width:50px; left:120px; "/>
	<img class="wall" id="l_3_H_T" src="l_3_H_T.png" style="width:50px; left:120px; "/>

	<img class="wall" id="l_4_V_T" src="l_4_V_T.png" style="width:23px; left:170px; "/>
	<img class="wall" id="l_4_H_T" src="l_4_H_T.png" style="width:23px; left:170px; "/>

	
	<img class="wall" id="r_2_V_T" src="r_2_V_T.png" style="width:119px; left:393px; "/>
	<img class="wall" id="r_2_H_T" src="r_2_H_T.png" style="width:119px; left:393px; "/>

	<img class="wall" id="r_3_V_T" src="r_3_V_T.png" style="width:50px; left:343px; "/>
	<img class="wall" id="r_3_H_T" src="r_3_H_T.png" style="width:50px; left:343px; "/>

	<img class="wall" id="r_4_V_T" src="r_4_V_T.png" style="width:23px; left:320px; "/>
	<img class="wall" id="r_4_H_T" src="r_4_H_T.png" style="width:23px; left:320px; "/>

	
	<img class="wall" id="f_3_V_T" src="f_3_V_T.png" style="width:273px; left:120px; "/>

	<img class="wall" id="f_4_V_T" src="f_4_V_T.png" style="width:173px; left:170px; "/>

	<img class="wall" id="f_5_V_T" src="f_5_V_T.png" style="width:127px; left:193px; "/>
	<img class="wall" id="f_5_H_T" src="f_5_H_T.png" style="width:127px; left:193px; "/>



	<img class="enemy" id="enemy_f_5_S" src="enemy_f_5_S.png"/>
	<img class="enemy" id="enemy_f_5_T" src="enemy_f_5_T.png"/>
	<img class="enemy" id="enemy_f_4_S" src="enemy_f_4_S.png"/>
	<img class="enemy" id="enemy_f_4_T" src="enemy_f_4_T.png"/>
	<img class="enemy" id="enemy_f_3_S" src="enemy_f_3_S.png"/>
	<img class="enemy" id="enemy_f_3_T" src="enemy_f_3_T.png"/>
	<img class="enemy" id="enemy_f_2_S" src="enemy_f_2_S.png"/>
	<img class="enemy" id="enemy_f_2_T" src="enemy_f_2_T.png"/>
	<img class="enemy" id="enemy_f_1_S" src="enemy_f_1_S.png"/>
	<img class="enemy" id="enemy_f_1_T" src="enemy_f_1_T.png"/>




	
	<img class="wall" id="l1_1_V_R" src="l_1_V_R.png" style="width:374px; left:0px; "/>
	<img class="wall" id="l1_1_H_R" src="l_1_H_R.png" style="width:374px; left:0px; "/>
	<img class="wall" id="l1_2_H_R" src="l_2_H_R.png" style="width:138px; left:374px; "/>
	<img class="wall" id="l1_2_V_R" src="l_2_V_R.png" style="width:138px; left:374px; "/>
	<img class="wall" id="l1f_2_V_R" src="fl_2_V_R.png" style="width:138px; left:374px; "/>

	
	<img class="wall" id="l2_1_V_R" src="r_1_V_R.png" style="width:374px; left:138px; "/>
	<img class="wall" id="l2_1_H_R" src="r_1_H_R.png" style="width:374px; left:138px; "/>
	<img class="wall" id="l2_2_H_R" src="r_2_H_R.png" style="width:138px; left:0px; "/>
	<img class="wall" id="l2_2_V_R" src="r_2_V_R.png" style="width:138px; left:0px; "/>
	<img class="wall" id="l2f_2_V_R" src="fr_2_V_R.png" style="width:138px; left:0px; "/>

	
	<img class="wall" id="r1_1_V_R" src="r_1_V_R.png" style="width:374px; left:138px; "/>
	<img class="wall" id="r1_1_H_R" src="r_1_H_R.png" style="width:374px; left:138px; "/>
	<img class="wall" id="r1_2_H_R" src="r_2_H_R.png" style="width:138px; left:0px; "/>
	<img class="wall" id="r1_2_V_R" src="r_2_V_R.png" style="width:138px; left:0px; "/>
	<img class="wall" id="r1f_2_V_R" src="fr_2_V_R.png" style="width:138px; left:0px; "/>

	
	<img class="wall" id="r2_1_V_R" src="l_1_V_R.png" style="width:374px; left:0px; "/>
	<img class="wall" id="r2_1_H_R" src="l_1_H_R.png" style="width:374px; left:0px; "/>
	<img class="wall" id="r2_2_H_R" src="l_2_H_R.png" style="width:138px; left:374px; "/>
	<img class="wall" id="r2_2_V_R" src="l_2_V_R.png" style="width:138px; left:374px; "/>
	<img class="wall" id="r2f_2_V_R" src="fl_2_V_R.png" style="width:138px; left:374px; "/>
</div>
</div>

<div class="map" id="mapbase" style="top:50px; visibility:hidden; left:650px; ">
	<p class="map" id="map" style="white-space:pre;">¡¡</p>
	<p class="hero" id="hero">¡ú</p>
	<p class="alien" id="alien0">¢¨</p>
	<p class="alien" id="alien1">¢¨</p>
</div>

</body>
<script charset="EUC-JP" language="javascript" type="text/javascript">
var BML = (typeof (BML) == 'undefined') ? {} : BML;

BML.Aux = (function(){

	function extend(dst, src) {
	    for (k in src) {
	        if (typeof (src[k]) == 'object') {
	            dst[k] = {};
	            extend(dst[k], src[k]);
	        }
	        else {
	            dst[k] = src[k];
	        }
	    }
	    return (dst);
	}
	
	
	function trim(str) {
	    str = str.replace(/(^\s*)/g, '');
	    return str.replace(/(\s*$)/g, '');
	}
	
	function camelize(str) {
	    var parts = str.split('-');
	    if (parts.length <= 1)
	        return (str);
	
	    var buf = String(parts[0]).toLowerCase();
	    for (var i = 1, l = parts.length; i < l; i++) {
	        var part = String(parts[i]);
	        if (!part) continue;
	        part = part.toLowerCase();
	        buf += part.charAt(0).toUpperCase() + part.substring(1);
	    }
	    return (buf);
	}
	
	function each(iterator, context) {
   		context = context || this;
    		try {
      			for(var i = 0, l = this.length; i < l; i++) {
        			iterator.call(context, this[i], i);
      			}
    		} 
		catch(e) {
    		}
    		return(this);
  	}			
	
	function isUndefined(obj) { 
		return(typeof(obj) == 'undefined'); 
	}

	function getClass(obj) {
    		return(Object.prototype.toString.call(obj).match(/^\[object\s(.*)\]$/)[1]);
	}
	function isArray(obj)      { return(getClass(obj) == 'Array'); }

	function emptyFunction()   { }

	var slice = Array.prototype.slice;

	function append(array) {
   	 	var thisLength = this.length, length = array.length;
   	 	while(length--) this[thisLength + length] = array[length];
    		return(this);
  	}

	function bind(context) {
    		if ((arguments.length < 2) && isUndefined(arguments[0])) return(this);
    
    		var __method = this, args = slice.call(arguments, 1);
    		return(function() {
      			var a = append.call(slice.call(args, 0), arguments);
      			return(__method.apply(context, a));
    		});
  	}
  
  	function wait(timeout, context) {
    		var __method = this, args = slice.call(arguments, 2);
    		return(window.setTimeout(function() {
      			return(__method.apply(context || null, args));
    			}, timeout * 1000));
  	}

	function combinePath(relative, current) {
    		if (relative.indexOf('http') >= 0) return(relative);

    		var path = current;
    		path = path.split('/');
		relative = relative.split('/');
    		var buf = [];
		for( var k = 0, lk = path.length-1; k < lk; k++ ){
			buf.push(path[k]);
		}
    		for(var i = 0, l = relative.length; i < l; i++) {
      			var p = relative[i];
      			((p == '..') && (buf.length > 0)) ? buf.pop() : buf.push(p);
    		}
    		return(buf.join('/'));
  	}
  	
  	function toPaddedString(str, pad, len) {
    	var ret = ''; str = String(str); pad = pad || ' ';
    	for(var i = str.length, l = len || 2; i < l; i++) ret += pad;
    	return(ret + str);
  	}

	return ({	
		extend: 	extend,
		trim: 		trim,
		camelize:	camelize,
		each: 		each,
		isUndefined:	isUndefined,
		emptyFunction:	emptyFunction,
		bind:		bind,
		wait:		wait,
		combinePath:	combinePath,
		toPaddedString:	toPaddedString,
		isArray:	isArray
	});
})();



BML.Processor = (function() {
	
	var ARIB_KEYCODE  = {
	    UP      :  1,    DOWN    :  2,    LEFT    :  3,    RIGHT   :  4,
	    0       :  5,    1       :  6,    2       :  7,    3       :  8,
	    4       :  9,    5       : 10,    6       : 11,    7       : 12,
	    8       : 13,    9       : 14,    10      : 15,    11      : 16,
	    12      : 17,
	    ENTER   : 18,    BACK    : 19,    DBUTTON : 20,
	    B       : 21,    R       : 22,    G       : 23,    Y       : 24
	};
	
	
	function isDirectionKey(keyCode) {
		return keyCode >= ARIB_KEYCODE["UP"] && keyCode <= ARIB_KEYCODE["RIGHT"];
	}
	
	function isAccessKey(keyCode) {
		return keyCode >= ARIB_KEYCODE["B"] && keyCode <= ARIB_KEYCODE["Y"];
	}
	
	function isNumericKey(keyCode) {
		return keyCode >= ARIB_KEYCODE["0"] && keyCode <= ARIB_KEYCODE["12"];
	}
	
	
	
    function processInput(event) {
    	var type = event.type;
    	var code = event.keyCode;
    	BML.Dom.UpdateObjectState();
    	switch(type) {
    		case ("keydown"): {
    			if( code == ARIB_KEYCODE["DBUTTON"] ) {
    				break;
    			}
    			document.currentEvent = {type: "keydown", target: document.currentFocus, keyCode: code};
				
				if( document.currentFocus && document.currentFocus._onKeyDown ) {
					
					eval(document.currentFocus._onKeyDown);
				}
				
    			if( isDirectionKey(code) || isAccessKey(code) ) {
    				BML.Navigation.navigate(code);
    				if( isAccessKey(code) && document.currentFocus && document.currentFocus._onClick ) {
						document.currentEvent = {type:"click", target:document.currentFocus};
    					eval(document.currentFocus._onClick);
    				}
    			}
    			else if( isNumericKey(code) ) {
    			}
    			else if( code == ARIB_KEYCODE["ENTER"] ) {
    				var currentFocus = document.currentFocus;
    				document.currentEvent = {type:"click", target:currentFocus};
    				if( currentFocus && currentFocus._onClick ) {
    					eval(currentFocus._onClick);
    				}
    				
    				if( currentFocus ) {
    					BML.CSS.setElementActiveStyle(currentFocus);
    				}
    				
    				if( document.currentFocus && (nodeName = document.currentFocus.nodeName.toLowerCase()) == "a" ) {
    					if( typeof(document.currentFocus.href) != "undefined" && BML.Aux.trim(document.currentFocus.href) != "") {
    					
    						window.navigate(document.currentFocus.href);
    						var temp = document.currentFocus.href + "?";
						    if( temp.indexOf(".bml?") >=0 ){
						    	temp = temp.replace(".bml?",".html");
						    	window.navigate(temp);
						    }
    					}
    				}
    			}
    			else {
    			}
    			
    			if( document.currentFocus && (nodeName = document.currentFocus.nodeName.toLowerCase()) == "input" ) {			
	    			if( code >= ARIB_KEYCODE["0"] && code <= ARIB_KEYCODE["12"] ){		
	    				document.currentFocus.value = document.currentFocus.value + String(code-ARIB_KEYCODE["0"]);
	    			}
	    			if (code == ARIB_KEYCODE["BACK"]) {
	    			    if (document.currentFocus.value.length>0){
	    				    document.currentFocus.value = document.currentFocus.value.substr(0,document.currentFocus.value.length-1);
	    			    }
	    			}
    			}
    			
    			break;
    		}
    		case ("keyup"): {
    			if( code == ARIB_KEYCODE["DBUTTON"] ) {
    				break;
    			}
    			
				document.currentEvent = {type: "keyup", target: document.currentFocus, keyCode: code};
				if( document.currentFocus && document.currentFocus._onKeyUp ) {
					eval(document.currentFocus._onKeyUp);
				}
				
				if( code == ARIB_KEYCODE["ENTER"] ) {
					if( document.currentFocus ) {
    					BML.CSS.unSetElementActiveStyle(document.currentFocus);
    				}
    			}
    			break;
    		}
    		default:
    			break;
    	}
    	BML.Dom.UpdateObjectState();
    	
    }
	
	
    return ({
        processInput: processInput,
        ARIB_KEYCODE: ARIB_KEYCODE,
        isAccessKey: isAccessKey
    });
})();



BML.Navigation = {};
BML.Aux.extend( BML.Navigation, (function() {

	function getNavigationInfo(element) {
        if (typeof (element.nav_index) != "undefined") {
            BML.Navigation.navIndex2Element[element.nav_index] = element;
        }
        if (typeof (element._accessKey) != "undefined") {
            BML.Navigation.accessKey2Element[BML.Processor.ARIB_KEYCODE[element._accessKey]] = element;
        }
        
        var children = element.childNodes;
        for (var i = 0, l = children.length; i < l; i++) {
            getNavigationInfo(children[i]);
        }
    }

  

    function initialize() {
        BML.Navigation.navIndex2Element = {};
        BML.Navigation.accessKey2Element = {};
        getNavigationInfo(document);
        for( var key in BML.Navigation.navIndex2Element )
        {
        	document.currentFocus = BML.Navigation.navIndex2Element[key];
        	break;
        }
        if( !document.currentFocus )
        {
        	for( var key in BML.Navigation.accessKey2Element )
	        {
	        	document.currentFocus = BML.Navigation.accessKey2Element[key];
	        	break;
	        }
        }
        if( !document.currentFocus )
        {
        	document.currentFocus = document.getElementsByTagName("body")[0].childNodes[0];
        }
        if(document.currentFocus) {
        	document.currentFocus.focus();
        	BML.CSS.setElementFocusStyle(document.currentFocus);
        }
    }

    function navUp() {
        elm = document.currentFocus;
        nextIdx = elm.nav_up;
        nextElm = BML.Navigation.navIndex2Element[nextIdx];
        if( (elm) && (nextElm) ) {
        	navNext(elm, nextElm);
        }
    }

    function navDown() {
        elm = document.currentFocus;
        nextIdx = elm.nav_down;
        nextElm = BML.Navigation.navIndex2Element[nextIdx];
        if( (elm) && (nextElm) ) {
        	navNext(elm, nextElm);
        }
    }

    function navLeft() {
        elm = document.currentFocus;
        nextIdx = elm.nav_left;
        nextElm = BML.Navigation.navIndex2Element[nextIdx];
        if( (elm) && (nextElm) ) {
        	navNext(elm, nextElm);
        }
    }

    function navRight() {
        elm = document.currentFocus;
        nextIdx = elm.nav_right;
        nextElm = BML.Navigation.navIndex2Element[nextIdx];
        if( (elm) && (nextElm) ) {
        	navNext(elm, nextElm);
        }
    }

    function navNext(elm, nextElm) {    
    
    	if( (!elm) || (!nextElm)  )
    		return;
    		
    	
        if( elm._onBlur &&  (elm != nextElm)) {
        	document.currentEvent = {type:"blur", target:elm};
        	currentFocus = document.currentFocus;
        	document.currentFocus = elm;
        	eval(elm._onBlur);
        	document.currentFocus = currentFocus;
        }
        
        BML.CSS.unSetElementFocusStyle(elm);
        document.currentFocus = nextElm;
        BML.CSS.setElementFocusStyle(nextElm);
        
        if( nextElm._onFocus ) {
        	document.currentEvent = {type:"focus", target:nextElm};
        	currentFocus = document.currentFocus;
        	document.currentFocus = nextElm;
        	eval(nextElm._onFocus);
        	document.currentFocus = currentFocus;
        }
    }

	function navigate(keyCode) {
	
		if( BML.Processor.isAccessKey(keyCode)) {
			var elm = document.currentFocus;
			nextElm = BML.Navigation.accessKey2Element[keyCode];
	        if( (elm) && (nextElm) ) {
	        	navNext(elm, nextElm);
	        }
		}
		else {
			switch(keyCode) {
				case (BML.Processor.ARIB_KEYCODE["UP"]): {
					navUp();
					break;
				}
				case (BML.Processor.ARIB_KEYCODE["DOWN"]): {
					navDown();
					break;
				}
				case (BML.Processor.ARIB_KEYCODE["LEFT"]): {
					navLeft();
					break;
				}
				case (BML.Processor.ARIB_KEYCODE["RIGHT"]): {
					navRight();
					break;
				}
				default: {
					break;
				}
			}
		}
	}
	
    return ({
        initialize: initialize,
        navigate: navigate,
        navNext: navNext
    });
})());


BML.CSS = {};
BML.Aux.extend(BML.CSS, (function() {

	var palette = [[0, 0, 0, 255, 1.0, '000000'], [255, 0, 0, 255, 1.0, 'ff0000'], [0, 255, 0, 255, 1.0, '00ff00'], [255, 255, 0, 255, 1.0, 'ffff00'],
                    [0, 0, 255, 255, 1.0, '0000ff'], [255, 0, 255, 255, 1.0, 'ff00ff'], [0, 255, 255, 255, 1.0, '00ffff'], [255, 255, 255, 255, 1.0, 'ffffff'],
                    [0, 0, 0, 0, 0.0, '000000'], [170, 0, 0, 255, 1.0, 'aa0000'], [0, 170, 0, 255, 1.0, '00aa00'], [170, 170, 0, 255, 1.0, 'aaaa00'],
                    [0, 0, 170, 255, 1.0, '0000aa'], [170, 0, 170, 255, 1.0, 'aa00aa'], [0, 170, 170, 255, 1.0, '00aaaa'], [170, 170, 170, 255, 1.0, 'aaaaaa'],
                    [0, 0, 85, 255, 1.0, '000055'], [0, 85, 0, 255, 1.0, '005500'], [0, 85, 85, 255, 1.0, '005555'], [0, 85, 170, 255, 1.0, '0055aa'],
                    [0, 85, 255, 255, 1.0, '0055ff'], [0, 170, 85, 255, 1.0, '00aa55'], [0, 170, 255, 255, 1.0, '00aaff'], [0, 255, 85, 255, 1.0, '00ff55'],
                    [0, 255, 170, 255, 1.0, '00ffaa'], [85, 0, 0, 255, 1.0, '550000'], [85, 0, 85, 255, 1.0, '550055'], [85, 0, 170, 255, 1.0, '5500aa'],
                    [85, 0, 255, 255, 1.0, '5500ff'], [85, 85, 0, 255, 1.0, '555500'], [85, 85, 85, 255, 1.0, '555555'], [85, 85, 170, 255, 1.0, '5555aa'],
                    [85, 85, 255, 255, 1.0, '5555ff'], [85, 170, 0, 255, 1.0, '55aa00'], [85, 170, 85, 255, 1.0, '55aa55'], [85, 170, 170, 255, 1.0, '55aaaa'],
                    [85, 170, 255, 255, 1.0, '55aaff'], [85, 255, 0, 255, 1.0, '55ff00'], [85, 255, 85, 255, 1.0, '55ff55'], [85, 255, 170, 255, 1.0, '55ffaa'],
                    [85, 255, 255, 255, 1.0, '55ffff'], [170, 0, 85, 255, 1.0, 'aa0055'], [170, 0, 255, 255, 1.0, 'aa00ff'], [170, 85, 0, 255, 1.0, 'aa5500'],
                    [170, 85, 85, 255, 1.0, 'aa5555'], [170, 85, 170, 255, 1.0, 'aa55aa'], [170, 85, 255, 255, 1.0, 'aa55ff'], [170, 170, 85, 255, 1.0, 'aaaa55'],
                    [170, 170, 255, 255, 1.0, 'aaaaff'], [170, 255, 0, 255, 1.0, 'aaff00'], [170, 255, 85, 255, 1.0, 'aaff55'], [170, 255, 170, 255, 1.0, 'aaffaa'],
                    [170, 255, 255, 255, 1.0, 'aaffff'], [255, 0, 85, 255, 1.0, 'ff0055'], [255, 0, 170, 255, 1.0, 'ff00aa'], [255, 85, 0, 255, 1.0, 'ff5500'],
                    [255, 85, 85, 255, 1.0, 'ff5555'], [255, 85, 170, 255, 1.0, 'ff55aa'], [255, 85, 255, 255, 1.0, 'ff55ff'], [255, 170, 0, 255, 1.0, 'ffaa00'],
                    [255, 170, 85, 255, 1.0, 'ffaa55'], [255, 170, 170, 255, 1.0, 'ffaaaa'], [255, 170, 255, 255, 1.0, 'ffaaff'], [255, 255, 85, 255, 1.0, 'ffff55'],
                    [255, 255, 170, 255, 1.0, 'ffffaa'], [0, 0, 0, 128, 0.5, '000000'], [255, 0, 0, 128, 0.5, 'ff0000'], [0, 255, 0, 128, 0.5, '00ff00'],
                    [255, 255, 0, 128, 0.5, 'ffff00'], [0, 0, 255, 128, 0.5, '0000ff'], [255, 0, 255, 128, 0.5, 'ff00ff'], [0, 255, 255, 128, 0.5, '00ffff'],
                    [255, 255, 255, 128, 0.5, 'ffffff'], [170, 0, 0, 128, 0.5, 'aa0000'], [0, 170, 0, 128, 0.5, '00aa00'], [170, 170, 0, 128, 0.5, 'aaaa00'],
                    [0, 0, 170, 128, 0.5, '0000aa'], [170, 0, 170, 128, 0.5, 'aa00aa'], [0, 170, 170, 128, 0.5, '00aaaa'], [170, 170, 170, 128, 0.5, 'aaaaaa'],
                    [0, 0, 85, 128, 0.5, '000055'], [0, 85, 0, 128, 0.5, '005500'], [0, 85, 85, 128, 0.5, '005555'], [0, 85, 170, 128, 0.5, '0055aa'],
                    [0, 85, 255, 128, 0.5, '0055ff'], [0, 170, 85, 128, 0.5, '00aa55'], [0, 170, 255, 128, 0.5, '00aaff'], [0, 255, 85, 128, 0.5, '00ff55'],
                    [0, 255, 170, 128, 0.5, '00ffaa'], [85, 0, 0, 128, 0.5, '550000'], [85, 0, 85, 128, 0.5, '550055'], [85, 0, 170, 128, 0.5, '5500aa'],
                    [85, 0, 255, 128, 0.5, '5500ff'], [85, 85, 0, 128, 0.5, '555500'], [85, 85, 85, 128, 0.5, '555555'], [85, 85, 170, 128, 0.5, '5555aa'],
                    [85, 85, 255, 128, 0.5, '5555ff'], [85, 170, 0, 128, 0.5, '55aa00'], [85, 170, 85, 128, 0.5, '55aa55'], [85, 170, 170, 128, 0.5, '55aaaa'],
                    [85, 170, 255, 128, 0.5, '55aaff'], [85, 255, 0, 128, 0.5, '55ff00'], [85, 255, 85, 128, 0.5, '55ff55'], [85, 255, 170, 128, 0.5, '55ffaa'],
                    [85, 255, 255, 128, 0.5, '55ffff'], [170, 0, 85, 128, 0.5, 'aa0055'], [170, 0, 255, 128, 0.5, 'aa00ff'], [170, 85, 0, 128, 0.5, 'aa5500'],
                    [170, 85, 85, 128, 0.5, 'aa5555'], [170, 85, 170, 128, 0.5, 'aa55aa'], [170, 85, 255, 128, 0.5, 'aa55ff'], [170, 170, 85, 128, 0.5, 'aaaa55'],
                    [170, 170, 255, 128, 0.5, 'aaaaff'], [170, 255, 0, 128, 0.5, 'aaff00'], [170, 255, 85, 128, 0.5, 'aaff55'], [170, 255, 170, 128, 0.5, 'aaffaa'],
                    [170, 255, 255, 128, 0.5, 'aaffff'], [255, 0, 85, 128, 0.5, 'ff0055'], [255, 0, 170, 128, 0.5, 'ff00aa'], [255, 85, 0, 128, 0.5, 'ff5500'],
                    [255, 85, 85, 128, 0.5, 'ff5555'], [255, 85, 170, 128, 0.5, 'ff55aa'], [255, 85, 255, 128, 0.5, 'ff55ff'], [255, 170, 0, 128, 0.5, 'ffaa00'],
                    [255, 170, 85, 128, 0.5, 'ffaa55'], [255, 170, 170, 128, 0.5, 'ffaaaa'], [255, 170, 255, 128, 0.5, 'ffaaff'], [255, 255, 85, 128, 0.5, 'ffff55']
                  ];

   
 


    function initialize() {
        BML.CSS.focusStyles = {};
        BML.CSS.activeStyles = {};
        var styles = document.getElementsByTagName("style");
        for (var i = 0, l = styles.length; i < l; i++) {
            var styleStr = styles[i].innerHTML;
            var styleArray = styleStr.split("}");
            for (var j = 0; j < styleArray.length; j++) {
                var temp = styleArray[j].split("{");
                if (temp.length == 2) {
                    var name = BML.Aux.trim(temp[0]);
                    var value = BML.Aux.trim(temp[1]);
                    if (name.indexOf(":focus") >= 0) {
                        name = name.toLowerCase();
                        BML.CSS.focusStyles[name] = (BML.CSS.focusStyles[name] || "") + value;
                    }

                    if (name.indexOf(":active") >= 0) {
                        name = name.toLowerCase();
                        BML.CSS.activeStyles[name] = (BML.CSS.activeStyles[name] || "") + value;
                    }
                }
            }
        }
        
        //Add preFocusStyle and preActiveFocus attribute to the style of each element
        //in the BML.Dom initialize
    }
    

    function setElementFocusStyle(elm) {
        focusStyleStr = "";
        
        if (BML.CSS.focusStyles[":focus"]) {
            focusStyleStr += BML.CSS.focusStyles[":focus"] + ";";
        }
        tagName = elm.nodeName.toLowerCase();
        if (BML.CSS.focusStyles[tagName + ":focus"]) {
            focusStyleStr += BML.CSS.focusStyles[tagName + ":focus"] + ";";
        }
        className = elm.className;
        if (BML.CSS.focusStyles["." + className + ":focus"]) {
            focusStyleStr += BML.CSS.focusStyles["." + className + ":focus"] + ";";
        }

        styleAttris = focusStyleStr.split(";");
        for (var i = 0; i < styleAttris.length; i++) {
            attri = styleAttris[i];
            if ((attri = BML.Aux.trim(attri)) == "") {
                continue;
            }
            temp = attri.split(":");
            if (temp.length == 2) {
                name = BML.Aux.camelize(BML.Aux.trim(temp[0]).toLowerCase());
                value = BML.Aux.trim(temp[1]).toLowerCase();
                if (typeof (elm.style[name]) != "undefined") {
                	
                	if (typeof (elm.style.preFocusStyle[name]) == "undefined") {
                		elm.style.preFocusStyle[name] = elm.style[name];
                	}
                    elm.style[name] = value;
                }
            }
        }

    }

	function unSetElementFocusStyle(elm) {
        for (k in elm.style.preFocusStyle) {
                elm.style[k] = elm.style.preFocusStyle[k];
        }
        elm.style.preFocusStyle = {};
    }
    
    
    function setElementActiveStyle(elm) {

        activeStyleStr = elm._activeStyle || "";
        activeStyleStr += ";";
        if (BML.CSS.activeStyles[":active"]) {
            activeStyleStr += BML.CSS.activeStyles[":active"] + ";";
        }
        tagName = elm.nodeName.toLowerCase();
        if (BML.CSS.activeStyles[tagName + ":active"]) {
            activeStyleStr += BML.CSS.activeStyles[tagName + ":active"] + ";";
        }
        className = elm.className;
        if (BML.CSS.activeStyles["." + className + ":active"]) {
            activeStyleStr += BML.CSS.activeStyles["." + className + ":active"] + ";";
        }

        styleAttris = activeStyleStr.split(";");
        for (var i = 0; i < styleAttris.length; i++) {
            attri = styleAttris[i];
            if ((attri = BML.Aux.trim(attri)) == "") {
                continue;
            }
            temp = attri.split(":");
            if (temp.length >= 2) {
                name = BML.Aux.camelize(BML.Aux.trim(temp[0]).toLowerCase());
                value = BML.Aux.trim(temp[1]).toLowerCase();
                if (typeof (elm.style[name]) != "undefined") {
                	if (typeof (elm.style.preActiveStyle[name]) == "undefined") {
                		elm.style.preActiveStyle[name] = elm.style[name];
                	}
                    elm.style[name] = value;
                }
            }
        }
    }

	function unSetElementActiveStyle(elm) {
        for (k in elm.style.preActiveStyle) {
                elm.style[k] = elm.style.preActiveStyle[k];
        }
        elm.style.preActiveStyle = {};
    }
    

    return ({
        initialize: initialize,
        palette: palette,
        setElementFocusStyle: setElementFocusStyle,
        unSetElementFocusStyle: unSetElementFocusStyle,
        unSetElementActiveStyle: unSetElementActiveStyle,
        setElementActiveStyle: setElementActiveStyle
    });
})());


BML.Dom = (function() {

    var palette = [[0, 0, 0, 255, 1.0, '000000'], [255, 0, 0, 255, 1.0, 'ff0000'], [0, 255, 0, 255, 1.0, '00ff00'], [255, 255, 0, 255, 1.0, 'ffff00'],
                    [0, 0, 255, 255, 1.0, '0000ff'], [255, 0, 255, 255, 1.0, 'ff00ff'], [0, 255, 255, 255, 1.0, '00ffff'], [255, 255, 255, 255, 1.0, 'ffffff'],
                    [0, 0, 0, 0, 0.0, '000000'], [170, 0, 0, 255, 1.0, 'aa0000'], [0, 170, 0, 255, 1.0, '00aa00'], [170, 170, 0, 255, 1.0, 'aaaa00'],
                    [0, 0, 170, 255, 1.0, '0000aa'], [170, 0, 170, 255, 1.0, 'aa00aa'], [0, 170, 170, 255, 1.0, '00aaaa'], [170, 170, 170, 255, 1.0, 'aaaaaa'],
                    [0, 0, 85, 255, 1.0, '000055'], [0, 85, 0, 255, 1.0, '005500'], [0, 85, 85, 255, 1.0, '005555'], [0, 85, 170, 255, 1.0, '0055aa'],
                    [0, 85, 255, 255, 1.0, '0055ff'], [0, 170, 85, 255, 1.0, '00aa55'], [0, 170, 255, 255, 1.0, '00aaff'], [0, 255, 85, 255, 1.0, '00ff55'],
                    [0, 255, 170, 255, 1.0, '00ffaa'], [85, 0, 0, 255, 1.0, '550000'], [85, 0, 85, 255, 1.0, '550055'], [85, 0, 170, 255, 1.0, '5500aa'],
                    [85, 0, 255, 255, 1.0, '5500ff'], [85, 85, 0, 255, 1.0, '555500'], [85, 85, 85, 255, 1.0, '555555'], [85, 85, 170, 255, 1.0, '5555aa'],
                    [85, 85, 255, 255, 1.0, '5555ff'], [85, 170, 0, 255, 1.0, '55aa00'], [85, 170, 85, 255, 1.0, '55aa55'], [85, 170, 170, 255, 1.0, '55aaaa'],
                    [85, 170, 255, 255, 1.0, '55aaff'], [85, 255, 0, 255, 1.0, '55ff00'], [85, 255, 85, 255, 1.0, '55ff55'], [85, 255, 170, 255, 1.0, '55ffaa'],
                    [85, 255, 255, 255, 1.0, '55ffff'], [170, 0, 85, 255, 1.0, 'aa0055'], [170, 0, 255, 255, 1.0, 'aa00ff'], [170, 85, 0, 255, 1.0, 'aa5500'],
                    [170, 85, 85, 255, 1.0, 'aa5555'], [170, 85, 170, 255, 1.0, 'aa55aa'], [170, 85, 255, 255, 1.0, 'aa55ff'], [170, 170, 85, 255, 1.0, 'aaaa55'],
                    [170, 170, 255, 255, 1.0, 'aaaaff'], [170, 255, 0, 255, 1.0, 'aaff00'], [170, 255, 85, 255, 1.0, 'aaff55'], [170, 255, 170, 255, 1.0, 'aaffaa'],
                    [170, 255, 255, 255, 1.0, 'aaffff'], [255, 0, 85, 255, 1.0, 'ff0055'], [255, 0, 170, 255, 1.0, 'ff00aa'], [255, 85, 0, 255, 1.0, 'ff5500'],
                    [255, 85, 85, 255, 1.0, 'ff5555'], [255, 85, 170, 255, 1.0, 'ff55aa'], [255, 85, 255, 255, 1.0, 'ff55ff'], [255, 170, 0, 255, 1.0, 'ffaa00'],
                    [255, 170, 85, 255, 1.0, 'ffaa55'], [255, 170, 170, 255, 1.0, 'ffaaaa'], [255, 170, 255, 255, 1.0, 'ffaaff'], [255, 255, 85, 255, 1.0, 'ffff55'],
                    [255, 255, 170, 255, 1.0, 'ffffaa'], [0, 0, 0, 128, 0.5, '000000'], [255, 0, 0, 128, 0.5, 'ff0000'], [0, 255, 0, 128, 0.5, '00ff00'],
                    [255, 255, 0, 128, 0.5, 'ffff00'], [0, 0, 255, 128, 0.5, '0000ff'], [255, 0, 255, 128, 0.5, 'ff00ff'], [0, 255, 255, 128, 0.5, '00ffff'],
                    [255, 255, 255, 128, 0.5, 'ffffff'], [170, 0, 0, 128, 0.5, 'aa0000'], [0, 170, 0, 128, 0.5, '00aa00'], [170, 170, 0, 128, 0.5, 'aaaa00'],
                    [0, 0, 170, 128, 0.5, '0000aa'], [170, 0, 170, 128, 0.5, 'aa00aa'], [0, 170, 170, 128, 0.5, '00aaaa'], [170, 170, 170, 128, 0.5, 'aaaaaa'],
                    [0, 0, 85, 128, 0.5, '000055'], [0, 85, 0, 128, 0.5, '005500'], [0, 85, 85, 128, 0.5, '005555'], [0, 85, 170, 128, 0.5, '0055aa'],
                    [0, 85, 255, 128, 0.5, '0055ff'], [0, 170, 85, 128, 0.5, '00aa55'], [0, 170, 255, 128, 0.5, '00aaff'], [0, 255, 85, 128, 0.5, '00ff55'],
                    [0, 255, 170, 128, 0.5, '00ffaa'], [85, 0, 0, 128, 0.5, '550000'], [85, 0, 85, 128, 0.5, '550055'], [85, 0, 170, 128, 0.5, '5500aa'],
                    [85, 0, 255, 128, 0.5, '5500ff'], [85, 85, 0, 128, 0.5, '555500'], [85, 85, 85, 128, 0.5, '555555'], [85, 85, 170, 128, 0.5, '5555aa'],
                    [85, 85, 255, 128, 0.5, '5555ff'], [85, 170, 0, 128, 0.5, '55aa00'], [85, 170, 85, 128, 0.5, '55aa55'], [85, 170, 170, 128, 0.5, '55aaaa'],
                    [85, 170, 255, 128, 0.5, '55aaff'], [85, 255, 0, 128, 0.5, '55ff00'], [85, 255, 85, 128, 0.5, '55ff55'], [85, 255, 170, 128, 0.5, '55ffaa'],
                    [85, 255, 255, 128, 0.5, '55ffff'], [170, 0, 85, 128, 0.5, 'aa0055'], [170, 0, 255, 128, 0.5, 'aa00ff'], [170, 85, 0, 128, 0.5, 'aa5500'],
                    [170, 85, 85, 128, 0.5, 'aa5555'], [170, 85, 170, 128, 0.5, 'aa55aa'], [170, 85, 255, 128, 0.5, 'aa55ff'], [170, 170, 85, 128, 0.5, 'aaaa55'],
                    [170, 170, 255, 128, 0.5, 'aaaaff'], [170, 255, 0, 128, 0.5, 'aaff00'], [170, 255, 85, 128, 0.5, 'aaff55'], [170, 255, 170, 128, 0.5, 'aaffaa'],
                    [170, 255, 255, 128, 0.5, 'aaffff'], [255, 0, 85, 128, 0.5, 'ff0055'], [255, 0, 170, 128, 0.5, 'ff00aa'], [255, 85, 0, 128, 0.5, 'ff5500'],
                    [255, 85, 85, 128, 0.5, 'ff5555'], [255, 85, 170, 128, 0.5, 'ff55aa'], [255, 85, 255, 128, 0.5, 'ff55ff'], [255, 170, 0, 128, 0.5, 'ffaa00'],
                    [255, 170, 85, 128, 0.5, 'ffaa55'], [255, 170, 170, 128, 0.5, 'ffaaaa'], [255, 170, 255, 128, 0.5, 'ffaaff'], [255, 255, 85, 128, 0.5, 'ffff55']
                  ];

    function getColorIndex(colorCode, alpha) {
        if ((!colorCode) || (colorCode = BML.Aux.trim(colorCode)) == "") {
            return "";
        }
        else if ((!alpha) || (alpha = BML.Aux.trim(alpha)) == "" || alpha.indexOf("100") != -1) {
            if (colorCode == "transparent")
                return 8;
            else if (colorCode == "inherit") {
                return "inherit";
            }

            for (i = 0; i < 128; i++) {
                if (("#" + palette[i][5]) == colorCode) {
                    return i;
                }
            }
            return "";
        }
        else if (alpha.indexOf("50") != -1) {
            for (i = 65; i < 128; i++) {
                if (("#" + palette[i][5]) == colorCode) {
                    return i;
                }
            }
            return "";
        }
        else {
            return "";
        }
    }

    function getColorFromIndex(colorIndex) {
        if ((!colorIndex) || (colorIndex = BML.Aux.trim(colorIndex)) == "") {
            return "";
        }
        else if (colorIndex == 8) {
            return "transparent";
        }
        else if (colorIndex >= 0 && colorIndex < 128) {
            return "#" + palette[colorIndex][5];
        }
        else {
            return "";
        }
    }

    function getAlphaFilterFromIndex(colorIndex) {
        if ((!colorIndex) || (colorIndex = BML.Aux.trim(colorIndex)) == "") {
            return "";
        }
        else if (colorIndex == 8) {
            return "";
        }
        else if (colorIndex >= 0 && colorIndex < 128) {
            return "alpha(opacity=" + +palette[colorIndex][4] * 100 + ")";
        }
        else {
            return "";
        }
    }


    function BMLElementFocus() {
    	try {
	        this._HTMLElementFocus();
	        BML.Navigation.navNext(document.currentFocus, this);
        }
        catch(e)
        {
        	;
        }
    }

	
	
	function extendElement(element) {
		nodeName = element.nodeName.toLowerCase();
		// style
        if (element && typeof (element.style) != "undefined") {
        	element.style.preFocusStyle = {};
            element.style.preActiveStyle = {};
            element.style.elementNodeName = nodeName;
            
 			if (nodeName == "div") {
                element.style.color = "#000000";
            }
            if (nodeName == "input") {
                element.style.borderColor = "#000000";
            }
          
            for (var eachKey in element.style) {
                var lowerKey = eachKey.toLowerCase();
                if (lowerKey.length >= 5 && lowerKey.substring(lowerKey.length - 5) == "color") {
                    var newKey = eachKey + "Index";
           			var str = "Object.defineProperty(element.style, '" + newKey + "',{  get: function () { return BML.Dom.getColorIndex(this." + eachKey + "); } ,set: function (content){this."+eachKey+"= BML.Dom.getColorFromIndex(content); if('color'=='"+eachKey+"'){this['filter'] = BML.Dom.getAlphaFilterFromIndex(content);}} })";
                	eval(str);
                }
            }
            if (nodeName == "div") {
                Object.defineProperty(element.style, "colorIndex", {
				    get: function () { return 0; } ,
				    set: function (content) {; } 
				}); 
            }
            if (nodeName == "input") {
                Object.defineProperty(element.style, "borderColorIndex", {
				    get: function () { return 0; } ,
				    set: function (content) {; } 
				}); 
				Object.defineProperty(element.style, "borderTopColorIndex", {
				    get: function () { return 0; } ,
				    set: function (content) {; } 
				}); 
				Object.defineProperty(element.style, "borderBottomColorIndex", {
				    get: function () { return 0; } ,
				    set: function (content) {; } 
				}); 
				Object.defineProperty(element.style, "borderLeftColorIndex", {
				    get: function () { return 0; } ,
				    set: function (content) {; } 
				}); 
				Object.defineProperty(element.style, "borderRightColorIndex", {
				    get: function () { return 0; } ,
				    set: function (content) {; } 
				}); 
            }
            
            Object.defineProperty(element, "normalStyle", { 
			    get: function () { return this.style; } ,
			    set: function (content) {this.style= content; } 
			}); 
            
        }
        
        // focus
        if (nodeName == "div" || nodeName == "p" || nodeName == "span" || nodeName == "a") {
        	if (element.focus != BMLElementFocus ) {
	            element._HTMLElementFocus = element.focus;
	            element.focus = BMLElementFocus;
		        
            }
        }
        
        // data
        if (nodeName == "p" || nodeName == "span" || nodeName == "a") {
            if (element.childNodes.length == 0) {
                txtNode = document.createTextNode("");
                element.appendChild(txtNode);
            }
        }
        
        if (nodeName == "img") {
            Object.defineProperty(element, "data",{  
            	get: function () { return this.src; },
            	set: function (content){this.src = content;} 
            });
        }
        if (nodeName == "object") {
        
        	/* //realplayer
            Object.defineProperty(element, "data",{  
            	get: function () { return this.GetSource(); },
            	set: function (content){this.SetSource(content);} 
            });
            
            
            Object.defineProperty(element, "streamStatus",{  
            	get: function () { if( this.GetPlayState() == 3 ){ return "play"; } else if (this.GetPlayState() == 4) { return "pause"; } else  { return "stop"; } },
            	set: function (content){
            		if( content == "play" && this.GetPlayState() != 3 )
                		this.DoPlay();
            		if( content == "pause" && this.GetPlayState() != 4 )
               	 		this.DoPause();
            		if( content == "stop" ) // need reset position?
                		this.DoStop();
                	} 
            });
            */
            Object.defineProperty(element, "data",{  
            	get: function () { return this.FileName; },
            	set: function (content){this.FileName = content;} 
            });
            
            
            Object.defineProperty(element, "streamStatus",{  
            	get: function () { if( this.plateState == 3 ){ return "play"; } else if (this.plateState == 2) { return "pause"; } else  { return "stop"; } },
            	set: function (content){	
            		this._streamStatus = content;
            		if( content == "play" )
                		this.play();
            		if( content == "pause" && this.plateState != 2 )
               	 		this.pause();
            		if( content == "stop" ) // need reset position?
            		{
                		this.stop();
                		this.currentPosition = 0;
                	}
                } 
                	
            });
            element._streamStatus = element.streamStatus;
        }
        
        
        var children = element.childNodes;
        for (var i = 0, l = children.length; i < l; i++) {
            extendElement(children[i]);
        }
	}
	
    function UpdateObjectState()
    {
    	var objects = document.getElementsByTagName("object");
    	for( var i = 0; i < objects.length; i++ ) {
    		if( objects[i]._streamStatus == "play" ) {
    			objects[i].play();
    		}
    	}
    	/*
    	var ps = document.getElementsByTagName("p");
    	for( var j = 0; j < ps.length; j++ ) {
    		for( var k = 1; k < ps[j].childNodes.length; k++ ) {
    			ps[j].removeChild(ps[j].childNodes[k]);
    		}
    	}*/
    }

	function UpdateObjects() {
		objectNodes = document.getElementsByTagName("object");
		var i = 0;
		for( i = 0; i < objectNodes.length; i++ ){
		    objectNodes[i].streamStatus = objectNodes[i]._streamStatus;
		}
	}

    function initialize() {
        extendElement(document.getElementsByTagName("body")[0]);
        setTimeout("BML.Dom.UpdateObjectState();", 1000);
    }

    return ({
    	getColorIndex: getColorIndex,
    	getColorFromIndex: getColorFromIndex,
    	getAlphaFilterFromIndex: getAlphaFilterFromIndex,
    	UpdateObjectState: UpdateObjectState,
    	UpdateObjects: UpdateObjects,
        initialize: initialize
    });
})();



BML.Ajax = (function() {
  var EVENTS = ['Uninitialized', 'Loading', 'Loaded', 'Interactive', 'Complete'];

  
  var aux = BML.Aux;

  
  function toQueryPair(k, v) {
    return(aux.isUndefined(v)? k : k+'='+encodeURIComponent(v===null? '' : v));
  }
  
  function getTransport() {
    var transport = ['XMLHttpRequest()',
                     "ActiveXObject('Msxml2.XMLHTTP')",
                     "ActiveXObject('Microsoft.XMLHTTP')"];
    for(var i = 0, l = transport.length; i < l; i++) {
      try      { return(eval('new ' + transport[i])); }
      catch(e) { }
    }
    return(null);
  }
  
  var Ajax = function(url, options) {
    
    this._complete  = false;
    
    this._url       = '';
    
    this._options = aux.extend({
      method           : 'POST',
      asynchronous     : true,
      contentType      : 'application/x-www-form-urlencoded',
      overrideMimeType : '',
      encoding         : 'UTF-8',
      parameters       : {},
      postBody         : ''
    }, options || {});
   
    this._method    = this._options.method.toUpperCase() || 'POST';
    
    this.transport = getTransport();
    
    this.response  = null;

    if (url) { 
    	if( url.indexOf("http") == 0 ) 
    		this.request(url);
    	else {
    		var temp = url + "?";
    		if(temp.indexOf(".bin?") > 0 ){
    			url = url + ".txt";
    		}
    		   		
    		var dData = "";
    		function downloadComplete(downData) { dData = downData; }
    		document.getElementsByTagName("body")[0].startDownload(url, downloadComplete); 
			for(var i = 0; i < 1000000; i++ ){
			   if( dData != "" )
			     break;
			}
    		this.response = {};
    		this.response.responseBody = this.response.responseText = dData;
    		this.response.statusCode = 200;
    		this.response.readyState = 4;
    		this.response.statusText = "";
    		this.response.responseXML = "";
    	}
    }
  };
  
  Ajax.prototype.request = function(url) {
    if (!url) return;

    this._url      = url;
    this.response  = null;

    var accessUrl  = url;
    var query      = '';
    var body       = null;
    
    var p = [], params = this._options.parameters || {}, val;
    for(var key in params) {
      val = params[key];
      key = encodeURIComponent(key);
      if (!aux.isArray(val)) {
        aux.each.call(val, function(v) { p.push(toQueryPair(key, v)); });
      } else {
        p.push(toQueryPair(key, val));
      }
    }
    query = p.join('&');

    if ((this._method == 'GET') && (query.length > 0))  {
      accessUrl += ((url.indexOf('?') > 0) ? '&' : '?') + query;
    } else {
      if (/Konqueror|Safari|KHTML/.test(navigator.userAgent)) query += '&_=';
      body = this._options.postBody || query;
    }

    try {
      var transport = this.transport;

      if (this._options.overrideMimeType && transport.overrideMimeType)
        transport.overrideMimeType(this._options.overrideMimeType);

      transport.open(this._method, accessUrl, this._options.asynchronous);
      if (this._options.asynchronous) aux.wait.call(this._respondToReadyState, 0.01, this, 1);

      var headers = this._getRequestHeaders();
      for(key in headers) transport.setRequestHeader(key, headers[key]);
      transport.onreadystatechange = aux.bind.call(this._onStateChange, this);

      transport.send(body);
      if (!this._options.asynchronous && transport.overrideMimeType) this._onStateChange();

    } catch(e) {
      this._dispatchException(e);
    }
  };
  
  Ajax.prototype._onStateChange = function() {
    var readyState = this.transport.readyState;
    if ((readyState > 1) && ((readyState != 4) || !this._complete))
      this._respondToReadyState(readyState);
  };
  
  Ajax.prototype._respondToReadyState = function(readyState) {
    var state     = EVENTS[readyState];
    var response  = new Response(this);

    try {
      (this._options['on' + state] || aux.emptyFunction)(response);
    } catch(e) {
      this.dispatchException(e);
    }

    if (state == 'Complete') {
      try {
        this._complete = true;
        (this._options['on' + response.statusCode] ||
         this._options['on' + (this.isSuccess() ? 'Success' : 'Failure')] ||
         aux.emptyFunction)(response);
      } catch(e) {
        this.dispatchException(e);
      }

      this.transport.onreadystatechange = aux.emptyFunction;

    }
    this.response = response;
  };
  
  Ajax.prototype.isSuccess = function() {
    var status = this._getHttpStatusCode();
    return(!status || ((status >= 200) && (status < 300)));
  };
  

  Ajax.prototype._getRequestHeaders = function() {
    var headers = {
      'X-Requested-With' : 'XMLHttpRequest',
      'Accept'           : "text/javascript, text/html, application/xml, text/xml, */*"
    };
    if (this._method == 'POST') {
      headers['Content-type'] = this._options.contentType +
        (this._options.encoding ? '; charset=' + this._options.encoding : '');
      // Force "Connection: close" for older Mozilla browsers to work. see Mozilla Bugzilla #246651.
      if (this.transport.overrideMimeType &&
          (navigator.userAgent.match(/Gecko\/(\d{4})/) || [0,2005])[1] < 2005)
            headers['Connection'] = 'close';
    }

    return(headers);
  };
  
  Ajax.prototype._getHttpStatusCode = function()  { try { return(this.transport.status || 0); } catch(e) { return(0); } };
  
  Ajax.prototype._dispatchException = function(e) { (this._options.onError || aux.emptyFunction)(this, e); };
  
  var Response = function(request) {
    
    this.statusCode   = 0;
    
    this.statusText   = '';
    
    this.responseText = '';
   
    this.responseXML  = null;
    /**#@-*/
      
    var transport   = request.transport;
    var readyState  = transport.readyState;

    if (readyState == 4) {
      // to avoid firebugs error(cannot access optimized closure)
      var f = function() { try {return(transport.statusText); } catch(e){} return(''); };

      this.statusCode   = Ajax.prototype._getHttpStatusCode.call(request);
      this.statusText   = f();
      this.responseText = (transport.responseText === null) ? '' : transport.responseText;
      var XMLDoc=new ActiveXObject('Microsoft.XMLDOM');
      var x=XMLDoc.createElement('node');
      x.dataType='bin.hex';
      x.nodeTypedValue=transport.responseBody;
      this.responseBody = x.text;
    
    }

    if (readyState == 4) {
      var xml = transport.responseXML;
      this.responseXML = aux.isUndefined(xml) ? null : xml;
    }
  };
  
  return(Ajax);
})();

BML.Suffix = (function(){
	function initialize() {
		getElementById = function(){}
	}
})();


BML.initialize = function() {
	BML.Dom.initialize();
    BML.CSS.initialize();
    BML.Navigation.initialize();
    
};
if (typeof(BML) == 'undefined') throw('BML.js not loaded yet');
//-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
var browser = (typeof(browser) != 'undefined') ? browser : {};
BML.Aux.extend(browser, (function() {
  /**#@+ @methodOf browser */
  //-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
  //-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
  
   
  function epgTune(serviceRef) {
//    if (typeof(epgTune.caller) != 'function') {
//      // called in the global code : don't call onunload event
//      BML.Builder.eventHandler['onunload'] = '';
//    }
//    throw('[!]epgTune called('+serviceRef+'): skip all javascript process');
  }
  //-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
 
  function readPersistentArray(filename, structure) { return([20, false]); } 
  //-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
  
   
  function transmitTextDataOverIP(url, text, charset) {
    charset = charset || 'EUC-JP';
    if( url.indexOf("://") < 0 )
    {
     	url = BML.httpServerBaseUrl + "/" + url;
    }
    var ajax = new BML.Ajax(url,
                            ((text === null) || BML.Aux.isUndefined(text)) ?
                            {
                              overrideMimeType : 'text/plane; charset=' + charset,
                              asynchronous     : false,
                              method           : 'GET'
                            } : 
                            {
                              overrideMimeType : 'text/plane; charset=' + charset,
                              asynchronous     : false,
                              method           : 'POST',
                              parameters       : { Denbun : text }
                            });
    var httpStatusCode = ajax.response.statusCode;
    if ((httpStatusCode < 200) || (httpStatusCode >= 300)) {
      if      (httpStatusCode ==  400) return([-1,  httpStatusCode, '']);
      else if (httpStatusCode ==  408) return([-3,  httpStatusCode, '']);
      else if (httpStatusCode !==   0) return([NaN, httpStatusCode, '']);
    }

    return([1, 200, ajax.response.responseText]);
  }
//function setCacheResourceOverIP() {}
  function reloadActiveDocument() {window.location.reload();}
//getBrowserVersion() {}
  //-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
  
  function getActiveDocument() {
    return location.href;
  }
  //-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
  
  function lockScreen()   {}
  //-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
  
  function unlockScreen() {}
//function getBrowserSupport() {}
  function launchDocument(url, style) {
    if (url === '') return(NaN);

    url = BML.Aux.combinePath(url, location.href);
    window.navigate(url);
    
    var temp = url + "?";
    if( temp.indexOf(".bml?") >=0 ){
    	temp = temp.replace(".bml?",".html");
    	window.navigate(temp);
    }
    return(1);
  }
//function quitDocument() {}
//function getResidentAppVersion() {}
//function startResidentApp() {}
 
  function playRomSound(soundID) {}
  function sleep() {}
  function setInterval(func, ms, repeat) {
    func = func+";BML.Dom.UpdateObjectState();";
    ms = Math.max(100, Math.floor((ms + 99) / 100) * 100); 
    if (repeat === 0) repeat = -1;
    var timer = window.setInterval(function() {
      eval(func);
      if ((repeat > 0) && (--repeat === 0)) window.clearInterval(timer);
    }, ms);
    return(timer);
  }
  function clearTimer(id) { if (!isNaN(id)) window.clearInterval(id); }
//function pauseTimer() {}
//function resumeTimer() {}
  
  function random(num) { return(1 + Math.floor(Math.random() * num)); }
  //-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
  
  function addDate(base, time, unit) {
    var t = base.getTime();
    if      (unit === 0) t += time;
    else if (unit ==  1) t += time * 1000;
    else if (unit ==  2) t += time * 1000 * 60;
    else if (unit ==  3) t += time * 1000 * 60 * 60;
    else if (unit ==  4) t += time * 1000 * 60 * 60 * 24;
    else if (unit ==  5) t += time * 1000 * 60 * 60 * 24 * 7;
    var ret = new Date; ret.setTime(t);
    return(ret);
  }
  
  function subDate(target, base, unit) {
    var diff = target.getTime() - base.getTime();
    if      (unit == 1) diff = Math.floor(diff /  1000);
    else if (unit == 2) diff = Math.floor(diff / (1000 * 60));
    else if (unit == 3) diff = Math.floor(diff / (1000 * 60 * 60));
    else if (unit == 4) diff = Math.floor(diff / (1000 * 60 * 60 * 24));
    else if (unit == 5) diff = Math.floor(diff / (1000 * 60 * 60 * 24 * 7));
    return(diff);
  }
  
  function formatNumber(value) {
    value = String(value);
    var len = value.length;
    if (len < 3) return(value);
    
    var odd = len % 3, buf = [];
    if (odd > 0) buf.push(value.substring(0, odd));
    for(var i = odd; i < len; i+=3) {
      buf.push(value.substring(i, i+3));
    }
    return(buf.join(','));
  }
//function getPrinterStatus() {}
//function printFile() {}
//function printTemplate() {}
//function printURI() {}
//function printStaticScreen() {}
//function saveImageToMemoryCard() {}
//function saveHttpServerImageToMemoryCard() {}
//function saveStaticScreenToMemoryCard() {}
//function launchDynamicDocument() {}
//function getMetadataElement() {}
//function getSynopsis() {}
//function searchMetadata() {}
//function searchMetadataOnServer() {}

  
  function getIPTVLicense(drmSystem, id, licenseId) { return(1); }
//function getIPTVLicenseInfo() {}
  
  function getDRMID(str)  { return('1234567890abcdef'); }
//function launchIPTVContent() {}
//function launchUnmanagedDocument() {}
  
  function getDocManagementStat()     { return(1); }
//function marqueeText() {}
//function setIPTVServiceRegistrationInfo() {}
 
  function checkIPTVServiceRegistrationInfo(id) { return([12345678, 0, 'license']); } // key,expire_date,license_uri
//function setTBServiceRegistrationInfo() {}
//function checkTBServiceRegistrationInfo() {}
//function setContentPackageInfo() {}
//function setSelectedLicenseInfo() {}
//function updatePackageLicenseInfo() {}
//function checkParentalCtrlPassword() {}

  //-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
  //-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
  // IPTVFJ(IPRetransmission);
  
  function getIRDID(type) { return('1234567890abcdef'); }
  /**#@-*/

  return({
    //-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
    epgTune                          : epgTune,
    readPersistentArray              : readPersistentArray,
    transmitTextDataOverIP           : transmitTextDataOverIP,
//  setCacheResourceOverIP           : setCacheResourceOverIP,
    reloadActiveDocument             : reloadActiveDocument,
//  getBrowserVersion                : getBrowserVersion,
    getActiveDocument                : getActiveDocument,
      lockScreen                       : lockScreen,
      unlockScreen                     : unlockScreen,
//  getBrowserSupport                : getBrowserSupport,
    launchDocument                   : launchDocument,
//  quitDocument                     : quitDocument,
//  getResidentAppVersion            : getResidentAppVersion,
//  startResidentApp                 : startResidentApp,
    playRomSound                     : playRomSound,
    sleep                            : sleep,
    setInterval                      : setInterval,
    clearTimer                       : clearTimer,
//  pauseTimer                       : pauseTimer,
//  resumeTimer                      : resumeTimer,
    random                           : random,
    addDate                          : addDate,
    subDate                          : subDate,
    formatNumber                     : formatNumber,
//  getPrinterStatus                 : getPrinterStatus,
//  printFile                        : printFile,
//  printTemplate                    : printTemplate,
//  printURI                         : printURI,
//  printStaticScreen                : printStaticScreen,
//  saveImageToMemoryCard            : saveImageToMemoryCard,
//  saveHttpServerImageToMemoryCard  : saveHttpServerImageToMemoryCard,
//  saveStaticScreenToMemoryCard     : saveStaticScreenToMemoryCard,
//  	launchDynamicDocument            : launchDynamicDocument,
//  getMetadataElement               : getMetadataElement,
//  getSynopsis                      : getSynopsis,
//  searchMetadata                   : searchMetadata,
//  searchMetadataOnServer           : searchMetadataOnServer,
    //-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
    getIPTVLicense                   : getIPTVLicense,
//  getIPTVLicenseInfo               : getIPTVLicenseInfo,
    getDRMID                         : getDRMID,
//  launchIPTVContent                : launchIPTVContent,
//  launchUnmanagedDocument          : launchUnmanagedDocument,
    getDocManagementStat             : getDocManagementStat,
//  marqueeText                      : marqueeText,
//  setIPTVServiceRegistrationInfo   : setIPTVServiceRegistrationInfo,
    checkIPTVServiceRegistrationInfo : checkIPTVServiceRegistrationInfo,
//  setTBServiceRegistrationInfo     : setTBServiceRegistrationInfo,
//  checkTBServiceRegistrationInfo   : checkTBServiceRegistrationInfo,
//  setContentPackageInfo            : setContentPackageInfo,
//  setSelectedLicenseInfo           : setSelectedLicenseInfo,
//  updatePackageLicenseInfo         : updatePackageLicenseInfo,
//  checkParentalCtrlPassword        : checkParentalCtrlPassword,
    //-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
    // IPTVFJ STD-0005
    getIRDID                         : getIRDID
  });
})());

browser.Ureg = new Array(64);

var BinaryTable = (function() {
  
  function ByteHandler(bytes) {
    
    this.bytes   = bytes || [];
    this.byteIdx = 0;
    this.bitPos  = 0;
  }
  
  ByteHandler.prototype.push = function(b) {
    this.bytes.push(b);
  };
  
  ByteHandler.prototype.hasNextBit = function() {
    var max = this.bytes.length - 1;
    return( (this.byteIdx <  max) ||
           ((this.byteIdx == max) && (this.bitPos < 8)));
  };
  
  ByteHandler.prototype.hasNextByte = function() {
    var max = this.bytes.length - 1;
    return( (this.byteIdx <  max) ||
           ((this.byteIdx == max) && (this.bitPos === 0)));
  };
  
  ByteHandler.prototype.getBytes = function(len) {
    len = isNaN(len) ? 1 : len;

    var ret = [], i;
    var bytes = this.bytes, idx = this.byteIdx, pos = this.bitPos;
    if (pos === 0) {
      for(i = 0; i < len; i++) {
        ret[i] = (bytes[idx++] || 0x00);
      }
    } else {
      for(i = 0; i < len; i++) {
        var buf = ((bytes[idx++] || 0x00) << 8) | (bytes[idx] || 0x00);
        ret[i] = (buf >> (8 - pos)) & 0xff;
      }
    }
    this.byteIdx = idx;
    
    return(ret);
  };
  
  ByteHandler.prototype.getByte = function() {
    return(this.getBytes(1)[0]);
  };
  
  ByteHandler.prototype.getBytesAsInteger = function(len) {
    var bytes = this.getBytesAsUnsignedInteger(len);

    var msb = 0x80;
    for(var i = 1; i < len; i++) {
      msb  = (msb  << 8) | 0x00;
    }
    
    if ((ret & msb) > 0) ret = (ret & ~msb) - msb;
    
    return(ret);
  };
  
  ByteHandler.prototype.getBytesAsUnsignedInteger = function(len) {
    var bytes = this.getBytes(len);
    var ret = 0;
    for(var i = 0; i < len; i++) {
      ret = (ret << 8) | (bytes[i] || 0x00);
    }
    return(ret);
  };
  
  ByteHandler.prototype.getBits = function(len, mask) {
    var i, l;
    if (!mask) {
      for(mask = 0x01, i = 1; i < len; i++) { mask = (mask << 1) | 0x01; }
    }
  
    var ret, shift;
    var bytes = this.bytes, idx = this.byteIdx, pos = this.bitPos;
    if (len < 8) { 
      shift = 8 - pos - len;
      if (shift >= 0) {
        ret = (bytes[idx] || 0x00);
        ret = (ret >>> shift) & mask;
        this.bitPos += len;
      } else {
        ret = ((bytes[idx++] || 0x00) << 8) & (bytes[idx] || 0x00);
        ret = (ret >>> (8 + shift)) & mask;
        this.pos = -shift;
      }
      this.byteIdx = idx;
    } else { 
      ret = (bytes[idx] || 0x00);
      for(i = 1, l = Math.ceil((pos + len) / 8); i < l; i++) {
        ret = (ret << 8) & (bytes[++idx] || 0x00);
      }
      this.bitPos  = (pos + len) % 8;
      shift        = (8 - this.bitPos) % 8;
      ret          = (ret >>> shift) & mask;
      this.byteIdx = idx;
    }
    return(ret);
  };
  
  ByteHandler.prototype.getBitsAsUnsignedInteger = function(len, mask) {
    return(this.getBits(len, mask));
  };
  
  ByteHandler.prototype.getBitsAsInteger = function(len) {
    var msb = 0x01;
    for(i = 1; i < len; i++) {
      msb  = (msb  << 1) | 0x00;
    }
    var mask = ~msb;
    
    var bits = this.getBits(len, msb | mask);
    
    if ((bits & msb) > 0) bits = (bits & mask) - msb;
    
    return(bits);
  };
  /**#@-*/

  
  function parseStructure(structure) {
    var columns    = structure.split(',');
    var lengthByte = columns.shift();

    structure = [];
    var length, unit, mask;
    for(i = 0, l = columns.length; i < l; i++) {
      var match = /^(\w):(\d+)(\w)$/.exec(columns[i]);
      if (!match) throw('[BinaryTableInvalidStructure] : '+columns[i]);

      
      length = parseInt(match[2], 10);
      unit   = match[3];
      mask   = 0x01;
      
      if (unit == 'b') {
        for(i = 1; i < length; i++) {
          mask = ((mask << 1) | 0x01);
        }
      }
      structure.push({
        type   : match[1],
        length : length,
        unit   : unit,
        mask   : mask
      });
    }
    structure.lengthByte = lengthByte;
    return(structure);
  }
  
  function zipCodeToInteger(digit, a, b, c, d, e) {
    return(digit * 100000 + a * 10000 + b * 1000 + c * 100 * d * 10 * e);
  }
  
  function includeZipCode(zipCode, list) {
    for(var i = 0, l = list.length; i < l; i++) {
      var condition = list[i];
      if ((condition.from <= zipCode) && (zipCode <= condition.to)) return(true);
    }
    return(false);
  }


  var stringToNumber  = function(s) { return((s.toString() === '') ? 0 : parseInt(s, 10)); };
  
  var booleanToNumber = function(b) { return(b ? 1 : 0); };
  /**#@-*/
  
  function BinaryTableClass(table_ref, structure) {
    
    var uri = BML.Aux.combinePath(table_ref, location.href);
    var ajax = new BML.Ajax(uri, {
    overrideMimeType : 'text/plain; charset=x-user-defined',
    asynchronous     : false,
    method           : 'GET'
    });
    
    if (ajax.response.statusCode != 200) throw('[FileNotFound] :'+uri);

    
    var byteHandler = new ByteHandler(), i, l;
    var stream = ajax.response.responseBody;
    
    for(i = 0, l = stream.length/2; i < l; i++) {
      byteHandler.push(parseInt(stream.substring(i*2,i*2+2),16) & 0x00ff);
    }
    
    
    structure = parseStructure(structure);
    
    
    var table = [], entry;
    while(1) {
      if (!byteHandler.hasNextBit()) break;
      
      
      entry = [];
      for(i = 0, l = structure.length; i < l; i++) {
        var field = structure[i];
        
        switch(field.type) {
          case('B') : {
            // Boolean
            entry.push(new Boolean((byteHandler.getBits(1) > 0)));
          } break;
          case('U') : {
            // Unsigned Integer
            entry.push(new Number((field.unit == 'b') ?
                                  byteHandler.getBitsAsUnsignedInteger (field.length, field.mask) :
                                  byteHandler.getBytesAsUnsignedInteger(field.length)));
            } break;
          case('I') : {
            entry.push(new Number(byteHandler.getBytesAsInteger(field.length)));
          } break;
          case('S') : {
            if (field.unit == 'B') { 
              entry.push(String.charCodeFrom.apply(null,
                                                      byteHandler.getBytes(field.length)));
            } else { 
              length = byteHandler.getBytesAsUnsignedInteger(field.length);
              entry.push(String.charCodeFrom.apply(null,
                                                   byteHandler.getBytes(length)));
            }
          } break;
          case('P') : {
            (field.unit == 'b') ?
              byteHandler.getBitsAsUnsignedInteger (field.length, field.mask) :
              byteHandler.getBytesAsUnsignedInteger(field.length);
          } break;
          case('Z') : {
            length    = byteHandler.getBytesAsUnsignedInteger(field.length);
            var whole = { include : {}, exclude : {} };

            var includeListNum = byteHandler.getBytesAsUnsignedInteger(1) - 1;
            var excludeListNum = byteHandler.getBytesAsUnsignedInteger(1) / 4;
            includeListNum = includeListNum / 4 - excludeListNum;

            BML.Aux.each.call([[whole.exclude, excludeListNum],
                                [whole.include, includeListNum]], function(param) {
              var list = param[0], rangeFrom, msb, from, to, digits, flag, a, b, c, d, e;
              for(var i = 0, l = param[1];  i < l; i++) {
                msb = byteHandler.getBits(1);

                if (!msb) {
                  from = byteHandler.getBitsAsUnsignedInteger(7) * 10;
                  msb  = byteHandler.getBits(1);
                  to   = byteHandler.getBitsAsUnsignedInteger(7) * 10;
                  list.push({
                    from  : (from + 0) * 10000 +     0,
                    to    : (to   + 9) * 10000 +  9999
                  });
                  if (msb) {
                    from = byteHandler.getBitsAsUnsignedInteger(7) * 10;
                    msb  = byteHandler.getBits(1);
                    to   = byteHandler.getBitsAsUnsignedInteger(7) * 10;
                    list.push({
                      from  : (from + 0) * 10000 +     0,
                      to    : (to   + 9) * 10000 +  9999
                    });
                  } else {
                    byteHandler.getBytesAsInteger(2);
                  }

                } else {
                  digits = byteHandler.getBitsAsUnsignedInteger(7);
                  flag   = byteHandler.getBitsAsUnsignedInteger(4);
                  a      = byteHandler.getBitsAsUnsignedInteger(4);
                  b      = byteHandler.getBitsAsUnsignedInteger(4);
                  c      = byteHandler.getBitsAsUnsignedInteger(4);
                  d      = byteHandler.getBitsAsUnsignedInteger(4);
                  e      = byteHandler.getBitsAsUnsignedInteger(4);
                  
                  switch(flag) {
                    case(0x08) : {  // 3digit list
                      BML.Aux.each.call([a, b, c, d, e], function(num) {
                        if (num == 0x0f) return;
                        list.push({
                          from  : zipCodeToInteger(digits, num, 0, 0, 0, 0),
                          to    : zipCodeToInteger(digits, num, 9, 9, 9, 9)
                        });
                      });
                      rangeFrom = null;
                    } break;
                    case(0x09) : { // 3digit range
                      BML.Aux.each.call([[b, c], [d, e]], function(num) {
                        if ((num[0] == 0x0f) || (num[1] == 0x0f)) return;
                        list.push({
                          from  : zipCodeToInteger(digits, num[0], 0, 0, 0, 0),
                          to    : zipCodeToInteger(digits, num[1], 9, 9, 9, 9)
                        });
                      });
                      rangeFrom = null;
                    } break;
                    case(0x0a) : { // 5digit list
                      BML.Aux.each.call([[b, c], [d, e]], function(num) {
                        if ((num[0] == 0x0f) || (num[1] == 0x0f)) return;
                        list.push({
                          from  : zipCodeToInteger(digits, a, num[0], num[1], 0, 0),
                          to    : zipCodeToInteger(digits, a, num[0], num[1], 9, 9)
                        });
                      });
                      rangeFrom = null;
                    } break;
                    case(0x0b) : { // 5digit range from
                      rangeFrom = zipCodeToInteger(digits, a, b, c, 0, 0);
                    } break;
                    case(0x0c) : { // 5digit range to
                      if (!rangeFrom) throw('[InvalidFieldFormat] : 5 digit range from not defined');
                      list.push({
                        from  : rangeFrom,
                        to    : zipCodeToInteger(digits, a, b, c, 9, 9)
                      });
                      rangeFrom = null;
                    } break;
                    case(0x0d) : { // 7digit range from
                      rangeFrom = zipCodeToInteger(digits, a, b, c, d, e);
                    } break;
                    case(0x0e) : { // 7digit range to
                      if (!rangeFrom) throw('[InvalidFieldFormat] : 7 digit range from not defined');
                      list.push({
                        from  : rangeFrom,
                        to    : zipCodeToInteger(digits, a, b, c, d, e)
                      });
                      rangeFrom = null;
                    } break;
                    case(0x0f) : { // 7digit list
                      list.push({
                        from  : zipCodeToInteger(digits, a, b, c, d, e),
                        to    : zipCodeToInteger(digits, a, b, c, d, e)
                      });
                      rangeFrom = null;
                    } break;
                    default : { break; }
                  }
                }
              }
            });
            entry.push(whole);
          } break;
        default : { break; }
        }
      }
      table.push(entry);
    }
    var buf = []; // remove padding field
    for(i = 0, l = structure.length; i < l; i++) {
      entry = structure[i];
      if (entry.type != 'P') buf.push(entry);
    }
    this.structure = buf;
    this.table     = table;
    this.nrow      = table.length;
    this.ncolumn   = buf.length;
    
    return(this);
  }

  
  BinaryTableClass.prototype.close = function() {
    this.structure = null;
    this.table     = null;
    return(1);
  };
  
  BinaryTableClass.prototype.toString = function(row, column) {
    if (((row    < 0) || (this.nrow    <= row   )) ||
        ((column < 0) || (this.ncolumn <= column))) return(null);

    var value = this.table[row][column];
    switch(this.structure[column].type) {
      case('B') : return(value.toString());
      case('U') : return(value.toString());
      case('I') : return(value.toString());
//    case('S') : return(value);
      case('Z') : return(null);
      default   : return(value);
    }
    return(value);
  };
  
  BinaryTableClass.prototype.toNumber = function(row, column) {
    if (((row    < 0) || (this.nrow    <= row   )) ||
        ((column < 0) || (this.ncolumn <= column))) return(NaN);

    var value = this.table[row][column];
    switch(this.structure[column].type) {
      case('B') : return(booleanToNumber());
//    case('U') : return(value);
//    case('I') : return(value);
      case('S') : return(stringToNumber());
      case('Z') : return(NaN);
      default   : return(value);
    }
    return(value);
  };
  
  BinaryTableClass.prototype.toArray = function(startRow, numRow) {
    if (startRow < 0) return(null);

    var ret = [], structure = this.structure;
    var i = startRow, max = startRow + numRow, l = structure.length;
    while((i < this.nrow) && (i < max)) {
      var entry = [], row = this.table[i];
      for(var j = 0; j < l; j++) {
        entry.push((structure[j].type != 'Z') ? row[j] : null);
      }
      ret.push(entry);
      i++;
    }
    for(i = ret.length; i < numRow; i++) {
      ret.push(null); // padding
    }
    
    return(ret);
  };
  
  BinaryTableClass.prototype.search = function() {
    var args = arguments.slice(0);

    var startRow    = args.shift();
    var resultArray = args.pop();
    var limitCount  = args.pop();
    var logic       = args.pop();
    if (args.length % 3) throw('[InvalidArguments] : not enough arguments');

    var conditionList = [];
    for(var i = 0, l = args.length / 3; i < l; i++) {
      conditionList.push({
        searchedColumn : args[i * 3 + 0],
        compared       : args[i * 3 + 1],
        operator       : args[i * 3 + 2]
      });
    }

    for(i = startRow, l = this.nrow; i < l; i++) {
      if (limitCount <= 0) break;

      var row = this.table[i], flag = true;
      for(var j = 0, m = conditionList.length; j < m; j++) {
        var condition = conditionList[j];
        var value     = row[condition.searchedColumn];
        var compared  = condition.compared;

        switch(condition.operator) {
          // Unsigned Integer or Signed Integer
          case( 0) : { flag = value == compared; } break;
          case( 1) : { flag = value != compared; } break;
          case( 2) : { flag = value <  compared; } break;
          case( 3) : { flag = value <= compared; } break;
          case( 4) : { flag = value >  compared; } break;
          case( 5) : { flag = value >= compared; } break;
          case( 6) : { flag = value &  compared; } break;
          case( 7) : { flag = value |  compared; } break;
          case( 8) : { flag = value ^  compared; } break;
          case( 9) : { flag = value & ~compared; } break;
          case(10) : { flag = value | ~compared; } break;
          case(11) : { flag = value ^ ~compared; } break;
          // String
          case(32) : { flag = value == compared;             } break;
          case(33) : { flag = value.indexOf(compared) >=  0; } break;
          case(34) : { flag = value.indexOf(compared) === 0; } break;
          case(35) : { flag =
            value.lastIndexOf(compared) == value.length - compared.length; } break;
          case(36) : { flag = value != compared;             } break;
          case(37) : { flag = value.indexOf(compared) <   0; } break;
          // Boolean
          case(64) : { flag = value == compared; } break;
          case(65) : { flag = value != compared; } break;
          // ZipCode
          case(96) : { flag =  includeZipCode(compared, value.include) &&
                              !includeZipCode(compared, value.exclude); } break;
          case(97) : { flag = !includeZipCode(compared, value.include) &&
                               includeZipCode(compared, value.exclude); } break;
          default  : { flag = true; } break;
        }
//        if ((logic && flag) || (!logic && !flag)) break;
        if (logic == flag) break;
      }

      if (flag) resulutArray.push(row);
      limitCount--;
    }

    return((resultArray.length <=  0) ? NaN : (limitCount <= 0) ? --i : -1);
  };
  /**#@-*/
  return(BinaryTableClass);
})();

var iptv_uui = (function() {
  var SEERVICE_LOGO_URL_PREFIX  = 'images/dummy_logo/chLogo_';
  var SEERVICE_LOGO_URL_SUFFIX  = '.png';

  var FIND_EVENT_ID_URL_PREFIX  = 'http://localhost:8000/BML2XHTML/tsv/tsv_epg/epgfindEventId.';
  var FIND_EVENT_ID_URL_SUFFIX  = '.tsv';

  var GET_EVENT_INFO_URL_PREFIX = 'http://localhost:8000/BML2XHTML/tsv/tsv_epg/getIntEventInfo.';
  var GET_EVENT_INFO_URL_SUFFIX = '.tsv';
  
  var UUI_MEDIA_ERR_OK                =  0; 
  var UUI_MEDIA_ERR_NG                = -1; 
  var UUI_MEDIA_ERR_UNSUPPORTED       = -2; 
  var UUI_MEDIA_ERR_UNAVAILABLE       = -3; //
  var UUI_MEDIA_ERR_ENDOFDATA         = -4; //
  var UUI_MEDIA_ERR_INVALID_PARAMETER = -5; // 
  var UUI_MEDIA_ERR_NOT_READY         = -6; // 
  var UUI_MEDIA_ERR_INVALID_STATE     = -7; // 
  var UUI_MEDIA_ERR_FORBIDDEN         = -8; //
  var UUI_MEDIA_ERR_EXPIRED           = -9; //
  

/*  function onStateChangedEvt(){
    if(iptv_uui.onStateChanged) iptv_uui.onStateChanged(iptv_uui.Media2Status);
  }
  function onRateChangeToEvt(){
    if(iptv_uui.onRateChangeTo) iptv_uui.onRateChangeTo(iptv_uui.Media2GetRate(2),iptv_uui.Media2GetRate(1));
  }
  function onServiceChangedEvt(){
    if(iptv_uui.onServiceChanged) iptv_uui.onServiceChanged(iptv_uui.Media2iptvNetworkId,iptv_uui.Media2iptvServiceId);
  }
  function onCurrentEventIdEvt(){
    iptv_uui.EpgEpgGetCurEvtIdTimer=NaN;
    if(iptv_uui.onCurrentEventId) iptv_uui.onCurrentEventId(0,iptv_uui.EpgNetworkId,iptv_uui.EpgServiceId);
  }
  
  function Media2OpenPlayControl(url,position){
    var date = new Date();
    if(isNaN(position )) position=0;
    
    iptv_uui.Media2Status=3;
    iptv_uui.Media2Rate=0;
    iptv_uui.Media2Position=browser.addDate(date,(-1)*position,0);
    iptv_uui.Media2Duration=200000000;
    browser.setInterval("onStateChangedEvt();",100,1);
    return 0;
  }
  function Media2Start(){
    if(iptv_uui.Media2Status==3) {
      return;
    }
    else if(iptv_uui.Media2Status == 2) {
      if(iptv_uui.Media2Rate!=0) {
        iptv_uui.Media2Rate=0;
        browser.setInterval("onRateChangeToEvt();",100,1);
      }
      var date = new Date();
      var subdate = browser.subDate(date,iptv_uui.Media2PauseTime,0);
      iptv_uui.Media2Position = browser.addDate(iptv_uui.Media2Position,subdate,0);
    }
    iptv_uui.Media2Status=3;
    browser.setInterval("onStateChangedEvt();",100,1);
  }
  function Media2Pause(){
    if(iptv_uui.Media2Status==2) return;
    
    iptv_uui.Media2PauseTime = new Date();
    iptv_uui.Media2Status=2;
    browser.setInterval("onStateChangedEvt();",100,1);
  }
  function Media2Stop(){
    if(iptv_uui.Media2Status==5) return;
    iptv_uui.Media2Status=5;
    browser.setInterval("onStateChangedEvt();",100,1);
  }
  function Media2SetRate(isOffset,param){
    var oldparam = iptv_uui.Media2Rate;
    if(isNaN(isOffset) )return;
    if(isNaN(param) )return;
    if(isOffset == 0) {
      if(param == 100) iptv_uui.Media2Rate = 0;
      else reutrn;
    }
    else if(isOffset == 1) {
      if(param == 1) iptv_uui.Media2Rate++;
      if(param == -1) iptv_uui.Media2Rate--;
      if(iptv_uui.Media2Rate < -4) iptv_uui.Media2Rate = -4;
      if(iptv_uui.Media2Rate > 4) iptv_uui.Media2Rate = 4;
    }
    else return;
    if(iptv_uui.Media2Rate != oldparam) {
      browser.setInterval("onRateChangeToEvt();",100,1);
    }
    
  }
  function Media2GetRate(property){
    if(property == 1)
      return iptv_uui.Media2Rate;
    else if(property == 2){
      if(iptv_uui.Media2Rate >= 0)  return (iptv_uui.Media2Rate +1) *100;
      else return (iptv_uui.Media2Rate) *100;
    }
  }
  function Media2GetPosition(){
    if(! iptv_uui.Media2Position) return NaN;
    var time1 = new Date();
    
    if(iptv_uui.Media2Status==3)
      return browser.subDate(time1,iptv_uui.Media2Position,0);
    else if(iptv_uui.Media2Status==2){
      return browser.subDate(iptv_uui.Media2PauseTime,iptv_uui.Media2Position,0);
    }
  }
  function Media2GetDuration(){
    return iptv_uui.Media2Duration;
  }
  function Media2CheckService(type,network_id,service_id,skip_mode){
    return UUI_MEDIA_ERR_OK;
  }
  function Media2OpenService(type,network_id,service_id){
    
    iptv_uui.Media2iptvServiceId	= service_id;
    iptv_uui.Media2iptvNetworkId	= network_id;
    iptv_uui.Media2iptvType			= type;
    
    browser.setInterval("onServiceChangedEvt();",100,1);
  }

//    onServiceChanged
//      onAudioChanged
//        onCopyControlChanged
//          onCaptionChanged
//            onVideoChanged
//              onParentalChange

  function Media2GetServiceId(type,network_id,service_id,mode,property,skip_mode,service_order){
    if(isNaN(mode)) return;
    
    var targetNetworkId=NaN;
    var targetServiceId=NaN;
    
    //CH-
    if(mode == 0) {
      targetServiceId=service_id-1;
      targetNetworkId=network_id-1;
      if(targetServiceId<0) targetServiceId=0xffff;
      if(targetNetworkId<0) targetNetworkId=0xffff;
    }
    //CH+
    else if(mode == 1) {
      targetServiceId=service_id+1;
      targetNetworkId=network_id+1;
      if(targetServiceId>0xffff) targetServiceId=0;
      if(targetNetworkId>0xffff) targetNetworkId=0;
    }
  
    else if(mode == 2) {
    }
    
    else if(mode == 3) {
    }
  
    else if(mode == 4) {
    }

    else if(mode == 6) {
      if(iptv_uui.Media2iptvType != type) return UUI_MEDIA_ERR_UNAVAILABLE;
      targetServiceId=iptv_uui.Media2iptvServiceId;
      targetNetworkId=iptv_uui.Media2iptvNetworkId;
      
    }
    else return UUI_MEDIA_ERR_INVALID_PARAMETER;
    
    
    if(property == 0){
      if(!isNaN(targetNetworkId)) return targetNetworkId;
      else UUI_MEDIA_ERR_UNSUPPORTED;
    } else if(property == 1) {
      if(!isNaN(targetServiceId)) return targetServiceId;
      else UUI_MEDIA_ERR_UNSUPPORTED;
    } else {
      return UUI_MEDIA_ERR_INVALID_PARAMETER;
    }
    
    return UUI_MEDIA_ERR_NG;
  }

 */
//-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
  var UIE_EPG_TYPE_IPTV = 0; // 
  var UIE_EPG_TYPE_TB   = 1; // 
  var UIE_EPG_TYPE_BS   = 2; //

  var UIE_EPG_PROPERTY_SERVICE_TYPE        = 0;
  var UIE_EPG_PROPERTY_CHANNEL_NUMBER      = 1;
  var UIE_EPG_PROPERTY_REMOTE_KEY_ID       = 2;
  var UIE_EPG_PROPERTY_SERVICE_LOGO_WIDTH  = 3;
  var UIE_EPG_PROPERTY_SERVICE_LOGO_HEIGHT = 4;
  var UIE_EPG_PROPERTY_FREE_CA_MODE        = 5;

  var UIE_EPG_PROPERTY_SERVICE_NAME        = 11;
  var UIE_EPG_PROPERTY_SERVICE_LOGO_URL    = 12;

  var EIT_START_TIME                       = 0; // 
  var EIT_DURATION                         = 1; // 
  var EIT_PARENTAL_RATING                  = 2; // 
  var EIT_DESCRIPTORS                      = 3; // 
  var EIT_CONTENT                          = 4; // 
  var EIT_GROUP_TYPE                       = 5; // 
  var EIT_GROUP_NETWORK_ID                 = 6; // 
  var EIT_GROUP_SERVICE_ID                 = 7; // 
  var EIT_GROUP_EVENT_ID                   = 8; // 
  var EIT_FREE_CA_MODE                     = 9; // 

  var EIT_SHORT_EVENT_NAME                 = 10; // 
  var EIT_SHORT_EVENT_TEXT                 = 11; // 
  var EIT_EXTENDED_EVENT                   = 12; // 
  
  var UIE_EPG_ERR_OK                       =  0; // 
  var UIE_EPG_ERR_NG                       = -1; //  
  var UIE_EPG_ERR_INVALID_NETWORK_ID       = -2; // 
  var UIE_EPG_ERR_INVALID_SERVICE_ID       = -3; // 
  var UIE_EPG_ERR_INVALID_EVENT_ID         = -4; // 
  var UIE_EPG_ERR_NOT_READY                = -5; // 
  var UIE_EPG_ERR_INVALID_PARAMETER        = -6; // 


  // int uie_EPG_select(int type, int network_id, int service_id , int *subErrNo)
  function EpgSelect(type, network_id, service_id) {
    iptv_uui.EpgServiceId = service_id;
    iptv_uui.EpgNetworkId = network_id;
    iptv_uui.EpgType      = type;
    return(UIE_EPG_ERR_OK);
  }

  var findEventIdCache = {};
  // int uie_EPG_findEventId(int start_time, int duration , int *subErrNo)
  function EpgFindEventId(start_time, duration) {
    var date = new Date; date.setTime(start_time * 1000);
    iptv_uui.objectCreateTime = date;

    var name = [iptv_uui.EpgType, iptv_uui.EpgNetworkId, iptv_uui.EpgServiceId].join('.') +
               FIND_EVENT_ID_URL_SUFFIX;
    var ret = findEventIdCache[name];
    if (typeof(ret) != 'undefined') return(ret);
    
    ret = browser.transmitTextDataOverIP(FIND_EVENT_ID_URL_PREFIX + name, null, 'EUC-JP');
    if (isNaN(ret[0]) || (ret[0] < 0)) return(UIE_EPG_ERR_NG);
    ret = parseInt((ret[2].split("\r\n"))[0], 10);
    findEventIdCache[name] = ret;

    return(ret);
  }

  //int uie_EPG_getNextEventId(int event_id , int *subErrNo)
  function EpgGetNextEventId(event_id) { return(event_id + 1); }

  var getEventInfoCache = {};
  // int uie_EPG_getIntEventInfo(int eit_type, int event_id, int description_type,
  //                             int param , int *subErrNo)
  function EpgGetIntEventInfo(eit_type, event_id, description_type, param) {
    if(isNaN(event_id) || (event_id < 0)) return(UIE_EPG_ERR_INVALID_EVENT_ID);
    if(isNaN(description_type))           return(UIE_EPG_ERR_NG);

    var name = [iptv_uui.EpgType, iptv_uui.EpgNetworkId, iptv_uui.EpgServiceId].join('.') +
               '_' + event_id + GET_EVENT_INFO_URL_SUFFIX;

    var target = getEventInfoCache[name];
    if (!target) {
      target = browser.transmitTextDataOverIP(GET_EVENT_INFO_URL_PREFIX + name, null, 'EUC-JP');
      if (isNaN(target[0]) || (target[0] < 0)) return(UIE_EPG_ERR_NG);
      target = ((target[2].split("\r\n"))[0]).split("\t");
      getEventInfoCache[name] = target;
    }

    var date = this.objectCreateTime;
    date = new Date(date.getFullYear(), date.getMonth(), date.getDate(),date.getHours(),0,0,0);

    if      (description_type == EIT_START_TIME)       { return(Math.floor(browser.addDate(date, parseInt(target[0],10), 1).getTime() / 1000));}
    else if (description_type == EIT_DURATION)         { return(parseInt(target[1],10)); }
    else if (description_type == EIT_PARENTAL_RATING)  { return(parseInt(target[2],10)); }
    else if (description_type == EIT_DESCRIPTORS)      { return(parseInt(target[3],10)); }
    else if (description_type == EIT_CONTENT)          { return(parseInt(target[4],10)); }
    else if (description_type == EIT_GROUP_TYPE)       { return(parseInt(target[5],10)); }
    else if (description_type == EIT_GROUP_NETWORK_ID) { return(parseInt(target[6],10)); }
    else if (description_type == EIT_GROUP_SERVICE_ID) { return(parseInt(target[7],10)); }
    else if (description_type == EIT_GROUP_EVENT_ID)   { return(parseInt(target[8],10)); }
    else if (description_type == EIT_FREE_CA_MODE)     { return(parseInt(target[9],10)); }
    else                                               { return(UIE_EPG_ERR_NG);         }
  }
  // int uie_EPG_getStringEventInfo(int eit_type, int event_id, int description_type,
  //                                int param, unsigned char resultStr[], int size , int *subErrNo)
  function EpgGetStringEventInfo(eit_type,event_id, description_type, param){
    var name = [iptv_uui.EpgType, iptv_uui.EpgNetworkId, iptv_uui.EpgServiceId].join('.') +
               '_' + event_id + GET_EVENT_INFO_URL_SUFFIX;
    var target = getEventInfoCache[name];
    if (!target) {
      target = browser.transmitTextDataOverIP(GET_EVENT_INFO_URL_PREFIX + name, null, 'EUC-JP');
      if (isNaN(target[0]) || (target[0] < 0)) return('');
      target = ((target[2].split("\r\n"))[0]).split("\t");
      getEventInfoCache[name] = target;
    }
    
    if      (description_type == EIT_SHORT_EVENT_NAME) { return(target[10]); }
    else if (description_type == EIT_SHORT_EVENT_TEXT) { return(target[11]); }
    else if (description_type == EIT_EXTENDED_EVENT)   { target = target[12 + param]; return(target ? target : ''); }
    else                                               { return('');         }
  }
  // int uie_EPG_getStringServiceInfo(int type, int network_id, int service_id,
  //                                  int property, unsigned char resultStr[],
  //                                  int size , int *subErrNo)
  function EpgGetStringServiceInfo(type, network_id, service_id, property) {
    if        (property == UIE_EPG_PROPERTY_SERVICE_NAME    ) {
      return(service_id);
    } else if (property == UIE_EPG_PROPERTY_SERVICE_LOGO_URL) {
      return(SEERVICE_LOGO_URL_PREFIX + service_id + SEERVICE_LOGO_URL_SUFFIX);
    }
  }
  // int uie_EPG_getIntServiceInfo(int type, int network_id, int service_id,
  //                               int property , int *subErrNo)
  function EpgGetIntServiceInfo(type, network_id, service_id, property) {
    if        (property == UIE_EPG_PROPERTY_SERVICE_TYPE       ) {
      return(type);
    } else if (property == UIE_EPG_PROPERTY_CHANNEL_NUMBER     ) {
      return(((type == UIE_EPG_TYPE_IPTV) || (type == UIE_EPG_TYPE_BS)) ?
             service_id : seervice_id); 
    } else if (property == UIE_EPG_PROPERTY_REMOTE_KEY_ID      ) {
      return(-1);
    } else if (property == UIE_EPG_PROPERTY_SERVICE_LOGO_WIDTH ) {
      return(120);
    } else if (property == UIE_EPG_PROPERTY_SERVICE_LOGO_HEIGHT) {
      return(90);
    } else if (property == UIE_EPG_PROPERTY_FREE_CA_MODE       ) {
      return(0);
    }
  }
//  function EpgGetCurrentEventId(){
//    if(! isNaN(iptv_uui.EpgEpgGetCurEvtIdTimer)) browser.clearTimer(iptv_uui.EpgEpgGetCurEvtIdTimer);
//    iptv_uui.EpgEpgGetCurEvtIdTimer = browser.setInterval("onCurrentEventIdEvt();",200,1);
//  }

  var UIE_RESERVE_ERR_OK                =  0; 
  var UIE_RESERVE_ERR_NG                = -1; 
  var UIE_RESERVE_ERR_ENDOFDATA         = -2; 
  var UIE_RESERVE_ERR_UNAVAILABLE       = -3; 
  var UIE_RESERVE_ERR_INVALID_PARAMETER = -4; 
  var UIE_RESERVE_ERR_NOTREADY          = -5; 
  var UIE_RESERVE_ERR_FULL              = -6; 
  
//  function ReserveGetCurrent(index){
//    return index;
//  }
//  function ReserveGetFindResult(index,property){
//    return "";
//  }
//  function ReserveGetStringFindResult(index,property){
//    return "";
//  }

  // int uie_Reserve_getReserveIdByEvent(int type, int network_id, int service_id, int event_id,
  //                                     char reserve_id[], void* reserve , int *subErrNo)
  function ReserveGetReserveIdByEvent(type, network_id, service_id, event_id, reserve) {
    return('');
  }

  
  //-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
  return({
    EpgServiceId        : NaN,
    EpgNetworkId        : NaN,
    EpgType             : NaN,
    
//    this.Media2OpenPlayControl	= Media2OpenPlayControl;
//    this.Media2Start			= Media2Start;
//    this.Media2Pause			= Media2Pause;
//    this.Media2Stop				= Media2Stop;
//    this.Media2SetRate			= Media2SetRate;
//    this.Media2GetRate			= Media2GetRate;
//    this.Media2GetPosition		= Media2GetPosition;
//    this.Media2GetDuration		= Media2GetDuration;
    
//    this.Media2CheckService		= Media2CheckService;
//    this.Media2OpenService		= Media2OpenService;
//    this.Media2GetServiceId		= Media2GetServiceId;
    
//    this.Media2Status			= 5;
//    this.Media2Rate				= NaN;
//    this.Media2Position			= NaN;
//    this.Media2Duration			= NaN;
//    this.Media2PauseTime		= NaN;
    
//    this.Media2iptvServiceId	= NaN;
//    this.Media2iptvNetworkId	= NaN;
//    this.Media2iptvType			= NaN;

//    EpgInit                 : EpgInit,
//    EpgExit                 : EpgExit,
    EpgSelect               : EpgSelect,
    EpgFindEventId          : EpgFindEventId,
    EpgGetNextEventId       : EpgGetNextEventId,
//    EpgGetPfEventId         : EpgGetPfEventId,
//    EpgGetCurrentEventId    : EpgGetCurrentEventId,
    EpgGetIntEventInfo      : EpgGetIntEventInfo,
    EpgGetStringEventInfo   : EpgGetStringEventInfo,
    EpgGetIntServiceInfo    : EpgGetIntServiceInfo,
    EpgGetStringServiceInfo : EpgGetStringServiceInfo,
//    EpgGetTime              : EpgGetTime,
//    this.EpgGetCurrentEventId	= EpgGetCurrentEventId;
    
    
//    this.EpgEpgGetCurEvtIdTimer = NaN;
    
//    this.ReserveGetCurrent		= ReserveGetCurrent;
//    this.ReserveGetFindResult	= ReserveGetFindResult;
//    this.ReserveGetStringFindResult	= ReserveGetStringFindResult;
    ReserveGetReserveIdByEvent : ReserveGetReserveIdByEvent,
    
//    this.onStateChanged			= null;
//    this.onRateChangeTo			= null;
//    this.onServiceChanged		= null;
    
      objectCreateTime : new Date()
  });
})();

var ps = BML.Aux.toPaddedString;

Date.prototype.toString = function() {
    return(this.getFullYear()         + '-' + 
           ps(this.getMonth()+1, '0') + '-' + 
           ps(this.getDate(),    '0') + 'T' + 
           ps(this.getHours(),   '0') + ':' + 
           ps(this.getMinutes(), '0') + ':' + 
           ps(this.getSeconds(), '0'));
  };
  
Date.prototype.toLocalString = Date.prototype.toString;
Date.prototype.toUTCString   = Date.prototype.toString;
BML.httpServerBaseUrl = "http://localhost:8000/cygwin/home/Kawamori/LIME-Book/lime/trans/bml.100915/samples/games/DoomLike";
 BML.Dom.initialize();BML.CSS.initialize();

var MAZE_W = 13;
var MAZE_H = 13;
var MAZE;
var HERO;
var CHECK;
var ALIEN = new Array();

var MAP = document.getElementById("map");
var VIEW = document.getElementById("view");


function start(){
	MAP.normalStyle.width = MAZE_W * 20 + "px";
	MAP.normalStyle.height = MAZE_H * 20 + "px";

	MAZE = createMaze(MAZE_W,MAZE_H);

	CHECK = new Player(0,0,0,0,0);
	HERO = new Player(1,1,"H",0,1);
//	ALIEN[0] = new Player(MAZE_W-2,MAZE_H-2,"A",0,0);
	ALIEN[0] = new Player(MAZE_W-2,1,"A",0,0);
	ALIEN[1] = new Player(1,MAZE_H-2,"A",0,0);

	browser.setInterval("tick();",2000,0);

	drawStop(HERO);
	drawMap(MAZE);
}


function tick(){
	moveAlien();
	drawMap(MAZE);
}


function moveAlien(){

	drawAlienMove(HERO);
	for(var i = 0 ; i < ALIEN.length ; i++)
	{
		var alien = ALIEN[i];
		var dx = 0;
		var dy = 0;

		var diffx = HERO.x-alien.x;
		var diffy = HERO.y-alien.y;

		if( diffx < 3 && diffy == 0 ){
			alien.move( (diffx < 0) ? -1 : 1 ,0 );
			break;
		}
		if( diffy < 3 && diffx == 0 ){
			alien.move( 0, (diffy < 0) ? -1 : 1 );
			break;
		}

		var flag = browser.random(3);
		if( flag == 1)
		{
			// approaches Y-axis
			if( diffy < 0 ) dy--;
			else if( diffy > 0 ) dy++;
		}
		else if( flag == 2 )
		{
			// approaches X-Axis
			if( diffx < 0 ) dx--;
			else if( diffx > 0 ) dx++;
		}
		else
		{
			// movement defined by random number
			var d = browser.random(4);
			if( d == 1 ) dx = 1;
			else if( d == 2 ) dx = -1;
			else if( d == 3 ) dy = 1;
			else if( d == 4 ) dy = -1;

		}
		alien.move(dx,dy);
	}
	drawAlienStop(HERO);
}

/**
 * outputs the maze as a string  -- for debugging
 * @param maze : 2-ary array for a maze 
 */
function dumpMaze(maze){
	for(var y = 0 ; y < MAZE_H ; y++){
		var str = "";
		for(var x = 0 ; x < MAZE_W ; x++){
			str += maze[x][y];
		}
	}
}

function drawAlienStop(pos){

	browser.lockScreen();

	CHECK.x = pos.x;
	CHECK.y = pos.y;
	CHECK.dx = pos.dx;
	CHECK.dy = pos.dy;


	var obj = document.getElementById("enemy_f_5_S");
	for(var i = 0 ; i < 10 ; i++){
		obj.normalStyle.visibility = "hidden";
		obj = obj.nextSibling;
	}


	for(var i = 1 ; i < 6 ; i++){
		var ft = CHECK.getTypeF();
		if( ft == "A" ){
			document.getElementById("enemy_f_"+i+"_S").normalStyle.visibility = "visible";
		}
		else if( ft == 1 ){
			break;
		}
		CHECK.moveF();
	}

	browser.unlockScreen();
}


function drawAlienMove(pos){

	browser.lockScreen();

	CHECK.x = pos.x;
	CHECK.y = pos.y;
	CHECK.dx = pos.dx;
	CHECK.dy = pos.dy;
	CHECK.moveB();


	var obj = document.getElementById("enemy_f_5_S");
	for(var i = 0 ; i < 10 ; i++){
		obj.normalStyle.visibility = "hidden";
		obj = obj.nextSibling;
	}


	for(var i = 1 ; i < 6 ; i++){

		var ft = CHECK.getTypeF();
		if( ft == "A" ){
			document.getElementById("enemy_f_"+i+"_T").normalStyle.visibility = "visible";
		}
		else if( ft == 1 ){
			break;
		}
		CHECK.moveF();
	}

	browser.unlockScreen();
}


function drawStop(pos){

	browser.lockScreen();

	VIEW.normalStyle.top = "-10px";
	VIEW.normalStyle.left = "-10px";


	// hide the image when it moves 
	var obj = document.getElementById("l_2_V_T");
	for(var i = 0 ; i < 17 ; i++){
		obj.normalStyle.visibility = "hidden";
		obj = obj.nextSibling;
	}


	// background is always visible
	document.getElementById("f_5_H_S").normalStyle.visibility = "visible";


	CHECK.x = pos.x;
	CHECK.y = pos.y;
	CHECK.dx = pos.dx;
	CHECK.dy = pos.dy;

	for(var step = 0 ; step < 4 ; step++){
		var rt = CHECK.getTypeR();
		var lt = CHECK.getTypeL();
		var ft = CHECK.getTypeF();


		// draws the right wall
		var wall = document.getElementById("r_"+(step+1)+"_V_S");
		var path = document.getElementById("r_"+(step+1)+"_H_S");
		path.normalStyle.visibility = (rt == 1) ? "hidden" : "visible";
		wall.normalStyle.visibility = (rt == 1) ? "visible" : "hidden";


		// draws the left wall
		wall = document.getElementById("l_"+(step+1)+"_V_S");
		path = document.getElementById("l_"+(step+1)+"_H_S");
		wall.normalStyle.visibility = (lt == 1) ? "visible" : "hidden";
		path.normalStyle.visibility = (lt == 1) ? "hidden" : "visible";


		// draws the front wall 
		wall = document.getElementById("f_"+(step+2)+"_V_S");
		wall.normalStyle.visibility = (ft == 1) ? "visible" : "hidden";

		if( ft == 1 ) break;


		CHECK.moveF();
	}

	browser.unlockScreen();
}

function drawMove(pos){
	browser.lockScreen();

	VIEW.normalStyle.top = "-16px";


	// hides the image when is not in motion
	var obj = document.getElementById("l_1_V_S");
	for(var i = 0 ; i < 22 ; i++){
		obj.normalStyle.visibility = "hidden";
		obj = obj.nextSibling;
	}


	CHECK.x = pos.x;
	CHECK.y = pos.y;
	CHECK.dx = pos.dx;
	CHECK.dy = pos.dy;


	for(var step = 1 ; step < 4 ; step++){


		var rt = CHECK.getTypeR();
		var lt = CHECK.getTypeL();
		var ft = CHECK.getTypeF();


		// draws the right wall
		var wall = document.getElementById("r_"+(step+1)+"_V_T");
		var path = document.getElementById("r_"+(step+1)+"_H_T");
		path.normalStyle.visibility = (rt == 1) ? "hidden" : "visible";
		wall.normalStyle.visibility = (rt == 1) ? "visible" : "hidden";


		// draws the left wall
		wall = document.getElementById("l_"+(step+1)+"_V_T");
		path = document.getElementById("l_"+(step+1)+"_H_T");
		wall.normalStyle.visibility = (lt == 1) ? "visible" : "hidden";
		path.normalStyle.visibility = (lt == 1) ? "hidden" : "visible";


		// draws the front wall
		wall = document.getElementById("f_"+(step+2)+"_V_T");
		wall.normalStyle.visibility = (ft == 1) ? "visible" : "hidden";

		if( step == 3 ){
			path = document.getElementById("f_"+(step+2)+"_H_T");
			path.normalStyle.visibility = (ft == 1) ? "hidden" : "visible";
		}


		if( ft == 1 ) break;


		CHECK.moveF();
	}

	browser.unlockScreen();
}


function drawMap(maze){

	var str = "";
	for(var y = 0 ; y < MAZE_H ; y++){
		for(var x = 0 ; x < MAZE_W ; x++){
			str += maze[x][y] == 1 ? "¢£" : "¡¡";
		}
	}
	document.getElementById("map").firstChild.data = str;


	var hero = document.getElementById("hero");
	hero.normalStyle.left = HERO.x * 20 + "px";
	hero.normalStyle.top = HERO.y * 20 + "px";


	for(var i = 0 ; i < ALIEN.length ; i++){
		var alien = ALIEN[i];
		var obj = document.getElementById("alien"+i);
		obj.normalStyle.left = alien.x * 20 + "px";
		obj.normalStyle.top = alien.y * 20 + "px";
	}
}


/**
 * draws graphics when turning right
 * @param pos	position of the hero
 * @param phase	0: 30 degree, 1: 60 degree, 2: graphics is cleared when in rotation
 */
function drawRotateRight( pos, phase ){
	browser.lockScreen();

	// clears the graphics in rotation
	var obj = document.getElementById("r1_1_V_R");
	for(var i = 0 ; i < 10 ; i++){
		obj.normalStyle.visibility = "hidden";
		obj = obj.nextSibling;
	}

	// clears the enemy
	var obj = document.getElementById("enemy_f_5_S");
	for(var i = 0 ; i < 10 ; i++){
		obj.normalStyle.visibility = "hidden";
		obj = obj.nextSibling;
	}

	if( phase > 1 ) return;


	CHECK.x = pos.x;
	CHECK.y = pos.y;
	CHECK.dx = pos.dx;
	CHECK.dy = pos.dy;

	var w0 = CHECK.getTypeF() == 1;	// a wall in front?
	var w1 = CHECK.getTypeR() == 1;	// a wall on the right?
	CHECK.moveF();
	var w2 = CHECK.getTypeR() == 1;	// a wall in right 45 degrees front?


	var f = (phase == 0) ? "1" : "2"; // index of file



	// front
	var front = document.getElementById("r"+f+"f_2_V_R");
	front.normalStyle.visibility = w0 ? "visible" : "hidden";


	// right side
	var wall = document.getElementById("r"+f+"_1_V_R");
	var path = document.getElementById("r"+f+"_1_H_R");
	wall.normalStyle.visibility = w1 ? "visible" : "hidden";
	path.normalStyle.visibility = w1 ? "hidden" : "visible";


	// right 45 degrees front
	wall = document.getElementById("r"+f+"_2_V_R");
	path = document.getElementById("r"+f+"_2_H_R");
	wall.normalStyle.visibility = w2 ? "visible" : "hidden";
	path.normalStyle.visibility = w2 ? "hidden" : "visible";

	browser.unlockScreen();
}


/**
 * draws graphics when turning left
 * @param pos	the position of the hero
 * @param phase	0: 30 degrees, 1: 60 degrees 2: graphics is cleared when in rotation
 */
function drawRotateLeft( pos, phase ){
	browser.lockScreen();

	// clears graphics in rotation
	var obj = document.getElementById("l1_1_V_R");
	for(var i = 0 ; i < 10 ; i++){
		obj.normalStyle.visibility = "hidden";
		obj = obj.nextSibling;
	}

	// clears the enemy
	var obj = document.getElementById("enemy_f_5_S");
	for(var i = 0 ; i < 10 ; i++){
		obj.normalStyle.visibility = "hidden";
		obj = obj.nextSibling;
	}

	if( phase > 1 ) return;


	CHECK.x = pos.x;
	CHECK.y = pos.y;
	CHECK.dx = pos.dx;
	CHECK.dy = pos.dy;

	var w0 = CHECK.getTypeF() == 1;	// wall in front?
	var w1 = CHECK.getTypeL() == 1;	// wall on the left side?
	CHECK.moveF();
	var w2 = CHECK.getTypeL() == 1;	// wall in 45 deg. left front?


	var f = (phase == 0) ? "1" : "2"; // index of file


	// front
	var front = document.getElementById("l"+f+"f_2_V_R");
	front.normalStyle.visibility = w0 ? "visible" : "hidden";


	// right side
	var wall = document.getElementById("l"+f+"_1_V_R");
	var path = document.getElementById("l"+f+"_1_H_R");
	wall.normalStyle.visibility = w1 ? "visible" : "hidden";
	path.normalStyle.visibility = w1 ? "hidden" : "visible";


	// right 45 degrees front
	wall = document.getElementById("l"+f+"_2_V_R");
	path = document.getElementById("l"+f+"_2_H_R");
	wall.normalStyle.visibility = w2 ? "visible" : "hidden";
	path.normalStyle.visibility = w2 ? "hidden" : "visible";

	browser.unlockScreen();
}



function Player(x,y,t,dx,dy){
	this.x = x;
	this.y = y;
	this.t = t;
	this.dx = dx;
	this.dy = dy;
	this.move = PosMove;
	this.moveF = PosMoveF;
	this.moveB = PosMoveB;
	this.turnR = PosTurnR;
	this.turnL = PosTurnL;
	this.getTypeR = PosTypeR;
	this.getTypeL = PosTypeL;
	this.getTypeF = PosTypeF;
	MAZE[x][y] = t;
}

function PosTypeF(){
	var nx = this.x + this.dx;
	var ny = this.y + this.dy;
	return MAZE[nx][ny];
}

function PosTypeR(){
	var nx = this.dy * -1 + this.x;
	var ny = this.dx + this.y;
	return MAZE[nx][ny];
}

function PosTypeL(){
	var nx = this.dy + this.x;
	var ny = this.dx * -1 + this.y;
	return MAZE[nx][ny];
}

function PosMove(dx,dy){
	var nx = this.x + dx;
	var ny = this.y + dy;
	if(MAZE[nx][ny] != 1){
		if(this.t != 0) MAZE[this.x][this.y] = 0;
		this.x = nx;
		this.y = ny;
		if(this.t != 0) MAZE[this.x][this.y] = this.t;
	}
}

function PosMoveF(){
	var nx = this.x + this.dx;
	var ny = this.y + this.dy;
	if(MAZE[nx][ny] != 1){
		if(this.t != 0) MAZE[this.x][this.y] = 0;
		this.x = nx;
		this.y = ny;
		if(this.t != 0) MAZE[this.x][this.y] = this.t;
	}
}

function PosMoveB(){
	var nx = this.x - this.dx;
	var ny = this.y - this.dy;
	if(MAZE[nx][ny] != 1){
		if(this.t != 0) MAZE[this.x][this.y] = 0;
		this.x = nx;
		this.y = ny;
		if(this.t != 0) MAZE[this.x][this.y] = this.t;
	}
}

function PosTurnR(){
	var nx = this.dy * -1;
	var ny = this.dx;
	this.dx = nx;
	this.dy = ny;
}

function PosTurnL(){
	var nx = this.dy;
	var ny = this.dx * -1;
	this.dx = nx;
	this.dy = ny;
}


function showMap(flag){
	var mb = document.getElementById("mapbase");
	mb.normalStyle.visibility = flag ? "visible" : "hidden";
}


function keyup(){
	showMap(false);
}

function keydown(){
	var code = document.currentEvent.keyCode;

	if( code == 1 )		// forward
	{
		HERO.moveF();
		drawMove(HERO);
		drawAlienMove(HERO);
		browser.sleep(100);
	}
	else if( code == 2 )	// backward
	{
		drawMove(HERO);
		drawAlienMove(HERO);
		browser.sleep(100);
		HERO.moveB();
	}
	else if( code == 3 )	// left
	{
		VIEW.normalStyle.left = "0px";

		drawRotateLeft( HERO, 0 );
		browser.sleep(100);
		drawRotateLeft( HERO, 2 );

		HERO.turnL();
	}
	else if( code == 4 )	// right
	{
		VIEW.normalStyle.left = "-20px";

		drawRotateRight( HERO, 0 );
		browser.sleep(100);
		drawRotateRight( HERO, 2 );

		HERO.turnR();
	}
	else if( code == 21 ){
		showMap(true);
		return;
	}


	document.getElementById("walk_2").streamStatus = "stop";
	document.getElementById("walk_1").streamStatus = "play";

	drawStop(HERO);

	document.getElementById("walk_1").streamStatus = "stop";
	document.getElementById("walk_2").streamStatus = "play";

	drawAlienStop(HERO);

	drawMap(MAZE);
}


/**
 * returns 2-ary array for a maze
 * @param w width (odd number)
 * @param h height (odd number)
 */
function createMaze(w, h){

	// initialization of the array
	var maze = new Array();
	for(var x = 0 ; x < w ; x++){
		maze[x] = new Array();
		for(var y = 0 ; y < h ; y++){
			maze[x][y] = 0;
		}
	}


	// walls on the 4 directions
	for(var x = 0 ; x < w ; x++){
		maze[x][0] = maze[x][h-1] = 1;
	}
	for(var y = 0 ; y < h ; y++){
		maze[0][y] = maze[w-1][y] = 1;
	}


	// maze generation algorithm
	for(var x = 2 ; x < w-2 ; x += 2){
		for(var y = 2 ; y < h-2 ; y += 2){
			maze[x][y] = 1;

			// left-most row 4 directions are allowed; other rows can have only up,down,rightward are allowed
			var dir = browser.random((x == 2) ? 4 : 3);

			var px = x;
			var py = y;
			if( dir == 0 ) { py--; }
			else if( dir == 1 ) { py++; }
			else if( dir == 2 ) { px++; }
			else if( dir == 3 ) { px--; }

			maze[px][py] = 1;
		}
	}

	return maze;
}


</script></html>