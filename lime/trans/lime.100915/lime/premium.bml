<?xml version="1.0" encoding="EUC-JP" ?>
<!DOCTYPE bml PUBLIC "-//ARIB STD-B24:1999//DTD BML Document for IPTV//JA" "http://www.arib.or.jp/B24/DTD/bml_x_x_iptv.dtd">
<?bml bml-version="100.0" ?>
<!--
============================================================
Copyright (C)2009, NTT Plala Inc. All rights reserved.
Copyright(C) Nippon Telegraph and Telephone Corporation 2010
============================================================
-->
<bml>
<head>
<title>PLALA DTV PORTAL Premium</title>
<style><![CDATA[
body{background-color-index:0;resolution:960x540;display-aspect-ratio:16v9;used-key-list:basic data-button;clut:url(images/dtvbml.clt);}
p.clocktext{width:16px;height:16px;font-size:16px;color-index:7;grayscale-color-index:171 162;}
p.temaIconSub{font-size:16px;color-index:7;grayscale-color-index:171 162;}
p.pbtn{font-size:20px;color-index:7;grayscale-color-index:171 167;text-align:center;}
p.ctg{font-size:20px;color-index:173;grayscale-color-index:170 162;text-align:center;}
p.ctgf{font-size:20px;color-index:138;grayscale-color-index:154 162;text-align:center;}
p.title{font-size:20px;color-index:7;grayscale-color-index:171 167;text-align:center;}
p.subtitle{font-size:16px;color-index:7;grayscale-color-index:170 160;text-align:center;}
p.alist{font-size:20px;color-index:163;grayscale-color-index:160 154;}
p.kist{font-size:16px;color-index:7;grayscale-color-index:171 167;text-align:right;}
p.dbtn{font-size:16px;color-index:7;grayscale-color-index:171 167;}
]]></style>
<script src="../scripts/plalapremium.ecm"/>
<script src="../scripts/common.ecm"/>
<script><![CDATA[
var gSpeedUpTimerId=NaN;
var gSideKey=true;
var gUpDownKey=true;
var gPackFromCont=false;
function onunload(){}

//
function onload(){
	gPlaySound=false;
	gState.bmltype=6;
	if(!gState.init())return;
	lockScreen();
	hideElem("loading2");
	showElem("logo");
	showElem("temaIcon");
	if(gState.return_timing=="return"){
		createByQuery();
	}else if(gState.param_crid!=""){
		showByContentInformation(gState.param_crid,gState.param_displayType,true);
	}else{
		showPremiumTop("");
	}
	unlockScreen();
	gState.param_crid="";
	gState.param_displayType="";
}
function showPremiumTop(id){
	gState.fromTop=true;
	showTema(0);
	setLog(null);
	if(document.currentFocus){
		if(document.currentFocus.id=="scbtn"){
			scblur(gScIdx);
		}
	}
	var ge=getGenres(null,getGenresForPremium);
	if(ge==null) return;
	gState.upbox=new Genre();
	gState.upbox.init(ge,null);
	if(id!="")gState.upbox.setmCrid(id);
	gState.upbox.load(gState.ispid,gState.mode,gState.age); // サブジャンル取得
	gState.upbox.show(gState.ispid,gState.mode,gState.age);
	gState.downbox=new ListA();
	gState.downbox.init(9,gState.upbox.get(),searchPremium);
	if(gState.downbox.show(gState.ispid,gState.mode,gState.age)){
		gPlaySound=false;
		defaultFocus();
	}
}

//--------------------------------------------------------------------
// 戻りようの情報保存関数
function setRootList(obj){
	gState.rootReturnData.list = new RData();
	gState.rootReturnData.list.state=obj.state;
	gState.rootReturnData.list.crid=obj.crid;
	gState.rootReturnData.list.displayType=obj.displayType;
	gState.rootReturnData.list.sort=obj.sort;
	gState.rootReturnData.list.page=obj.nowPage;
	gState.rootReturnData.list.idx=obj.idx;
	gState.rootReturnData.list.age=gState.age;
}
function setSubList(obj){
	if(gState.rootReturnData.list!=null&&gState.rootReturnData.list.crid==obj.crid) return;
	gState.subReturnData.list=new RData();
	gState.subReturnData.list.state=obj.state;
	gState.subReturnData.list.crid=obj.crid;
	gState.subReturnData.list.displayType=obj.displayType;
	gState.subReturnData.list.sort=obj.sort;
	gState.subReturnData.list.page=obj.nowPage;
	gState.subReturnData.list.idx=obj.idx;
	gState.subReturnData.list.age=gState.age;
}

function setReturnData(nowState,nextState){
	if(nextState==0) return;
	if((nowState==3&&nextState==4)||(nowState==5&&nextState==6)||(nowState==7&&nextState==8)||(nowState==9&&nextState==10)||(nowState==11&&nextState==12)) return;
	//root
	if(nowState==0&&nextState!=0){ // ジャンル系のroot記憶
		gState.rootReturnData = new returnData();
		gState.rootReturnData.detail=new RooTRData();
		gState.rootReturnData.detail.state=nowState;
		if(gState.upbox.main!=null) gState.rootReturnData.detail.crid1=gState.upbox.main[gState.upbox.mIdx].genre;
		if(gState.upbox.sub!=null) gState.rootReturnData.detail.crid2=gState.upbox.sub[gState.upbox.sIdx].genre;
		setRootList(gState.downbox);
		return;
	}
	// sub
	if(1<=nowState&&nowState<=15){
		if(gState.subReturnData.detail!=null||gState.subReturnData.list!=null) gState.rootReturnData.list=null;
		clearSubReturnOnQuery();
		gState.subReturnData=new returnData();
		if(gState.upbox!=null&&gState.upbox.listObj!=null){
			setSubList(gState.upbox.listObj);
		}
		if(gState.downbox!=null&&(nowState==1||nowState==2||nowState==3||nowState==5||nowState==7||nowState==9||nowState==11)){
			gState.subReturnData.detail=new RData();
			gState.subReturnData.detail.state=gState.downbox.state;
			gState.subReturnData.detail.crid=gState.downbox.crid;
			gState.subReturnData.detail.displayType=gState.downbox.displayType;
			gState.subReturnData.detail.age=gState.age;
		}
	}
}
function createListbox(data,get,func,sort_key){
	var downbox=null;
	downbox=new ListA();
	downbox.init(9,get,func);
	downbox.nowPage=data.page;
	if(!downbox.load(gState.ispid,gState.mode,gState.age)){
		return -1;
	}
	downbox.idx=data.idx;
	downbox.sort_keyflg=sort_key;
	downbox.state=data.state;
	return downbox;
}
function showReturnGenreSearch(state,ge,func1,obj){
	gReturnState=true;
	showTema(state);
	if(ge==null) return;
	gState.upbox=new Genre();
	gState.upbox.init(ge,func1);
	gState.upbox.setmCrid(gState.rootReturnData.detail.crid1);
	gState.upbox.load(gState.ispid,gState.mode,gState.age);
	gState.upbox.setsCrid(gState.rootReturnData.detail.crid2);
	gState.upbox.show(gState.ispid,gState.mode,gState.age);
	gState.downbox=obj;
	if(gState.downbox.show(gState.ispid,gState.mode,gState.age)){
		gPlaySound=false;
		defaultFocus2();
	}
	gState.rootReturnData=new returnData();
}
//
// dataのデータを元にdownboxを作成する
//
function createDownBox(data){
	var downbox=null;
	var state = data.state;
	var get=new UpGetData(data.crid,data.sort,data.displayType);
	if(state==0){ // ジャンル
		get.displayType=null;
		downbox=createListbox(data,get,searchPremium,new Array(false,false,false,false));
	}else if(state==1||state==2||state==3||state==5||state==7||state==9||state==11){
		downbox=new Detail();
		var info=getConDet(data.crid,data.displayType,gState.ispid,gState.mode,gState.age);
		if(info==null) return -1;
		downbox.init(info);
		downbox.state=data.state;
	}else if(state==6||state==13||state==14){
		downbox=createListbox(data,get,searchVODMemberOf,new Array(false,false,false,false));
	}else if(state==4||state==8||state==10||state==12){
		downbox=createListbox(data,get,searchCHSVODMemberOf,new Array(false,false,false,false));
	}else if(state==15){
		if(get!=null) get.sort=null;
		downbox=createListbox(data,get,searchVODRelatedContents,new Array(false,false,false,false));
	}
	return downbox;
}
//
// objのデータをgState.downboxにし、obj.stateから gState.upboxを作成、
// listObjをgState.upbox.listObjに代入して画面描画する
//
function showByObj(obj,listObj){
	var state=obj.state;
	var info=null;
	if(state==15){
		info=getConDet(obj.crid,"video_program",gState.ispid,gState.mode,gState.age);
		if(info==null) return;
		info.basicDescription.title =info.basicDescription.title+"　関連作品";
	}else if((1<=state)&&(state<=14)) {
		info=getConDet(obj.crid,obj.displayType,gState.ispid,gState.mode,gState.age);
		if(info==null) return;
	}
	setLog(info);
	if(state==0){ // ジャンル
		showReturnGenreSearch(0,getGenres(null,getGenresForPremium),null,obj);
	}else if(state==4||state==6||state==8||state==10||state==12){
		var detail=new RData();
		detail.state=state-1;
		detail.crid=info.crid;
		detail.displayType=info.displayType;
		detail.age=gState.age;
		showTema(state);
		listObj = createDownBox(detail);
		gState.upbox = new Title();
		gState.upbox.init(info,listObj);
		gState.upbox.show(gState.ispid,gState.mode,gState.age);
		gState.downbox=obj;
		if(gState.downbox.show(gState.ispid,gState.mode,gState.age)){
			gPlaySound=false;
			defaultFocus2();
		}
	}else{
		showTema(state);
		gState.upbox = new Title();
		gState.upbox.init(info,listObj);
		gState.upbox.show(gState.ispid,gState.mode,gState.age);
		gState.downbox=obj;
		if(state==3||state==5||state==7||state==9||state==11) gState.downbox.init(info);
		if(gState.downbox.show(gState.ispid,gState.mode,gState.age)){
			gPlaySound=false;
			defaultFocus2();
		}
	}
}
// getContentDetail()を使用してContentInformationオブジェクトを作成する
// 失敗は ホップアップを表示後 nullを返す
function getConDet(crid,displayType,ispid,mode,age){
	var func=null;
	var cd="00";
	if((displayType=="channel_package")||(displayType=="subscription_package")||(displayType=="series_svod")||(displayType=="channel_svod")){ func = getCHSVODContentDetail;cd="36";}
	else if((displayType=="video_program")||(displayType=="video_package")||(displayType=="video_series")||(displayType=="wizard")){ func=getVODContentDetail;cd="23";}
	else if(displayType=="tv_channel"){ func=getTVContentDetail;cd="30";}
	else if(displayType=="karaoke_package") {func=getKaraokeLicenseDetail;cd="83";}

	if(func==null) return null;
	var contentDetail = func(crid,displayType,ispid,mode,age);
	if(contentDetail!=null){
		if(!checkParental(contentDetail)) return null;
		if(!interimCheck(contentDetail.period.displayStart,contentDetail.period.displayEnd)){
			showPopup(new Array("ホームへ"),gohome,"エラー","\r\n提供期間外のためご利用いただけません。\r\n\r\n状態番号：190"+cd,"");
			return null;
		}
		return contentDetail;
	}
	var ret = getErrStat();
	if(ret==null){
		contentDetail = func(crid,displayType,ispid,mode,age);
		if(contentDetail!=null){
			if(!checkParental(contentDetail)) return null;
			if(!interimCheck(contentDetail.period.displayStart,contentDetail.period.displayEnd)){
				showPopup(new Array("ホームへ"),gohome,"エラー","\r\n提供期間外のためご利用いただけません。\r\n\r\n状態番号：190"+cd,"");
				return null;
			}
			return contentDetail;
		}
		ret = getErrStat();
	}
	if(ret==null){
		showLoginErr();
	}else{
		showPopup(new Array("ホームへ"),gohome,"エラー",ret[1],ret[0]);
	}
	return null;
}
//
// Genresの作成
//
function getGenres(child,func){
	var genres=null;
	if(child!=null) genres=func(child,gState.ispid,gState.mode,gState.age);
	else genres=func(gState.ispid,gState.mode,gState.age);

	if(genres!=null){
		return genres;
	}
	var ret = getErrStat();
	if(ret==null){
		if(child!=null) genres=func(child,gState.ispid,gState.mode,gState.age);
		else genres=func(gState.ispid,gState.mode,gState.age);
		if(genres!=null){
			return genres;
		}
		ret = getErrStat();
	}
	if(ret==null){
		showLoginErr();
	}else{
		showPopup(new Array("ホームへ"),gohome,"エラー",ret[1],ret[0]);
	}
	return null;
}
var gScreenState=-1;
var gReturnState=false;
function showTema(state){
/* tv_channel              // チャンネル紹介型 		1
 * video_program           // 作品紹介 				2
 * channel_package         // チャンネルパック型	3/4
 * video_package           // パック				5/6
 * subscription_package    // 見放題				7/8
 * series_svod             // 見放題				9/10
 * channel_svod            // チャンネルSVOD型		11/12
 * video_series            // シリーズ				13
 * wizard                  // ウィザード型			14
 * related_programs        // 関連作品				15
 * karaoke_package         // カラオケライセンス	16
 */
	var temaIcon=new Array("","チャンネル紹介","作品紹介","パック紹介","パック紹介","パック紹介","パック紹介","パック紹介","パック紹介","パック紹介","パック紹介","パック紹介","パック紹介","シリーズ","パック紹介","関連作品","");

	if(!gReturnState) setReturnData(gScreenState,state);
	gReturnState=false;

	gScreenState=state;

	sceneInit();
	gState.temaIconSub=temaIcon[state];
	showTemaIcon();
}
function setLog(info){
	// ロゴ差し替え処理
	lockScreen();
	if(info!=null&&info.extraObject!=null){
		if(String(info.extraObject[EO_KEY_NOD])=="1"){
			// NODロゴ
			setImg("logo","images/logo-nod.png");
			setImg("temaIcon","images/pos-nod.png");
			return;
		}
	}
	// ひかりTVロゴ
	setImg("logo","images/logo.png");
	setImg("temaIcon","images/pos-pr.png");
}
function sceneInit(){
	if(gState.upbox!=null) gState.upbox.hidden();
	if(gState.downbox!=null) gState.downbox.hidden();

	gState.scupkey=scupkeyDefault;
	gState.scdownkey=scdownkeyDefault;
	gState.allHidden=allHiddenDefault;
}
function showByContentInformation(crid,displayType,flg){
	if(	displayType=="tv_channel"||
		displayType=="video_program"||
		displayType=="channel_package"||
		displayType=="video_package"||
		displayType=="subscription_package"||
		displayType=="series_svod"||
		displayType=="channel_svod"||
		displayType=="video_series"||
		displayType=="wizard"||
		displayType=="related_programs"||
		displayType=="karaoke_package"){}
	else{
		launchByContentInformation(crid,displayType);	// 他画面遷移
		return;
	}
	// 遷移が発生するのでタイマーを止める
	if(!isNaN(gSpeedUpTimerId)){
		browser.clearTimer(gSpeedUpTimerId);
		gSpeedUpTimerId=NaN;
	}
	gSideKey=true;
	gUpDownKey=true;
	var obj=getConDet(crid,displayType,gState.ispid,gState.mode,gState.age);
	if(obj==null) return null;
	setLog(obj);
	if(obj.displayType=="tv_channel"){
		showTema(1);
		showDetail(obj,flg);
	}else if(obj.displayType=="video_program"){
		showTema(2);
		showDetail(obj,flg);
	}else if(obj.displayType=="channel_package"){
		showTema(3);
		if(gPackFromCont) gState.upbox.listObj=null;
		gPackFromCont=false;
		showDetail(obj,flg);
	}else if(obj.displayType=="video_package"){
		showTema(5);
		if(gPackFromCont) gState.upbox.listObj=null;
		gPackFromCont=false;
		showDetail(obj,flg);
	}else if(obj.displayType=="subscription_package"){
		showTema(7);
		if(gPackFromCont) gState.upbox.listObj=null;
		gPackFromCont=false;
		showDetail(obj,flg);
	}else if(obj.displayType=="series_svod"){
		showTema(9);
		if(gPackFromCont) gState.upbox.listObj=null;
		gPackFromCont=false;
		showDetail(obj,flg);
	}else if(obj.displayType=="channel_svod"){
		showTema(11);
		if(gPackFromCont) gState.upbox.listObj=null;
		gPackFromCont=false;
		showDetail(obj,flg);
	}else if(obj.displayType=="video_series"){
		showTema(13);
		showList(obj,flg,searchVODMemberOf);
	}else if(obj.displayType=="wizard"){
		showTema(14);
		showList(obj,flg,searchVODMemberOf);
	}else if(obj.displayType=="related_programs"){
		showRelated(obj,flg);
	}else if(obj.displayType=="karaoke_package"){
		showTema(16);
		showDetail(obj,flg);
	}else{
		launchByContentInformation(obj.crid,obj.displayType);	// 他画面遷移
	}
}
function showRelated(obj,flg){
	showTema(15);
	obj.basicDescription.title = obj.basicDescription.title+"　関連作品";
	gState.upbox=new Title();
	gState.upbox.init(obj , null );
	gState.upbox.show(gState.ispid,gState.mode,gState.age);
	gState.downbox=new ListA();
	var updata=gState.upbox.get();
	if(updata!=null) {updata.sort=null;updata.displayType=null;}
	gState.downbox.init(9,updata,searchVODRelatedContents);
	if(gState.downbox.show(gState.ispid,gState.mode,gState.age)){
		defaultFocus();
	}
}
function showDetail(info,flg){
	var list=null;
	if(flg){
		if(gState.downbox!=null&&gState.downbox.objtype!="detail") list=gState.downbox;
	}else list=gState.upbox.listObj;
	gState.upbox=new Title();
	gState.upbox.init(info,list );
	gState.upbox.show(gState.ispid,gState.mode,gState.age);
	gState.downbox=new Detail();
	gState.downbox.init(info);
	if(gState.downbox.show(gState.ispid,gState.mode,gState.age)){
		defaultFocus2();
	}
}
function showList(info,flg,func){
	var list=null;
	if(flg)list=gState.downbox;
	else list=gState.upbox.listObj;
	gState.upbox=new Title();
	gState.upbox.init(info , list );
	gState.upbox.show(gState.ispid,gState.mode,gState.age);
	gState.downbox=new ListA();
	gState.downbox.init(9,gState.upbox.get(),func);
	if(gState.downbox.show(gState.ispid,gState.mode,gState.age)){
		defaultFocus();
	}
}
function defaultFocus(){
	if(gState.upbox!=null&&gState.upbox.isfocus()) gState.upbox.focus(-1);
	else if(gState.downbox!=null&&gState.downbox.isfocus()) gState.downbox.focus(-1);
	else scFocus();
}
function defaultFocus2(){
	if(gState.downbox!=null&&gState.downbox.isfocus()) gState.downbox.focus(-1);
	else if(gState.upbox!=null&&gState.upbox.isfocus()) gState.upbox.focus(-1);
	else scFocus();
}
function scupkeyDefault(){
	if(gState.downbox!=null&&gState.downbox.isfocus()) gState.downbox.focus(1);
	else if(gState.upbox!=null&&gState.upbox.isfocus()) gState.upbox.focus(1);
	else return;
	scblur(gScIdx);

}
function scdownkeyDefault(){
	if(gState.upbox!=null&&gState.upbox.isfocus()) gState.upbox.focus(2);
	else if(gState.downbox!=null&&gState.downbox.isfocus()) gState.downbox.focus(2);
	else return;
	scblur(gScIdx);
}
function allHiddenDefault(){
	if(gState.upbox!=null) gState.upbox.hidden();
	if(gState.downbox!=null) gState.downbox.hidden();
	gState.upbox=null;
	gState.downbox=null;
	hideElem("bg_ctg01");
	hideElem("bg_ctg02");
	hideElem("scbtn");
	hideElem("base");
	setImg("bg","images/bg_00.png");
}
function lakeep(id){
	gPlaySound=false;
	genreSubblur();
	genreMainblur();
	lista_blur();
	title_blur();
	scblur(gScIdx);
	defaultFocus2();
}
//--------------------------------------------------------------
// タイトル系
//--------------------------------------------------------------
function Title(){
	this.objtype="title";
	this.info=null;
	this.listObj=null;
	this.f_focus=false;
	this.title_txt="";
	this.init=TT_init;
	this.load=TT_load;
	this.isfocus=TT_isfocus;
	this.focus=TT_focus;
	this.show=TT_show;
	this.hidden=TT_hidden;
	this.get=TT_get;
	this.focus_book=false;
}
function TT_load(){}
function TT_init(info,listObj){
	this.info=info;
	this.listObj=listObj;
	this.title_txt="";
	if(this.listObj!=null && this.listObj.objtype!="listd" && this.listObj.list!=null && this.listObj.totalCount>1) this.f_focus=true;
}
function TT_isfocus(){
	if(this.info.displayType=="wizard"&&this.f_focus==false) return false;
	else return true;
}
function TT_focus(code){
	playSound(9);
	if(this.f_focus){
		showElem("csrt0");
		showElem("csrt1");
	}else{
		hideElem("csrt0");
		hideElem("csrt1");
	}
	if(code==1&&this.info.displayType=="video_series"){
		setTxtCol("btn_bookt","0","189 191");
		setImg("btn_book","images/bt_plain01-f.png");
		setFcs("btn_book");
		this.focus_book=true;
		return true;
	}
	if(this.info.displayType!="wizard") setTicker("title",2000,300,5,"　　　　",this.title_txt,76,true);
	setTxtCol("btn_bookt","7","171 163");
	setImg("btn_book","images/bt_plain01.png");
	setTxtCol("title","0","189 191");
	setImg("bg_ctg05","images/bg_ctg05-f.png");
	setFcs("bg_ctg05");
	this.focus_book=false;
	return true;
}
function TT_get(){
	if(this.info==null) return null;
	return new UpGetData(this.info.crid,this.info.sort,this.info.displayType);
}
function TT_show(ispid, mode, age){
	if(this.info==null) return -1;
	if(this.info.basicDescription==null) return -1;
	if(this.f_focus){
		showElem("csrt0");
		showElem("csrt1");
	}else{
		hideElem("csrt0");
		hideElem("csrt1");
	}
	hideElem("bg_ctg01");
	hideElem("bg_ctg02");
	hideElem("bg_ctg03");
	hideElem("bg_ctg04");
	showElem("bg_ctg05");
	showElem("bg_ctg06");
	setImg("bg_ctg05","images/bg_ctg05.png");
	if(this.info.displayType=="tv_channel") this.title_txt="ch:"+this.info.broadCastEvent.serviceId+" "+this.info.basicDescription.title;
	else if(this.info.displayType=="wizard") this.title_txt=this.info.basicDescription.synopsis;
	else this.title_txt=this.info.basicDescription.title;
	setText("title",convOverText(this.title_txt,76));
	if(this.info.displayType=="video_series"){
		setText("subtitle2",this.info.basicDescription.synopsis);
		showElem("subtitle2_base");
		setText("btn_bookt","マイページ登録");
		setTxtCol("btn_bookt","7","171 163");
		setImg("btn_book","images/bt_plain01.png");
		showElem("btn_book");
	}
	showElem("upbox");
}
function TT_hidden(){
	showElem("bg_ctg01");
	showElem("bg_ctg02");
	hideElem("bg_ctg03");
	hideElem("bg_ctg04");
	hideElem("bg_ctg05");
	hideElem("bg_ctg06");
	setText("title","");
	setText("subtitle2","");
	hideElem("subtitle2_base");
	hideElem("btn_book");
	setText("btn_bookt","");
	hideElem("csrt0");
	hideElem("csrt1");
	hideElem("upbox");
	this.focus_book=false;
	gTicker.stop();
}
function title_blur(){
	setTxtCol("title","7","171 167");
	setImg("bg_ctg05","images/bg_ctg05.png");
	setTxtCol("btn_bookt","7","171 167");
	setImg("btn_book","images/bt_plain01.png");
	gTicker.stop();
}
var gTitleSide=false;//タイトルによる横移動中か
function titleleftKey(){
	playSound(9);
	gPlaySound=false;
	gTitleSide=true;
	if(!gState.upbox.listObj.addIdx(gState.upbox.listObj.idx-1,false,false)){
		if(gState.upbox.listObj.maxPage > 1){
			if(!gFOff){
				unlockScreen();
				keyOff();
				lockScreen();
			}
			gState.upbox.listObj.nowPage--;
			if(gState.upbox.listObj.nowPage<0) gState.upbox.listObj.nowPage=gState.upbox.listObj.maxPage-1;
			gState.upbox.listObj.load(gState.ispid,gState.mode,gState.age);
		}
		gState.upbox.listObj.idx = gState.upbox.listObj.list.length-1;
		if(!gState.upbox.listObj.focusflg[gState.upbox.listObj.idx]) return titleleftKey();
	}
	var obj=gState.upbox.listObj.get();
	if(obj.basicDescription.parentalRate > gState.age) return titleleftKey();
	gReturnState=true;
	setChngTitle();
	showByContentInformation(obj.crid,obj.displayType,false);
	gTitleSide=false;
	return true;
}
function titlerightKey(){
	playSound(9);
	gPlaySound=false;
	gTitleSide=true;
	if(!gState.upbox.listObj.addIdx(gState.upbox.listObj.idx+1,true,false)){
		if(gState.upbox.listObj.maxPage > 1){
			if(!gFOff){
				unlockScreen();
				keyOff();
				lockScreen();
			}
			gState.upbox.listObj.nowPage++;
			if(gState.upbox.listObj.maxPage<=gState.upbox.listObj.nowPage) gState.upbox.listObj.nowPage=0;
			gState.upbox.listObj.load(gState.ispid,gState.mode,gState.age);
		}
		gState.upbox.listObj.idx = 0;
		if(!gState.upbox.listObj.focusflg[gState.upbox.listObj.idx]) return titlerightKey();
	}
	var obj=gState.upbox.listObj.get();
	if(obj.basicDescription.parentalRate > gState.age) return titlerightKey();
	gReturnState=true;
	setChngTitle();
	showByContentInformation(obj.crid,obj.displayType,false);
	gTitleSide=false;
	return true;
}
function setChngTitle(){
	if(gState.upbox.listObj.state==0){
		if(gState.rootReturnData&&gState.rootReturnData.list){
			gState.rootReturnData.list.page=gState.upbox.listObj.nowPage;
			gState.rootReturnData.list.idx=gState.upbox.listObj.idx;
		}
	}
}
function titlekey(){
	var code = document.currentEvent.keyCode;
	var id = document.currentEvent.target.id;
	lockScreen();
	if(code==1){
		if(!gUpDownKey) {unlockScreen();return;}
		title_blur();
		if(gState.upbox.focus_book==true){
			gState.upbox.focus(-1);
			return;
		}
		hideElem("csrt0");
		hideElem("csrt1");
		scFocus();
	}else if(code==2){
		if(!gUpDownKey) {unlockScreen();return;}
		title_blur();
		if(gState.upbox.focus_book==false&&gState.upbox.info.displayType=="video_series"){
			gState.upbox.focus(1);
			return;
		}
		if(gState.downbox.isfocus()){
			gState.downbox.focus(code);
		}else{
			hideElem("csrt0");
			hideElem("csrt1");
			scFocus();
		}
	}else if(code==3){
		if(!gSideKey) {unlockScreen();return;}
		if(gState.upbox.objtype=="title"&&gState.upbox.f_focus){
			title_blur();
			titleleftKey();
		}
	}else if(code==4){
		if(!gSideKey) {unlockScreen();return;}
		if(gState.upbox.objtype=="title"&&gState.upbox.f_focus){
			title_blur();
			titlerightKey();
		}
	}else if(21<=code && code<=24){
		if(!gSideKey||!gUpDownKey) {unlockScreen();return;}
		if(gState.downbox!=null){
			if(gState.downbox.list==null||gState.downbox.list.length==0) {unlockScreen();return;}
			if(gState.downbox.sort_keyflg[code-21]) title_blur();
			gState.downbox.colorClick(code);
		}
	}else if( (code >= 5) && (code <= 14) ){
		if(!gSideKey||!gUpDownKey) {unlockScreen();return;}
		if(gState.downbox!=null&&(code-5)<=gState.downbox.list.length&&code>5){
			title_blur();
			gState.downbox.numClick(code);
		}
	}else if(code==18){
		if(gState.upbox.focus_book==true){
			playSound(7);
			title_blur();
			var ret=addBookmarkProc(gState.upbox.info);
			if(ret!=null){
				if(ret.nextcom=="mark_add_complete") showPopup(new Array("閉じる"),bookmarkBack,"ご確認","\r\n\r\n"+gState.upbox.title_txt+"\r\nをマイビデオに登録しました。","");
				else showPopup(new Array("閉じる"),bookmarkBack,"エラー",setErrMsg(getBmlErr("094","39")),"");
			}
		}
	}else if(code==19){
		if(!gSideKey||!gUpDownKey) {unlockScreen();return;}
		title_blur();
		returnFunc();
	}
	unlockScreen();
}
//--------------------------------------------------------------
// ジャンル系
//--------------------------------------------------------------
function Genre(){
	this.objtype="Genre";
	this.main=null;
	this.mIdx=0;
	this.sub=null;
	this.func=null;
	this.sIdx=0;
	this.init=GN_init;
	this.load=GN_load;
	this.isfocus=GN_isfocus;
	this.focus=GN_focus;
	this.show=GN_show;
	this.hidden=GN_hidden;
	this.get=GN_get;
	this.showMain=GN_showMain;
	this.showSub=GN_showSub;
	this.hideSub=GN_hideSub;
	this.showMainCsr=GN_showMainCsr;
	this.showSubCsr=GN_showSubCsr;
	this.mainfocus=GN_mainfocus;
	this.subfocus=GN_subfocus;
	this.addmIdx=GN_addmIdx;
	this.addsIdx=GN_addsIdx;
	this.setmCrid=GN_setmCrid;
	this.setsCrid=GN_setsCrid;
	this.maddflg=false;
	this.subload=false;
	this.mtitle="";
	this.stitle="";
}
function GN_init(genres,func){
	this.main=genres;
	this.mIdx=0;
	this.func=func;
}
function GN_isfocus(){
	if(this.sub!=null && this.sub.length>0) return true;
	if(this.main!=null && this.main.length>0) return true;
	return false;
}
function GN_mainfocus(){
	playSound(9);
	setImg("bg_ctg03","images/bg_ctg03-f.png");
	this.showMainCsr();
	setFcs("bg_ctg03");
	setTicker("ctgmt2",2000,300,5,"　",this.mtitle,16,true);
}
function GN_subfocus(){
	playSound(9);
	setImg("bg_ctg04","images/bg_ctg04-f.png");
	this.showSubCsr();
	setFcs("bg_ctg04");
	setTicker("ctgst1",2000,300,5,"　",this.stitle,28,true);
}
function GN_focus(code){
	gTicker.stop();
	if(code==-1){
		if(this.main.length>0) this.mainfocus();
		else this.subfocus();
	}
	if(code==1){
		if(isVis("bg_ctg04")&&this.sub!=null&&this.sub.length>0) this.subfocus();
		else if(this.main!=null&&this.main.length>0)  this.mainfocus();
	}else if(code==2){
		if(this.main!=null&&this.main.length>0) this.mainfocus();
		else if(this.sub!=null&&this.sub.length>0) this.subfocus();
	}
}
function GN_load(ispid, mode, age){
	if(this.func==null) return false;
	if(this.main==null||this.main.length==0) return false;
	if(this.main[this.mIdx].child!=null){
		this.sub = getGenres(this.main[this.mIdx].child,this.func);
		if(this.sub==null) this.subload=true;
		else this.subload=false;
	}
	if(this.sub!=null&&this.sub.length<=this.sIdx) this.sIdx=0;
	return true;
}
function GN_get(){
	if(this.subload) return null;
	if(this.sub!=null && this.sub.length>0) return new UpGetData( this.sub[this.sIdx].genre, this.sub[this.sIdx].sort,null);
	if(this.main!=null && this.main.length>0) return new UpGetData( this.main[this.mIdx].genre, this.main[this.mIdx].sort,null);
	return null;
}
function GN_setmCrid(crid){
	var i;
	var flg=false;
	if(this.main!=null){
		for(i=0;i<this.main.length;i++){
			if(this.main[i].genre==crid){
				this.mIdx=i;flg=true;
			}
		}
	}
	return flg;
}
function GN_setsCrid(crid){
	var i;
	var flg=true;
	if(this.sub!=null){
		flg=false;
		for(i=0;i<this.sub.length;i++){
			if(this.sub[i].genre==crid){
				this.sIdx=i;flg=true;
			}
		}
	}
	return flg;
}
function GN_addmIdx(num){
	if(this.main==null&&this.main.length<=1) return false;
	this.mIdx += num;
	this.sIdx=0;
	if(this.mIdx<0) this.mIdx+=this.main.length;
	else if(this.main.length<=this.mIdx)this.mIdx-=this.main.length;
	playSound(9);
	gTicker.stop();
	this.showMain();
	this.showMainCsr();
	this.maddflg=true;
	this.hideSub();
	setTicker("ctgmt2",2000,300,5,"　",this.mtitle,16,false);
	genre_chengshow();
	return true;
}
function GN_addsIdx(num){
	if(this.sub==null||this.sub.length<=1) return false;
	this.sIdx += num;
	if(this.sIdx<0) this.sIdx+=this.sub.length;
	else if(this.sub.length<=this.sIdx)this.sIdx-=this.sub.length;
	playSound(9);
	gTicker.stop();
	this.showSub();
	this.showSubCsr();
	setTicker("ctgst1",2000,300,5,"　",this.stitle,28,false);
	genre_chengshow();
}
function genre_chengshow(){
	if(!isNaN(gSpeedUpTimerId)){
		browser.clearTimer(gSpeedUpTimerId);
		gSpeedUpTimerId=NaN;
	}
	showElem("loading2");
	if(gState.downbox!=null) gState.downbox.hidden();
	gUpDownKey=false;
	gSpeedUpTimerId = browser.setInterval("genrecheng();",1000,1);
}
function genrecheng(){
	if(isNaN(gSpeedUpTimerId))return;
	else{
		browser.clearTimer(gSpeedUpTimerId);
		gSpeedUpTimerId=NaN;
	}

	if(gState.downbox==null) return;
	if(gState.upbox!=null&&gState.upbox.maddflg){
		gState.upbox.maddflg=false;
		gState.upbox.load(gState.ispid, gState.mode, gState.age);
		gState.upbox.showSub();
	}
	if(!gFOff)lockScreen();
	var func = gState.downbox.func;
	var sort_keyflg=gState.downbox.sort_keyflg;
	gState.downbox = new ListA();
	var data=gState.upbox.get();
	if(data!=null&&gScreenState==2) data.sort=null;
	gState.downbox.init(9,data,func);
	gState.downbox.sort_keyflg=sort_keyflg;
	gState.downbox.show(gState.ispid,gState.mode,gState.age);
	if(!gFOff){
		showElem("loading2");
		unlockScreen();
	}
	if(gTicker.startflg) gTicker.start();
	gUpDownKey=true;// 縦方向の動きを制限
}
function GN_show(ispid, mode, age){
	this.showMain();
	this.showSub();
	showElem("upbox");
}
function GN_showMainCsr(){
	if(getElementById("ctgmt0").firstChild.data!=""){
		showElem("csrm0");
		showElem("csrm1");
	}else{
		hideElem("csrm0");
		hideElem("csrm1");
	}
	if(getElementById("ctgmt1").firstChild.data!="") showElem("csrm2");
	else hideElem("csrm2");
	if(getElementById("ctgmt3").firstChild.data!="") showElem("csrm3");
	else hideElem("csrm3");

	if(getElementById("ctgmt4").firstChild.data!=""){
		showElem("csrm4");
		showElem("csrm5");
	}else{
		hideElem("csrm4");
		hideElem("csrm5");
	}
	setTxtCol("ctgmt0","7","171 167");
	setTxtCol("ctgmt1","7","171 167");
	setTxtCol("ctgmt2","0","189 191");
	setTxtCol("ctgmt3","7","171 167");
	setTxtCol("ctgmt4","7","171 167");
}
function GN_showSubCsr(){
	if(getElementById("ctgst0").firstChild.data!=""){
		showElem("csrs0");
		showElem("csrs1");
	}else{
		hideElem("csrs0");
		hideElem("csrs1");
	}
	if(getElementById("ctgst2").firstChild.data!=""){
		showElem("csrs2");
		showElem("csrs3");
	}else{
		hideElem("csrs2");
		hideElem("csrs3");
	}
	setTxtCol("ctgst0","7","171 167");
	setTxtCol("ctgst1","0","189 191");
	setTxtCol("ctgst2","7","171 167");
}
function GN_showMain(){
	var i,idx;
	if(this.main==null||this.main.length<=0){
		showElem("bg_ctg01");
		hideElem("bg_ctg03");
		for(i=0;i<5;i++){setText("ctgmt"+i,"");}
	}else if(this.main.length<=3){
		hideElem("bg_ctg01");
		showElem("bg_ctg03");
		for(i=0;i<5;i++){
			idx = this.mIdx+i-2;
			if(idx<0 || this.main.length<=idx){
				setText("ctgmt"+i,"");
			}else{
				setText("ctgmt"+i,convOverText(this.main[idx].title,16));
				if(i==2) this.mtitle=this.main[idx].title;
			}
		}
	}else{
		hideElem("bg_ctg01");
		showElem("bg_ctg03");
		for(i=0;i<5;i++){
			idx = this.mIdx+i-2;
			if(idx<0) idx+=this.main.length;
			else if(this.main.length<=idx)idx-=this.main.length;
			setText("ctgmt"+i,convOverText(this.main[idx].title,16));
			if(i==2) this.mtitle=this.main[idx].title;
		}
	}
}
function GN_hideSub(){
	var i;
	for(i=0;i<3;i++){setText("ctgst"+i,"");}
	for(i=0;i<4;i++){hideElem("csrs"+i);}
}
function GN_showSub(){
	var i,idx;
	if(this.sub==null||this.sub.length <= 0 ){
		showElem("bg_ctg02");
		hideElem("bg_ctg04");
		for(i=0;i<3;i++){setText("ctgst"+i,"");}
	}else if(this.sub.length <= 3 ){
		hideElem("bg_ctg02");
		showElem("bg_ctg04");
		for(i=0;i<3;i++){
			idx = this.sIdx+i-1;
			if(idx<0 || this.sub.length<=idx){
				setText("ctgst"+i,"");
			}else{
				if(i==1) this.stitle=this.sub[idx].title;
				setText("ctgst"+i,convOverText(this.sub[idx].title,28));
			}
		}
	}else{
		hideElem("bg_ctg02");
		showElem("bg_ctg04");
		for(i=0;i<3;i++){
			idx = this.sIdx+i-1;
			if(idx<0) idx+=this.sub.length;
			else if(this.sub.length<=idx)idx-=this.sub.length;
			if(i==1) this.stitle=this.sub[idx].title;
			setText("ctgst"+i,convOverText(this.sub[idx].title,28));
		}
	}
}
function GN_hidden(){
	var i;
	showElem("bg_ctg01");
	showElem("bg_ctg02");
	hideElem("bg_ctg03");
	hideElem("bg_ctg04");
	for(i=0;i<5;i++){setText("ctgmt"+i,"");}
	for(i=0;i<3;i++){setText("ctgst"+i,"");}
	for(i=0;i<6;i++){hideElem("csrm"+i);}
	for(i=0;i<4;i++){hideElem("csrs"+i);}
	hideElem("upbox");
}
function genreMainblur(){
	setImg("bg_ctg03","images/bg_ctg03.png");
	setTxtCol("ctgmt0","173","170 162");
	setTxtCol("ctgmt1","173","170 162");
	setTxtCol("ctgmt2","138","154 162");
	setTxtCol("ctgmt3","173","170 162");
	setTxtCol("ctgmt4","173","170 162");
	for(var i=0;i<6;i++){hideElem("csrm"+i);}
	gTicker.stop();
}
function genreSubblur(){
	setImg("bg_ctg04","images/bg_ctg04.png");
	setTxtCol("ctgst0","173","170 162");
	setTxtCol("ctgst1","138","154 162");
	setTxtCol("ctgst2","173","170 162");
	for(var i=0;i<4;i++){hideElem("csrs"+i);}
	gTicker.stop();
}
function genrekey(){
	var code = document.currentEvent.keyCode;
	var id = document.currentEvent.target.id;
	lockScreen();

	if(code==1){
		if(!gUpDownKey) {unlockScreen();return;}
		if(id=="bg_ctg04"&&gState.upbox!=null&&gState.upbox.main!=null&&gState.upbox.main.length>0){
			genreSubblur();
			gState.upbox.mainfocus();
		}else{
			genreSubblur();
			genreMainblur();
			scFocus();
		}
	}else if(code==2||code==18){
		if(!gUpDownKey) {unlockScreen();return;}
		if(code==18){
			playSound(7);
			gPlaySound=false;
		}
		if(id=="bg_ctg03"&&gState.upbox!=null&&gState.upbox.sub!=null&&gState.upbox.sub.length>0){
			genreMainblur();
			gState.upbox.subfocus();
		}else if(gState.downbox!=null&&gState.downbox.isfocus()){
			genreSubblur();
			genreMainblur();
			gState.downbox.focus(2);
		}else{
			genreSubblur();
			genreMainblur();
			scFocus();
		}
	}else if(code==3){
		if(!gSideKey) {unlockScreen();return;}
		if(gState.upbox!=null){
			if(id=="bg_ctg03"&&gState.upbox.main!=null&&gState.upbox.main.length>1) gState.upbox.addmIdx(-1);
			else if(id=="bg_ctg04"&&gState.upbox.sub!=null&&gState.upbox.sub.length>1) gState.upbox.addsIdx(-1);
		}
	}else if(code==4){
		if(!gSideKey) {unlockScreen();return;}
		if(gState.upbox!=null){
			if(id=="bg_ctg03"&&gState.upbox.main!=null&&gState.upbox.main.length>1) gState.upbox.addmIdx(1);
			else if(id=="bg_ctg04"&&gState.upbox.sub!=null&&gState.upbox.sub.length>1) gState.upbox.addsIdx(1);
		}
	}else if(21<=code && code<=24){
		if(!gSideKey||!gUpDownKey) {unlockScreen();return;}
		if(gState.downbox!=null){
			if(gState.downbox.list==null||gState.downbox.list.length==0) {unlockScreen();return;}
			if(gState.downbox.sort_keyflg[code-21]){ genreSubblur(); genreMainblur();}
			gState.downbox.colorClick(code);
		}
	}else if( (code >= 5) && (code <= 14) ){
		if(!gSideKey||!gUpDownKey) {unlockScreen();return;}
		if(gState.downbox!=null&&(code-5)<=gState.downbox.list.length&&code>5){
			genreSubblur();
			genreMainblur();
			gState.downbox.numClick(code);
		}
	}else if(code==19){
		if(!gSideKey||!gUpDownKey) {unlockScreen();return;}
		genreSubblur();
		genreMainblur();
		returnFunc();
	}
	unlockScreen();
}
/***********************  下部関数  *****************************/
var gDetailfocusname=new Array("btn0","bt_kist","btn1","btn2","btn3","btn4","btn5","btn6");
var gDetailfocusimage=new Array("images/bt_view","images/bt_kist","images/bt_plain01","images/bt_plain01","images/bt_plain01","images/bt_plain01","images/bt_plain01","images/bt_plain01");
function Detail(){
	this.objtype="detail";
	this.isfocus=DT_isfocus;
	this.focus=DT_focus;
	this.show=DT_show;
	this.hidden=DT_hidden;
	this.get=DT_get;
	this.numClick =DT_numClick;
	this.colorClick=DT_colorClick;
	this.showleft=DT_showleft;
	this.showright=DT_showright;
	this.getKist=DT_getKist;
	this.getPckLicense=DT_getPckLicense;
	this.showtvBtn=DT_showtvBtn;
	this.showBtn=DT_showBtn;
	this.click=DT_click;
	this.init=DT_init;
	this.setResume=DT_setResume;
	this.info=null;
	this.kist = null;
	this.page = 0;
	this.maxpage = 0;
	this.focusflg=new Array(false,false,false,false,false,false,false,false);
	this.btnState=new Array("","","","","","","","");
	this.func=null; // ダミー
	this.sort_keyflg=null; // ダミー
	this.state=gScreenState;
	this.crid="";
	this.displayType="";
}
function DT_numClick(code){}
function DT_colorClick(code){}
function getStopString(position){
	var time=Number(String(position).split(".")[0]);
	var h=0,m=0,s=0;
	s=time%60;
	time=time/60;
	m=time%60;
	time=time/60;
	h=time%60;
	return padding("  ",h)+"時間"+padding("  ",m)+"分"+padding("  ",s)+"秒";
}
var gResumeUrl="";
function goResume(id){
	if(id=="pbtn0"){
		setReturnDataOnQuery();
		gState.return_timing="return";
		gState.return_bmltype=0;
		var time=parseInt(String(gState.downbox.info.contentDetail.stopposition),10);
		if(isNaN(time)) time=0;
		browser.launchIPTVContent(gResumeUrl,gState.getUrl(BASE_URI+gState.curBml),time);
		gState.return_timing="none";
		defaultFocus2();
	}else{
		setReturnDataOnQuery();
		gState.return_timing="return";
		gState.return_bmltype=0;
		browser.launchIPTVContent(gResumeUrl,gState.getUrl(BASE_URI+gState.curBml),0);
		gState.return_timing="none";
		defaultFocus2();
	}
}
function DT_click(idx,ispid,mode,age){
	if(this.btnState[idx]=="bookmark"){
		detail_blur(idx);
		var ret=addBookmarkProc(this.info);
		if(ret!=null){
			if(ret.nextcom=="mark_add_complete") showPopup(new Array("閉じる"),bookmarkBack,"ご確認","\r\n\r\n"+this.info.basicDescription.title+"\r\nをマイビデオに登録しました。","");
			else showPopup(new Array("閉じる"),bookmarkBack,"エラー",setErrMsg(getBmlErr("094","39")),"");
		}
	}else if(this.btnState[idx]=="tPlay"){
		if(this.info.broadCastEvent!=null&&this.info.broadCastEvent.serviceId!="")epgTuneProc(this.info.broadCastEvent.serviceId);
	}else if(this.btnState[idx]=="vPlay"){
		if(this.info.contentDetail.activeLicense!=null&&this.info.contentDetail.activeLicense.programUrl!=""){
			if(this.info.contentDetail.stopposition!=""&&String(this.info.contentDetail.stopposition)!="0.0"){
				// レジューム再生有り
				detail_blur(idx);
				gResumeUrl=gState.downbox.info.contentDetail.activeLicense.programUrl;
				showPopup(new Array("続きから視聴","最初から視聴"),goResume,"ご確認","\r\n\r\nこの作品を再生します。\r\n前回の視聴終了地点："+getStopString(this.info.contentDetail.stopposition),"");
			}else{
				// レジューム再生無し(従来通り)
				setReturnDataOnQuery();
				gState.return_timing="return";
				gState.return_bmltype=0;
				browser.launchIPTVContent(this.info.contentDetail.activeLicense.programUrl,gState.getUrl(BASE_URI+gState.curBml),0);
				gState.return_timing="none";
			}
		}
	}else if(this.btnState[idx]=="pList"){
		detail_blur(idx);
		gPlaySound=false;
		if(this.info.displayType=="video_package") showPackList(this.info,true,searchVODMemberOf);
		else showPackList(this.info,true,searchCHSVODMemberOf);
	}else if(this.btnState[idx]=="buy"){
		if(checkUser()==1){
			detail_blur(idx);
			trialPop(goDetail);
			return;
		}
		gPlaySound=false;
		if(gBuyPopData.show()){
			detail_blur(idx);
		}
	}else if(this.btnState[idx]=="kist"){
		this.page++;
		if(this.kist==null) this.page=0;
		else if(this.page>=this.kist.totalCount) this.page=0;
		if(this.getKist(ispid,mode,age)){
			setText("bt_kistt",(this.page+1)+"/"+this.kist.totalCount);
			setText("d_synopsys",this.kist.synopsis);
		}
	}else if(this.btnState[idx]=="trailer"){
		setReturnDataOnQuery();
		gState.return_timing="return";
		gState.return_bmltype=0;
		var trUrl=String(this.info.basicDescription.trailer);
		var ps=trUrl.indexOf("&drmid=$drmid$");
		if(ps>0)trUrl=trUrl.substring(0,ps)+trUrl.substring(ps+14);
		var drmId=getDRMID("marlin_iptv_es");
		var drmTxt="";
		if(drmId!=null&&String(drmId)!="NaN")drmTxt+=("&drmid="+String(drmId.indexOf("0x")==0?drmId.substring(2):drmId).toLowerCase());
		browser.launchIPTVContent(trUrl+drmTxt,gState.getUrl(BASE_URI+gState.curBml)+"&htvtl=1",0);
		gState.return_timing="none";
	}else if(this.btnState[idx]=="related"){
		detail_blur(idx);
		gPlaySound=false;
		showRelated(this.info,false);
	}else if(this.btnState[idx].indexOf("pack")==0){
		var midx=Number(this.btnState[idx].substring(4,5));
		if(isNaN(midx)) return;
		if(this.packLicense==null) return;
//		gState.upbox.listObj=null;
		gPackFromCont=true;
		detail_blur(idx);
		gPlaySound=false;
		showByContentInformation(this.packLicense[midx].crid,this.packLicense[midx].displayType,false);
	}else if(this.btnState[idx]=="karaoke"){
		launchKaraokeTop();
	}
}
function DT_init(info){
	this.kist = null;
	this.page = 0;
	this.maxpage = 0;
	this.focusflg=new Array(false,false,false,false,false,false,false,false);
	this.btnState=new Array("","","","","","","","");

	this.info=info;
	this.crid=info.crid;
	this.displayType=info.displayType;
	gBuyPopData=null;
}
function DT_isfocus(){
	var i;
	for(i=0;i<8;i++) if(this.focusflg[i]){return true;}
	return false;
}
function DT_focus(code){
	var i;
	if(code==1){
		for(i=7;0<=i;i--){
			if(this.focusflg[i]){
				detail_focus(i);
				return;
			}
		}
	}else if(code==2||code==-1){
		for(i=0;i<8;i++){
			if(this.focusflg[i]){
				detail_focus(i);
				return;
			}
		}
	}
}
function DT_show(ispid,mode,age){
	setImg("base","images/bg_ptn02.png");
	showElem("base");
	if(!gFOff){
		unlockScreen();
		keyOff();
		lockScreen();
	}
	if(!this.setResume())return false;
	this.showright(ispid,mode,age);
	this.showleft();
	return true;
}
function DT_setResume(){
	if(this.info.displayType!="video_program") return true;
	var i=0,time="",tFlg=false;
	for(var i=0;i<gState.outofbml_data.length;i++){
		var ary=gState.outofbml_data[i].split("=");
		if(ary[0].toLowerCase()=="stoppos"){
			time=ary[1];
		}else if(ary[0].toLowerCase()=="htvtl"){
			tFlg=true;
		}
	}
	if(time!=""&&tFlg==false){
		// レジューム登録
		setResumeFunc(this.info.contentDetail.cid,time);
		var obj=getConDet(this.info.crid,this.info.displayType,gState.ispid,gState.mode,gState.age);
		if(obj==null){gState.outofbml_data=new Array();return false;}
		this.info=obj;
		this.crid=obj.crid;
		this.displayType=obj.displayType;
	}
	gState.outofbml_data=new Array();
	return true;
}
function setResumeFunc(cid,stopposition){
	var drmId=getDRMID("marlin_iptv_es");
	if(drmId==null||String(drmId)=="NaN"){
		return false;
	}
	var arr=browser.checkIPTVServiceRegistrationInfo(IP_SERVICE_PROVIDER_ID);
	if(arr==null||arr[0]==""){
		return false;
	}
	var resume=setResume(cid, stopposition, drmId, arr[0]);
	if(resume==null){
		var ret=getErrStat();
		if(ret==null) resume=setResume(cid, stopposition, drmId, arr[0]);
	}
	if(resume=="OK") return true;
	return false;
}
function DT_showtvBtn(){
	this.showBtn();
}
function SBData(){
	this.focusflg=false;
	this.btnState="";
	this.btnImage="";
	this.focusimage="";
	this.priod_text_r="";
	this.priod_text="";
}
function getShowKaraokeBtnData(info){
	var ret = new SBData();
	var detail = info.contentDetail;
	var period = info.period;
	var displayType=info.displayType;
	var i,j;
	var quantity_str="";
	var period_str="";
	var perido_str_red=false;
	var ledate=new Date();
	var day=NaN;
	var license=false;
	var flg=false;
	var purchaseLicense=new Array();
	var term=new Array();
	var activeflg=false;
	var activearr=new Array();
	var quantity_str_arr=new Array();
	var activetermarr=new Array();
	var tmparr;
	var nopurchase=false;

	if(detail.activeLicense!=null){
		license=true;
	}
	//デモ不可
	if(detail.demoNG == 1&& gState.ispid==String(ISPID_DEMO)) {
		flg=true;
		ret.btnImage="images/bt_demof.png";
		ret.focusimage="images/bt_demof";
		ret.focusflg=false;
		ret.btnState="";
	}
	// 配信ステータス
	if(info.icon.delivery!=1){
		flg=true;
		ret.btnImage="images/bt_viewf.png";
		ret.focusimage="images/bt_viewf";
		ret.focusflg=false;
		ret.btnState="";
	}
	//デモ不可でなくアクティブライセンスが存在する場合
	if(flg==false && license==true){
		term=new Array();
		term[0]=detail.activeLicense.licenseStart;
		term[1]=detail.activeLicense.licenseEnd;
		if(term[0]==null) term[0]=new Array(2000,1,1,0,0,0);
		if(term[1]==null) term[1]=new Array(2050,1,1,0,0,0);
		//ライセンスが範囲内の場合
		if((dateCheck(term[0])==true||term[0]==null) &&
		   (dateCheck(term[1])==false||term[1]==null)){
			flg=true;

			ret.btnState="";
			ret.focusflg=false;

		   	if(detail.activeLicense.licenseId!=""){ // 関係ライセンス
				ret.btnImage="images/bt_riyok.png";
				ret.focusimage="images/bt_riyok";
		   	}else{// 自ライセンス
				ret.btnImage="images/bt_buyz.png";
				ret.focusimage="images/bt_buyz";
			   	// 価格・期限取得
				if(term[1]!=null&&term[1]!=""){
					ledate=term[1];
					if(ledate[0]==9999&&ledate[1]==12&&ledate[2]==31&&ledate[3]==23&&ledate[4]==59&&ledate[5]==59){
						quantity_str_arr=new Array();
						perido_str_red=false;
						period_str="毎月自動継続";
					}else{
						day = subDate(ledate,new Date(),4);
						if(!isNaN(day)){
							if(0<=day&&day<7){
								perido_str_red=true;
								if((ledate[3]==23&&ledate[4]==59&&ledate[5]==59)){
									period_str="● "+String(ledate[1])+"/"+ledate[2]+"まで利用可能";
								}else{
									period_str="● "+String(ledate[1])+"/"+ledate[2]+" "+padding("00",ledate[3])+":"+padding("00",ledate[4])+"まで利用可能";
								}
							}else if(7<=day&&day<30){
								perido_str_red=false;
								if((ledate[3]==23&&ledate[4]==59&&ledate[5]==59)){
									period_str="● "+String(ledate[1])+"/"+ledate[2]+"まで利用可能";
								}else{
									period_str="● "+String(ledate[1])+"/"+ledate[2]+" "+padding("00",ledate[3])+":"+padding("00",ledate[4])+"まで利用可能";
								}
							}
							else{
								if(detail.purchaseLicense!=null&&detail.purchaseLicense.length>0&&detail.purchaseLicense[0].licenseType=="skaraoke") period_str="毎月自動継続";
								perido_str_red=false;
							}
						}
					}
				}
		   	}
		}
	}
	//デモ不可でなく、アクティブライセンスが存在しないか範囲外の場合
	if(flg==false){
		purchaseLicense=new Array();
		//パック売りのみの場合は処理を行わない
		if(detail.purchaseLicense==null||detail.purchaseLicense.length==0){nopurchase=true;}
		else{
			for(i=0,j=0;i<detail.purchaseLicense.length;i++){
				if(!detail.purchaseLicense[i])continue;
				else if(detail.purchaseLicense[i].purchaseId==null)continue;
				else if(detail.purchaseLicense[i].purchaseId=="")continue;
				else {
					purchaseLicense[j]=detail.purchaseLicense[i];
					j++;
				}
			}
		}
		if(purchaseLicense.length==0){nopurchase=true;}
		else{
			//termを生成
			for(i=0;i<5&&i<purchaseLicense.length;i++){
				term[i]=new Array();
				term[i][0]=purchaseLicense[i].purchaseStart;//開始
				term[i][1]=purchaseLicense[i].purchaseEnd;;//終了
				if(term[i][0]==null) term[i][0]=new Array(2000,1,1,0,0,0);
				if(term[i][1]==null) term[i][1]=new Array(2050,1,1,0,0,0);


				term[i][2]=false;//期間内か否か
				if(interimCheck(term[i][0],term[i][1])){ // 範囲内かどうかの判定
					term[i][2]=true;
					activeflg=true;
				}
			}
			//term[n]で現在時間を含むものが存在した場合
			if(activeflg==true){
				flg=true;
				ret.focusflg=true;
				ret.btnState="buy";
				ret.btnImage="images/bt_buy.png";
				ret.focusimage="images/bt_buy";

				//終了時刻の配列を作りソート
				activearr=new Array();
				for(i=0,j=0;i<term.length;i++){
					if(term[i][2]){
						activearr[j]=new Array();
						activearr[j][0]=i;
						activearr[j][1]=term[i][1];
						j++;
					}
				}
				tmparr = sortFromDateIdxArr(activearr);
				activearr = new Array();
				//後ろから取り出す
				for(i=tmparr.length-1,j=0;i>=0;i--,j++) {
					activearr[j]=purchaseLicense[tmparr[i][0]];
					activetermarr[j]=term[tmparr[i][0]];
				}
				// 購入用データ保存
				gBuyPopData=new BuyPopData();
				gBuyPopData.init(activearr,activetermarr,displayType,detail.cid);
				// 価格
				for(i=0;i<activearr.length&&i<2;i++){
					quantity_str_arr[quantity_str_arr.length]="■ "+activearr[i].price+"円(税込)／"+activearr[i].quantityRange+activearr[i].quantityUnit;
				}
				//期限取得
				for(i=0;i<activetermarr.length&&i<1;i++){
					ledate=activetermarr[i][1];
					if((ledate) && period_str==""){
						day = subDate(ledate,new Date(),4);
						if(!isNaN(day)){
							if(0<=day&&day<7){
								perido_str_red=true;
								if((ledate[3]==23&&ledate[4]==59&&ledate[5]==59)){
									period_str="● "+String(ledate[1])+"/"+ledate[2]+"まで購入可能";
								}else{
									period_str="● "+String(ledate[1])+"/"+ledate[2]+" "+padding("00",ledate[3])+":"+padding("00",ledate[4])+"まで購入可能";
								}
							}else if(7<=day&&day<30){
								perido_str_red=false;
								if((ledate[3]==23&&ledate[4]==59&&ledate[5]==59)){
									period_str="● "+String(ledate[1])+"/"+ledate[2]+"まで購入可能";
								}else{
									period_str="● "+String(ledate[1])+"/"+ledate[2]+" "+padding("00",ledate[3])+":"+padding("00",ledate[4])+"まで購入可能";
								}
							}
							else{
								perido_str_red=false;
								period_str=" ";
							}
						}
					}
				}
			}
			//term[n]で現在時間を含むものが存在しない場合
			else{
				//開始時刻の配列を作りソート
				activearr=new Array();
				for(i=0,j=0;i<term.length;i++){
					if(term[i][0]!=null){
						activearr[j]=new Array();
						activearr[j][0]=i;
						activearr[j][1]=term[i][0];
						j++;
					}
				}
				tmparr = sortFromDateIdxArr(activearr);
				activearr = new Array();
				for(i=0;i<tmparr.length;i++) {
					activearr[i]=purchaseLicense[tmparr[i][0]];
					activetermarr[i]=term[tmparr[i][0]];
				}
				for(i=0,j=0;i<activearr.length&&j<2;i++) {
					// 未来チェック
					if(dateCheck(activetermarr[i][0])==false){
						flg=true;
						quantity_str_arr[quantity_str_arr.length]="■ "+activearr[i].price+"円(税込)／"+activearr[i].quantityRange+activearr[i].quantityUnit;
						j++;
					}
				}
				//未来が存在しなかった場合過去配信分があるかチェック
				if(j==0){
					for(i=0;i<activetermarr.length;i++) {
						if(dateCheck(activetermarr[i][1])==true)j++;
					}
					if(j!=0){
						flg=true;
						period_str="販売期間終了のため お買い上げいただくことができません";
					}
				//未来が存在した場合先頭の期間を表示
				}else{
					flg=true;
					ledate=null;
					for(i=0;i<tmparr.length;i++){
						if(dateCheck(tmparr[i][1])==false){
							ledate=tmparr[i][1];
							break;
						}
					}
					if(ledate){
						perido_str_red=false;
						if((ledate[3]==0&&ledate[4]==0&&ledate[5]==0)){
							period_str="● "+String(ledate[1])+"/"+ledate[2]+"より購入可能";
						}else{
							period_str="● "+String(ledate[1])+"/"+ledate[2]+" "+padding("00",ledate[3])+":"+padding("00",ledate[4])+"より購入可能";
						}
					}
				}
				if(flg==true){
					ret.focusflg=false;
					ret.btnState="";
					ret.btnImage="images/bt_buyf.png";
					ret.focusimage="images/bt_buyf";
				}
			}
		}
	}
	if(nopurchase==true){
		period_str="";
		ret.focusflg=false;
		ret.btnState="";
		ret.btnImage="images/bt_viewf.png";
		ret.focusimage="images/bt_viewf";
	}else if(flg==false){
		period_str="";
		ret.focusflg=false;
		ret.btnState="";
		ret.btnImage="images/bt_buyf.png";
		ret.focusimage="images/bt_buyf";
	}
	quantity_str="";
	if(quantity_str_arr.length!=0)quantity_str=quantity_str_arr[0];
	if(quantity_str_arr.length>1)quantity_str+="　 "+quantity_str_arr[1];

	if(perido_str_red){
		ret.priod_text=quantity_str;
		if(period_str==""||period_str==" ")ret.priod_text_r="";
		else{
			if(quantity_str=="") ret.priod_text_r=period_str;
			else ret.priod_text_r="　　"+period_str;
		}
	}else{
		if(quantity_str==""&&(period_str==""||period_str==" ")) ret.priod_text="";
		else if((period_str==""||period_str==" ")) ret.priod_text=quantity_str;
		else if(quantity_str=="") ret.priod_text=period_str;
		else ret.priod_text=quantity_str+"　　"+period_str;
		ret.priod_text_r="";
	}

	return ret;
}
function getShowBtnData(info){

	var ret = new SBData();

	var detail = info.contentDetail;
	var period = info.period;
	var displayType=info.displayType;
	var i,j;
	var endflg=false;
	var quantity_str="";
	var period_str="";
	var perido_str_red=false;
	var ledate=new Date();
	var day=NaN;
	var flg=false;
	var license=false;
	var term=new Array();
	var aterm=new Array();

	var day_a;
	var day_b;
	var day_a_date;
	var day_b_date;
	var activeflg=false;
	var activearr=new Array();
	var tmparr;
	var quantity_str_arr=new Array();
	var activetermarr=new Array();
	var haveTierbit=false;
	var purchaseLicense=new Array();
	var tmpStr;
	var start2="";
	var end2="";
	var stopFlg=false;
	var packSpFlg=false;

	if(detail.activeLicense!=null){
		license=true;
	}
	//デモ不可
	if(detail.demoNG == 1&& gState.ispid==String(ISPID_DEMO)) {
		flg=true;
		ret.btnImage="images/bt_demof.png";
		ret.focusimage="images/bt_demof";
		ret.focusflg=false;
		ret.btnState="";
	}
	// 配信ステータス
	if(info.icon.delivery!=1){
		flg=true;
		ret.btnImage="images/bt_viewf.png";
		ret.focusimage="images/bt_viewf";
		ret.focusflg=false;
		ret.btnState="";
	}
	//tv_channelの場合はティアビットの状態を確認
	if(displayType=="tv_channel"){
		if(info.broadCastEvent)
			if(hasTvViewLicense(info.broadCastEvent.licenseId,info.broadCastEvent.tierbit))
				haveTierbit=true;
	}
	//デモ不可でなくアクティブライセンスが存在する場合
	if(flg==false && license==true){
		term=new Array();
		if(displayType=="tv_channel"){
			start2=period.availabilityStart;
			end2=period.availabilityEnd;
			if(detail.activeLicense.licenseEnd!=null && start2 != null)
				if( subDateArr(detail.activeLicense.licenseEnd,start2) > 0)stopFlg=true;
			if(end2!=null && detail.activeLicense.licenseStart != null)
				if(subDateArr(end2,detail.activeLicense.licenseStart) > 0)stopFlg=true;
			if(stopFlg==false){
				day_a=new Array(2000,1,1,0,0,0);
				day_b=new Array(2000,1,1,0,0,0);
				if(start2!=null)day_a=start2;
				if(detail.activeLicense.licenseStart!=null)day_b=detail.activeLicense.licenseStart;
				day_a_date=createDate(day_a);
				day_b_date=createDate(day_b);
				if(day_a_date==null){day_a=new Array(2000,0,1,0,0,0);day_a_date=createDate(day_a);}
				if(day_b_date==null){day_b=new Array(2000,0,1,0,0,0);day_b_date=createDate(day_b);}

				if(subDateArr(day_a,day_b) < 0)term[0]=day_a;
				else term[0]=day_b;

				day_a=new Array(2050,1,1,0,0,0);
				day_b=new Array(2050,1,1,0,0,0);
				if(end2!=null)day_a=end2;
				if(detail.activeLicense.licenseEnd!=null)day_b=detail.activeLicense.licenseEnd;
				day_a_date=createDate(day_a);
				day_b_date=createDate(day_b);
				if(day_a_date==null){day_a=new Array(2050,0,1,0,0,0);day_a_date=createDate(day_a);}
				if(day_b_date==null){day_b=new Array(2050,0,1,0,0,0);day_b_date=createDate(day_b);}
				if(subDateArr(day_a,day_b) > 0)term[1]=day_a;
				else term[1]=day_b;
			}
		}else{
			term[0]=detail.activeLicense.licenseStart;
			term[1]=detail.activeLicense.licenseEnd;
		}
		aterm=term;
		//ライセンスが範囲内の場合
		if((dateCheck(term[0])==true||term[0]==null) &&
		   (dateCheck(term[1])==false||term[1]==null)&&
		   stopFlg==false){
			flg=true;

			if( displayType!="tv_channel" || (displayType=="tv_channel"&&haveTierbit==true)){
				ret.focusflg=true;
				if(displayType=="tv_channel")ret.btnState="tPlay";
				else ret.btnState="vPlay";
				if(displayType=="channel_package")ret.btnState="pList";
				else if(displayType=="video_package")ret.btnState="pList";
				else if(displayType=="subscription_package")ret.btnState="pList";
				else if(displayType=="channel_svod")ret.btnState="pList";
				else if(displayType=="series_svod")ret.btnState="pList";
				ret.btnImage="images/bt_view.png";
				ret.focusimage="images/bt_view";
			}else if(displayType=="tv_channel"&&haveTierbit==false){
				period_str="";
				ret.focusflg=false;
				ret.btnState="";
				ret.btnImage="images/bt_viewf.png";
				ret.focusimage="images/bt_viewf";
			}
			// 価格・期限取得
			if(term[1]!=null&&term[1]!=""){
				ledate=term[1];
				if(ledate[0]==9999&&ledate[1]==12&&ledate[2]==31&&ledate[3]==23&&ledate[4]==59&&ledate[5]==59){
					quantity_str_arr=new Array();
					perido_str_red=false;
					period_str="毎月自動継続";
				}else{
					day = subDate(ledate,new Date(),4);
					if(!isNaN(day)){
						if(0<=day&&day<7){
							perido_str_red=true;
							if((ledate[3]==23&&ledate[4]==59&&ledate[5]==59)){
								period_str="● "+String(ledate[1])+"/"+ledate[2]+"まで視聴可能";
							}else{
								period_str="● "+String(ledate[1])+"/"+ledate[2]+" "+padding("00",ledate[3])+":"+padding("00",ledate[4])+"まで視聴可能";
							}
						}else if(7<=day&&day<30){
							perido_str_red=false;
							if((ledate[3]==23&&ledate[4]==59&&ledate[5]==59)){
								period_str="● "+String(ledate[1])+"/"+ledate[2]+"まで視聴可能";
							}else{
								period_str="● "+String(ledate[1])+"/"+ledate[2]+" "+padding("00",ledate[3])+":"+padding("00",ledate[4])+"まで視聴可能";
							}
						}
						else if(displayType=="tv_channel"){
							if((detail.purchaseLicense==null||detail.purchaseLicense.length==0)&&(detail.packPurchaseLicense==null||detail.packPurchaseLicense.length==0)){
							}else{
								perido_str_red=false;
								period_str="毎月自動継続";
							}
						}else if(displayType=="channel_package"||displayType=="subscription_package"||displayType=="channel_svod"||displayType=="series_svod"){
							perido_str_red=false;
							period_str="毎月自動継続";
						}
					}
				}
			}
		}
	}
	if(flg==false){
		if( displayType=="tv_channel" && haveTierbit==true){
			flg=true;
			ret.focusflg=true;
			ret.btnState="tPlay";
			ret.btnImage="images/bt_view.png";
			ret.focusimage="images/bt_view";
		}
	}
	//デモ不可でなく、アクティブライセンスが存在しないか範囲外の場合
	if(flg==false){
		purchaseLicense=new Array();
		//パック売りのみの場合は処理を行わない
		if(detail.purchaseLicense==null||detail.purchaseLicense.length==0){}
		else{
			for(i=0,j=0;i<detail.purchaseLicense.length;i++){
				if(!detail.purchaseLicense[i])continue;
				else if(detail.purchaseLicense[i].purchaseId==null)continue;
				else if(detail.purchaseLicense[i].purchaseId=="")continue;
				else {
					purchaseLicense[j]=detail.purchaseLicense[i];
					j++;
				}
			}
		}
		if(purchaseLicense.length==0){}
		else{
			activeflg=false;
			term=new Array();
			//termを生成
			for(i=0;i<5&&i<purchaseLicense.length;i++){
				term[i]=new Array();
				term[i][0]=null;//開始
				term[i][1]=null;//終了
				term[i][2]=false;//期間内か否か
				if(displayType=="channel_package"||displayType=="subscription_package"||displayType=="channel_svod"||displayType=="video_package"||displayType=="series_svod"){
					day_a=new Array(2000,1,1,0,0,0);
					if(purchaseLicense[i].purchaseStart!=null)day_a=purchaseLicense[i].purchaseStart;
					day_a_date=createDate(day_a);
					if(day_a_date==null){day_a=new Array(2000,0,1,0,0,0);day_a_date=createDate(day_a);}
					term[i][0]=day_a;

					day_b=new Array(2050,1,1,0,0,0);
					if(purchaseLicense[i].purchaseEnd!=null)day_b=purchaseLicense[i].purchaseEnd;
					day_b_date=createDate(day_b);
					if(day_b_date==null){day_b=new Array(2050,0,1,0,0,0);day_b_date=createDate(day_b);}
					term[i][1]=day_b;
					if(interimCheck(term[i][0],term[i][1])){
						term[i][2]=true;
						activeflg=true;
					}
				}else{
					if(displayType=="tv_channel"){
						start2=period.availabilityStart;
						end2=period.availabilityEnd;
					}else{
						start2=purchaseLicense[i].validityIntervalStart;
						end2=purchaseLicense[i].validityIntervalEnd;
					}
					if(purchaseLicense[i].purchaseEnd!=null && start2 != null)
						if( subDateArr(purchaseLicense[i].purchaseEnd,start2) > 0)continue;
					if(end2!=null && purchaseLicense[i].purchaseStart != null)
						if(subDateArr(end2,purchaseLicense[i].purchaseStart) > 0)continue;

					day_a=new Array(2000,1,1,0,0,0);
					day_b=new Array(2000,1,1,0,0,0);
					if(start2!=null)day_a=start2;
					if(purchaseLicense[i].purchaseStart!=null)day_b=purchaseLicense[i].purchaseStart;
					day_a_date=createDate(day_a);
					day_b_date=createDate(day_b);
					if(day_a_date==null){day_a=new Array(2000,0,1,0,0,0);day_a_date=createDate(day_a);}
					if(day_b_date==null){day_b=new Array(2000,0,1,0,0,0);day_b_date=createDate(day_b);}
					if(subDateArr(day_a,day_b) < 0)term[i][0]=day_a;
					else term[i][0]=day_b;

					day_a=new Array(2050,1,1,0,0,0);
					day_b=new Array(2050,1,1,0,0,0);
					if(end2!=null)day_a=end2;
					if(purchaseLicense[i].purchaseEnd!=null)day_b=purchaseLicense[i].purchaseEnd;
					day_a_date=createDate(day_a);
					day_b_date=createDate(day_b);
					if(day_a_date==null){day_a=new Array(2050,0,1,0,0,0);day_a_date=createDate(day_a);}
					if(day_b_date==null){day_b=new Array(2050,0,1,0,0,0);day_b_date=createDate(day_b);}
					if(subDateArr(day_a,day_b) > 0)term[i][1]=day_a;
					else term[i][1]=day_b;
				}
				if(interimCheck(term[i][0],term[i][1])){
					term[i][2]=true;
					activeflg=true;
				}
			}
			//term[n]で現在時間を含むものが存在した場合
			if(activeflg==true){
				flg=true;
				ret.focusflg=true;
				ret.btnState="buy";
				ret.btnImage="images/bt_buy.png";
				ret.focusimage="images/bt_buy";

				//終了時刻の配列を作りソート
				activearr=new Array();
				for(i=0,j=0;i<term.length;i++){
					if(term[i][2]){
						activearr[j]=new Array();
						activearr[j][0]=i;
						activearr[j][1]=term[i][1];
						j++;
					}
				}
				tmparr = sortFromDateIdxArr(activearr);
				activearr = new Array();
				//後ろから取り出す
				for(i=tmparr.length-1,j=0;i>=0;i--,j++) {
					activearr[j]=purchaseLicense[tmparr[i][0]];
					activetermarr[j]=term[tmparr[i][0]];
				}
				// 購入用データ保存
				gBuyPopData=new BuyPopData();
				gBuyPopData.init(activearr,activetermarr,displayType,detail.cid);
				for(i=0;i<activearr.length&&i<2;i++){
					// 価格・期限取得
					quantity_str_arr[quantity_str_arr.length]="■ "+activearr[i].price+"円(税込)／"+activearr[i].quantityRange+activearr[i].quantityUnit;
				}
				for(i=0;i<activetermarr.length&&i<1;i++){
					ledate=activetermarr[i][1];
					if((ledate) && period_str==""){
						day = subDate(ledate,new Date(),4);
						if(!isNaN(day)){
							if(0<=day&&day<7){
								perido_str_red=true;
								if((ledate[3]==23&&ledate[4]==59&&ledate[5]==59)){
									period_str="● "+String(ledate[1])+"/"+ledate[2]+"まで購入可能";
								}else{
									period_str="● "+String(ledate[1])+"/"+ledate[2]+" "+padding("00",ledate[3])+":"+padding("00",ledate[4])+"まで購入可能";
								}
							}else if(7<=day&&day<30){
								perido_str_red=false;
								if((ledate[3]==23&&ledate[4]==59&&ledate[5]==59)){
									period_str="● "+String(ledate[1])+"/"+ledate[2]+"まで購入可能";
								}else{
									period_str="● "+String(ledate[1])+"/"+ledate[2]+" "+padding("00",ledate[3])+":"+padding("00",ledate[4])+"まで購入可能";
								}
							}
							else if(displayType=="tv_channel"){
								perido_str_red=false;
								period_str=" ";
							}
						}
					}
				}
			}
			//term[n]で現在時間を含むものが存在しない場合
			else{
				//開始時刻の配列を作りソート
				activearr=new Array();
				for(i=0,j=0;i<term.length;i++){
					if(term[i][0]!=null){
						activearr[j]=new Array();
						activearr[j][0]=i;
						activearr[j][1]=term[i][0];
						j++;
					}
				}
				tmparr = sortFromDateIdxArr(activearr);
				activearr = new Array();
				for(i=0;i<tmparr.length;i++) {
					activearr[i]=purchaseLicense[tmparr[i][0]];
					activetermarr[i]=term[tmparr[i][0]];
				}
				for(i=0,j=0;i<activearr.length&&j<2;i++) {
					// 未来チェック
					if(dateCheck(activetermarr[i][0])==false){
						flg=true;
						quantity_str_arr[quantity_str_arr.length]="■ "+activearr[i].price+"円(税込)／"+activearr[i].quantityRange+activearr[i].quantityUnit;
						j++;
					}
				}
				//未来が存在しなかった場合過去配信分があるかチェック
				if(j==0){
					for(i=0;i<activetermarr.length;i++) {
						if(dateCheck(activetermarr[i][1])==true)j++;
					}
					if(j!=0){
						period_str="販売期間終了のため お買い上げいただくことができません";
						packSpFlg=false;
						endflg=true;
					}
				//未来が存在した場合先頭の期間を表示
				}else{
					flg=true;
					ledate=null;
					for(i=0;i<tmparr.length;i++){
						if(dateCheck(tmparr[i][1])==false){
							ledate=tmparr[i][1];
							break;
						}
					}
					if(ledate){
						perido_str_red=false;
						if((ledate[3]==0&&ledate[4]==0&&ledate[5]==0)){
							period_str="● "+String(ledate[1])+"/"+ledate[2]+"より購入可能";
						}else{
							period_str="● "+String(ledate[1])+"/"+ledate[2]+" "+padding("00",ledate[3])+":"+padding("00",ledate[4])+"より購入可能";
						}
					}
				}
				if(flg==true){
					endflg=false;
					ret.focusflg=false;
					ret.btnState="";
					ret.btnImage="images/bt_buyf.png";
					ret.focusimage="images/bt_buyf";
				}
			}
		}
	}
	if(flg==false){
		if(displayType=="video_program"||displayType=="tv_channel"){
			term = getPurchaseLicense(info);
			if(term==null){
				term=new Array();
			}else{
				for(i=0;i<term.length;i++){
					if(term[i][2]) activeflg=true;
				}
				//term[n]で現在時間を含むものが存在した場合
				if(activeflg==true){
					flg=true;
					period_str="";
					//終了時刻の配列を作りソート
					activearr=new Array();
					for(i=0,j=0;i<term.length;i++){
						if(term[i][2]){
							activearr[j]=new Array();
							activearr[j][0]=i;
							activearr[j][1]=term[i][1];
							j++;
						}
					}
					tmparr = sortFromDateIdxArr(activearr);
					activearr = new Array();
					for(i=tmparr.length-1,j=0;i>=0;i--,j++) {
						activearr[j]=purchaseLicense[tmparr[i][0]];
						activetermarr[j]=term[tmparr[i][0]];
					}
					quantity_str_arr=new Array();
					for(i=0;i<activetermarr.length&&i<1;i++){
						ledate=activetermarr[i][1];
						if((ledate) && period_str==""){
							day = subDate(ledate,new Date(),4);
							if(!isNaN(day)){
								if(0<=day&&day<7){
									perido_str_red=true;
									if((ledate[3]==23&&ledate[4]==59&&ledate[5]==59)){
										period_str="● "+String(ledate[1])+"/"+ledate[2]+"まで配信";
									}else{
										period_str="● "+String(ledate[1])+"/"+ledate[2]+" "+padding("00",ledate[3])+":"+padding("00",ledate[4])+"まで配信";
									}
								}else if(7<=day&&day<30){
									perido_str_red=false;
									if((ledate[3]==23&&ledate[4]==59&&ledate[5]==59)){
										period_str="● "+String(ledate[1])+"/"+ledate[2]+"まで配信";
									}else{
										period_str="● "+String(ledate[1])+"/"+ledate[2]+" "+padding("00",ledate[3])+":"+padding("00",ledate[4])+"まで配信";
									}
								}
							}
						}
					}
					if(period_str==""){
						if(displayType=="tv_channel") period_str="パックの購入で視聴可能となります";
						else period_str="パック（プレミアムパック）の購入で視聴可能となります";
					}
				}
				//term[n]で現在時間を含むものが存在しない場合
				else{
					//開始時刻の配列を作りソート
					activearr=new Array();
					for(i=0,j=0;i<term.length;i++){
						if(term[i][0]!=null){
							activearr[j]=new Array();
							activearr[j][0]=i;
							activearr[j][1]=term[i][0];
							j++;
						}
					}
					tmparr = sortFromDateIdxArr(activearr);
					activearr = new Array();
					for(i=0;i<tmparr.length;i++) {
						activearr[i]=purchaseLicense[tmparr[i][0]];
						activetermarr[i]=term[tmparr[i][0]];
					}
					for(i=0,j=0;i<activearr.length&&j<2;i++) {
						// 未来チェック
						if(dateCheck(activetermarr[i][0])==false){
							flg=true;
							j++;
						}
					}
					//未来が存在しなかった場合過去配信分があるかチェック
					if(j==0){
						for(i=0;i<activetermarr.length;i++) {
							if(dateCheck(activetermarr[i][1])==true)j++;
						}
						if(j!=0){
							if(endflg){
								period_str="販売期間終了のため お買い上げいただくことができません";
								packSpFlg=false;
							}else{
								period_str="配信期間終了のため、ご覧いただくことができません";
								packSpFlg=true;
							}
							endflg=true;
						}
					//未来が存在した場合先頭の期間を表示
					}else{
						ledate=null;
						for(i=0;i<tmparr.length;i++){
							if(dateCheck(tmparr[i][1])==false){
								ledate=tmparr[i][1];
								break;
							}
						}
						if(ledate){
							perido_str_red=false;
							if((ledate[3]==0&&ledate[4]==0&&ledate[5]==0)){
								period_str="● "+String(ledate[1])+"/"+ledate[2]+"より配信";
							}else{
								period_str="● "+String(ledate[1])+"/"+ledate[2]+" "+padding("00",ledate[3])+":"+padding("00",ledate[4])+"より配信";
							}
						}
					}
				}
				if(flg==true){
					endflg=false;
					//period_str="";
					ret.focusflg=false;
					ret.btnState="";
					ret.btnImage="images/bt_viewf.png";
					ret.focusimage="images/bt_viewf";
				}
			}
		}
	}
	//上記条件に引っかからずアクティブライセンスが存在する場合
	if(flg==false && license==true){
		if(displayType=="channel_package"||displayType=="subscription_package"||displayType=="channel_svod"||displayType=="video_package"||displayType=="series_svod"){}
		else{
			flg=true;
			ret.focusflg=false;
			ret.btnState="";
			ret.btnImage="images/bt_viewf.png";
			ret.focusimage="images/bt_viewf";
			if(aterm[0]!=null&&!dateCheck(aterm[0])){
				ledate=aterm[0];
				if((ledate[3]==0&&ledate[4]==0&&ledate[5]==0)){
					period_str="● "+String(ledate[1])+"/"+ledate[2]+"より配信";
				}else{
					period_str="● "+String(ledate[1])+"/"+ledate[2]+" "+padding("00",ledate[3])+":"+padding("00",ledate[4])+"より配信";
				}
			}else if(aterm[1]!=null&&dateCheck(aterm[1])){
				if( displayType=="tv_channel" && haveTierbit==true){
					flg=true;
					ret.focusflg=true;
					ret.btnState="tPlay";
					ret.btnImage="images/bt_view.png";
					ret.focusimage="images/bt_view";
				}
				else period_str="配信期間終了のため ご覧いただくことができません";
			}
		}
	}
	if(flg==false&&endflg==false){
		period_str="";
		ret.focusflg=false;
		ret.btnState="";
		ret.btnImage="images/bt_viewf.png";
		ret.focusimage="images/bt_viewf";
	}else if(flg==false&&endflg==true){
		if(packSpFlg==true){
			ret.focusflg=false;
			ret.btnState="";
			ret.btnImage="images/bt_viewf.png";
			ret.focusimage="images/bt_viewf";
		}else{
			ret.focusflg=false;
			ret.btnState="";
			ret.btnImage="images/bt_buyf.png";
			ret.focusimage="images/bt_buyf";
		}
	}

	quantity_str="";
	if(quantity_str_arr.length!=0)quantity_str=quantity_str_arr[0];
	if(quantity_str_arr.length>1)quantity_str+="　 "+quantity_str_arr[1];

	if(perido_str_red){
		ret.priod_text=quantity_str;
		if(period_str==""||period_str==" ")ret.priod_text_r="";
		else{
			if(quantity_str=="") ret.priod_text_r=period_str;
			else ret.priod_text_r="　　"+period_str;
		}
	}else{
		if(quantity_str==""&&(period_str==""||period_str==" ")) ret.priod_text="";
		else if((period_str==""||period_str==" ")) ret.priod_text=quantity_str;
		else if(quantity_str=="") ret.priod_text=period_str;
		else ret.priod_text=quantity_str+"　　"+period_str;
		ret.priod_text_r="";
	}

	return ret;
}
function DT_showBtn(){
	var ret =null;
	if(this.displayType=="karaoke_package"){
		ret = getShowKaraokeBtnData(this.info);
	}else{
		ret = getShowBtnData(this.info);
		if((this.info.displayType!="video_program")&&(this.info.displayType!="tv_channel")&&ret.btnState=="pList"){
			ret.focusflg=false;
			ret.btnState="";
			ret.btnImage="images/bt_buyz.png";
			ret.focusimage="images/bt_buyz";
		}
	}
	if((this.info.displayType=="channel_package"||this.info.displayType=="subscription_package"||this.info.displayType=="channel_svod"||this.info.displayType=="video_package"||this.info.displayType=="series_svod"||this.info.displayType=="karaoke_package")&&(ret.btnImage=="images/bt_viewf.png")){
		ret.focusflg=false;
		ret.btnState="";
		ret.btnImage="images/bt_buyf.png";
		ret.focusimage="images/bt_buyf";
	}

	this.focusflg[0]=ret.focusflg;
	this.btnState[0]=ret.btnState;
	setImg("btn0",ret.btnImage);
	showElem("btn0");
	gDetailfocusimage[0]=ret.focusimage;
	setText("subtitle",ret.priod_text);
	setText("d_period_r",ret.priod_text_r);
}
function DT_showright(ispid,mode,age){
	var i;
	var btnCnt=1;
	var tmp=0;

	if(this.info.displayType=="tv_channel"){
		this.showtvBtn();
	}else{
		this.showBtn();
	}
	if(this.getKist(ispid,mode,age)){
		if((this.info.displayType=="video_program")||(this.info.displayType=="tv_channel")||(this.info.displayType=="karaoke_package")){
			setImg("bt_kist","images/bt_kist.png");
			gDetailfocusimage[1]="images/bt_kist";
			showElem("bt_kist");
			setText("bt_kistt",(this.page+1)+"/"+this.kist.totalCount);
			setText("d_synopsys",this.kist.synopsis);
			if(this.kist.totalCount>1){
				this.focusflg[1]=true;
				this.btnState[1]="kist";
			}
		}else{
			if(this.kist!=null){
				setText("d_synopsys",this.kist.synopsis);
			}
//			if(this.btnState[0]!="pList"){
				setImg("bt_kist","images/bt_pnlst.png");
				gDetailfocusimage[1]="images/bt_pnlst";
				showElem("bt_kist");
				this.focusflg[1]=true;
				this.btnState[1]="pList";
//			}else{
//				hideElem("bt_kist");
//			}
		}
	}
	if((this.info.displayType=="video_program")||(this.info.displayType=="video_package")||(this.info.displayType=="subscription_package")||(this.info.displayType=="series_svod")){
		showElem("btn"+btnCnt);
		setText("btn"+btnCnt+"t","マイページ登録");
		this.focusflg[btnCnt+1]=true;
		this.btnState[btnCnt+1]="bookmark";
		btnCnt++;
	}	
	if(this.info.basicDescription.trailer!=""){
		showElem("btn"+btnCnt);
		setText("btn"+btnCnt+"t","予告編を見る");
		this.focusflg[btnCnt+1]=true;
		this.btnState[btnCnt+1]="trailer";
		btnCnt++;
	}
	if(this.info.contentDetail.hasRelated==1){
		showElem("btn"+btnCnt);
		setText("btn"+btnCnt+"t","関連作品");
		this.focusflg[btnCnt+1]=true;
		this.btnState[btnCnt+1]="related";
		btnCnt++;
	}
	tmp = btnCnt;
	if(this.getPckLicense(ispid,mode,age)){
		for(i=0;i<this.packLicense.length&&i<3;i++){
			if(this.packLicense[i].purchaseId!=""){
				showElem("btn"+btnCnt);
				setText("btn"+btnCnt+"t",this.packLicense[i].name);
				this.focusflg[btnCnt+1]=true;
				this.btnState[btnCnt+1]="pack"+i;
				btnCnt++;
			}
		}
	}
	if(this.displayType=="karaoke_package"){
		showElem("btn"+btnCnt);
		setText("btn"+btnCnt+"t","カラオケ");
		this.focusflg[btnCnt+1]=true;
		this.btnState[btnCnt+1]="karaoke";
		btnCnt++;
	}
	showElem("detail");
}

function DT_getPckLicense(ispid,mode,age){
	if(this.info.displayType=="tv_channel"||this.info.displayType=="video_program"){
		var term = getPurchaseLicense(this.info);
		if(term==null) return false;
		this.packLicense=new Array();
		for(var i=0;i<term.length;i++){
			if(term[i][2]) this.packLicense[this.packLicense.length]=this.info.contentDetail.packPurchaseLicense[i];
		}
		if(this.packLicense!=null||this.packLicense.length==0) return true;
	}
	return false;
}
function getPurchaseLicense(info){
	var term=new Array();
	var purchaseLicense=new Array();
	var j=0;
	var start=null;
	var end=null;
	var detail=info.contentDetail;

	if(detail.packPurchaseLicense==null||detail.packPurchaseLicense.length==0) return null;
	// 有効なIDを持っているか
	for(var i=0,j=0;i<detail.packPurchaseLicense.length;i++){
		if(!detail.packPurchaseLicense[i])continue;
		else if(detail.packPurchaseLicense[i].purchaseId==null)continue;
		else if(detail.packPurchaseLicense[i].purchaseId=="")continue;
		else {
			purchaseLicense[j]=detail.packPurchaseLicense[i];
			j++;
		}
	}
	if(purchaseLicense.length==0) return null;
	// パック販売期間の作成
	for(i=0;i<5&&i<purchaseLicense.length;i++){
		term[i]=new Array();
		term[i][0]=null;//開始
		term[i][1]=null;//終了
		term[i][2]=false;//期間内か否か
		start=purchaseLicense[i].validityIntervalStart;
		end=purchaseLicense[i].validityIntervalEnd;
		if(info.displayType=="tv_channel"){ // チャンネル紹介画面においては参照期間が異なる
			start=info.period.availabilityStart;
			end=info.period.availabilityEnd;
		}

		if(purchaseLicense[i].purchaseEnd!=null && start != null)
			if( subDateArr(purchaseLicense[i].purchaseEnd,start) > 0)continue;
		if(end!=null && purchaseLicense[i].purchaseStart != null)
			if(subDateArr(end,purchaseLicense[i].purchaseStart) > 0)continue;

		var day_a=new Array(2000,1,1,0,0,0);
		var day_b=new Array(2000,1,1,0,0,0);
		if(start!=null)day_a=start;
		if(purchaseLicense[i].purchaseStart!=null)day_b=purchaseLicense[i].purchaseStart;
		var day_a_date=createDate(day_a);
		var day_b_date=createDate(day_b);

		if(day_a_date==null){day_a=new Array(2000,0,1,0,0,0);day_a_date=createDate(day_a);}
		if(day_b_date==null){day_b=new Array(2000,0,1,0,0,0);day_b_date=createDate(day_b);}
		if(subDateArr(day_a,day_b) < 0)term[i][0]=day_a;
		else term[i][0]=day_b;
		day_a=new Array(2050,1,1,0,0,0);
		day_b=new Array(2050,1,1,0,0,0);

		if(end!=null)day_a=end;
		if(purchaseLicense[i].purchaseEnd!=null)day_b=purchaseLicense[i].purchaseEnd;
		day_a_date=createDate(day_a);
		day_b_date=createDate(day_b);

		if(day_a_date==null){day_a=new Array(2000,0,1,0,0,0);day_a_date=createDate(day_a);}
		if(day_b_date==null){day_b=new Array(2000,0,1,0,0,0);day_b_date=createDate(day_b);}
		if(subDateArr(day_a,day_b) > 0)term[i][1]=day_a;
		else term[i][1]=day_b;
		if(interimCheck(term[i][0],term[i][1])){
			term[i][2]=true;
		}
	}
	return term;
}
function DT_getKist(ispid,mode,age){
	var sfunc=null;
	this.kist=null;
	if((this.info.displayType=="channel_package")||(this.info.displayType=="subscription_package")||(this.info.displayType=="series_svod")||
	   (this.info.displayType=="channel_svod")||(this.info.displayType=="video_package")){
		this.kist=new LongSynopsis(1,this.info.basicDescription.synopsis);
		return true;
	}

	if(this.info.displayType=="video_program"){sfunc=getVODSynopsis;}
	else if((this.info.displayType=="tv_channel")){sfunc=getTVSynopsis;}
	else if(this.info.displayType=="karaoke_package"){sfunc=getKaraokeLicenseSynopsis;}

	if(sfunc==null) return false;

	this.kist=sfunc(this.info.crid,this.info.displayType,this.page,ispid,mode,age);
	if(this.kist!=null ) return true;
	var err=getErrStat();
	if(err==null) {
		this.kist=sfunc(this.info.crid,this.info.displayType,this.page,ispid,mode,age);
		if(this.kist!=null ) return true;
		err=getErrStat();
	}
	if(err==null) {/*再ログイン失敗*/}
	else{/*何かしらのエラー*/}
	return false;
}
function DT_showleft(){
	var icon = this.info.icon;
	setText("d_copyright",this.info.basicDescription.copyrightImage);
	var iconId = 0;
	if(this.info.displayType!="tv_channel"){
		if(this.info.displayType!="channel_package"){
			// プラン
			if(icon.basic==1){
				setImg("d_icon"+iconId,"images/icon_02.png");
				showElem("d_icon"+iconId);
				iconId++;
			}else if(icon.basic==2){
				setImg("d_icon"+iconId,"images/icon_32.png");
				showElem("d_icon"+iconId);
				iconId++;
			}
			if(icon.option!=""){
				setImg("d_icon"+iconId,icon.option);
				showElem("d_icon"+iconId);
				iconId++;
			}
		}
		// 音声
		if(icon.multi==1){
			setImg("d_icon"+iconId,"images/icon_08.png");
			showElem("d_icon"+iconId);
			iconId++;
		}else if(icon.multi==2){
			setImg("d_icon"+iconId,"images/icon_33.png");
			showElem("d_icon"+iconId);
			iconId++;
		}

		// 字幕
		if(icon.caption==1){
			setImg("d_icon"+iconId,"images/icon_09.png");
			showElem("d_icon"+iconId);
			iconId++;
		}
	}
	// コピー
	if(icon.copy==1){
		setImg("d_icon"+iconId,"images/icon_05.png");
		showElem("d_icon"+iconId);
		iconId++;
	}else if(icon.copy==2){
		setImg("d_icon"+iconId,"images/icon_06.png");
		showElem("d_icon"+iconId);
		iconId++;
	}else if(icon.copy==3){
		setImg("d_icon"+iconId,"images/icon_07.png");
		showElem("d_icon"+iconId);
		iconId++;
	}
	if((this.info.displayType!="tv_channel")&&(this.info.displayType!="channel_package")){
		// ハイビジョン
		if(icon.hd==1){
			setImg("d_icon"+iconId,"images/icon_01.png");
			showElem("d_icon"+iconId);
			iconId++;
		}
	}
	// 視聴制限
	var age = Number(this.info.basicDescription.parentalRate);
	if(this.info.displayType=="tv_channel"){
		if(this.info.basicDescription.isAdult==1){
			setImg("d_icon"+iconId,"images/icon_24.png");
			showElem("d_icon"+iconId);
			iconId++;
		}
	}else if(12<=age && age<20 ){
		setImg("d_icon"+iconId,"images/icon_"+(age+4)+".png");
		showElem("d_icon"+iconId);
		iconId++;
	}else if(20<=age){
		setImg("d_icon"+iconId,"images/icon_24.png");
		showElem("d_icon"+iconId);
		iconId++;
	}
	if(this.info.basicDescription.thumbLarge) setImg("dt_jpg",this.info.basicDescription.thumbLarge);
	else setImg("dt_jpg","images/noimage_03.jpg");
	showElem("dt_jpg");

}
function DT_hidden(){
	var i;
	hideElem("btn0");
	hideElem("bt_kist");
	setImg("dt_jpg","images/noimage_03.jpg");
	hideElem("dt_jpg");
	for(i=0;i<8;i++) hideElem("d_icon"+i);
	for(i=1;i<7;i++){
		hideElem("btn"+i);
		setText("btn"+i+"t","");
		setImg(gDetailfocusname[i+1],"images/bt_plain01.png");
	}
	setText("d_synopsys","");
	setText("bt_kistt","");
	setText("d_period","");
	setText("d_period_r","");
	setText("d_copyright","");
	setText("subtitle","");
	hideElem("detail");
}
function DT_get(){return null;}
function detail_focus(idx){
	playSound(9);
	if(idx!=0) setTxtCol(gDetailfocusname[idx]+"t","0","189 191");
	setImg(gDetailfocusname[idx],gDetailfocusimage[idx]+"-f.png");
	if(gState.upbox.objtype=="title"&&gState.upbox.f_focus){
		showElem("csrt0");
		showElem("csrt1");
	}else{
		hideElem("csrt0");
		hideElem("csrt1");
	}
	setFcs(gDetailfocusname[idx]);
}
function detail_blur(idx){
	if(idx!=0) setTxtCol(gDetailfocusname[idx]+"t","7","171 167");
	setImg(gDetailfocusname[idx],gDetailfocusimage[idx]+".png");
}
function detailkey(){
	var code = document.currentEvent.keyCode;
	var id = document.currentEvent.target.id;
	lockScreen();
	var idx=0;
	for(var i=0;i<9;i++){
		if(gDetailfocusname[i]==id){idx=i;break;}
	}

	if(code==1){
		detail_blur(idx);
		for(i=idx-1;0<=i;i--){
			if(gState.downbox.focusflg[i]){
				detail_focus(i);
				unlockScreen();
				return;
			}
		}
		if(gState.upbox.isfocus()){
			gState.upbox.focus(code);
		}else{
			scFocus();
			hideElem("csrt0");
			hideElem("csrt1");
		}
	}else if(code==2){
		detail_blur(idx);
		for(i=idx+1;i<9;i++){
			if(gState.downbox.focusflg[i]){
				detail_focus(i);
				unlockScreen();
				return;
			}
		}
		scFocus();
		hideElem("csrt0");
		hideElem("csrt1");
	}else if(code==3){
		if(gState.upbox.objtype=="title"&&gState.upbox.f_focus){
			detail_blur(idx);
			titleleftKey();
		}
	}else if(code==4){
		if(gState.upbox.objtype=="title"&&gState.upbox.f_focus){
			detail_blur(idx);
			titlerightKey();
		}
	}else if(code==18){
		playSound(7);
		gState.downbox.click(idx,gState.ispid,gState.mode,gState.age);
	}else if(code==19){
		detail_blur(idx);
		returnFunc();
	}
	unlockScreen();
}
//--------------------------------------------------------------
// リスト系
//--------------------------------------------------------------
//--------------------------------------------------------------------
function ListA(){
	this.objtype="lista";
	this.init=LA_init;
	this.load=LA_load;
	this.isfocus=LA_isfocus;
	this.focus=LA_focus;
	this.show=LA_show;
	this.hidden=LA_hidden;
	this.get=LA_get;
	this.numClick =LA_numClick;
	this.colorClick=LA_colorClick;
	this.chgPage=LA_chgPage;
	this.hideDetail=LA_hideDetail;
	this.showDetail=LA_showDetail;
	this.addIdx=LA_addIdx;
	this.setIdx=LA_setIdx;
	this.movefocus=LA_movefocus;
	this.getList=LA_getList;
	this.getListFunc=LA_getListFunc;
	this.setListIcon=LA_setListIcon;
	this.unit = 9;
	this.crid = null;
	this.sort = null;
	this.displayType=null;
	this.func=null;
	this.totalCount =0;
	this.list=new Array();
	this.nowPage=0;
	this.maxPage=0;
	this.oldidx=0;
	this.idx=0;
	this.onfocus=false;
	this.focusflg=new Array();
	this.sort_key=new Array("sort_title_asc","sort_keyword_name_asc","sort_new_arrival_start_desc","sort_availability_end_asc");
	this.sort_keyflg=new Array(false,false,false,false);
	this.state=gScreenState;
}
function LA_init(unit,getData,func){
	this.unit=unit;
	if(getData==null) getData=new UpGetData("","","");
	this.crid=getData.id;
	this.sort=getData.sort;
	this.displayType=getData.displayType;
	this.func=func;

	this.totalCount=0;
	this.list=new Array();
	this.nowPage=0;
	this.maxPage=0;
	this.idx=0;
	this.focusflg=new Array();
}
function LA_isfocus(){
	if(this.list==null || this.list.length<=0) return false;
	return true;
}
function LA_focus(code){
	if(code==2)this.addIdx(0,true,true);
	else if(code==1)this.addIdx(this.list.length-1,false,true);
	if(!this.setIdx(this.idx))this.addIdx(0,true,true);

	playSound(9);
	this.onfocus=true;
	hideElem("csrt0"); // タイトル時の矢印を消す
	hideElem("csrt1");
	this.movefocus();
	showElem("bt_alist");
	setFcs("bt_alist");
}

function LA_movefocus(){
	if(!this.isfocus()){
		hideElem("bt_alist");
		this.hideDetail();
		lista_blur();
		return;
	}
	var top=86+(this.idx*30);
	var i;
	getElementById("bt_alist").normalStyle.top = top+"px";
	if(this.onfocus){
		if(this.maxPage>1){
			showElem("csr_left01");
			showElem("csr_right01");
		}else{
			hideElem("csr_left01");
			hideElem("csr_right01");
		}
		setImg("bt_alist","images/bt_alist-f.png");
	}else{
		var displayType=gState.downbox.list[gState.downbox.idx].displayType;
		if((displayType=="video_program")||(displayType=="video_series")||(displayType=="video_package")
			||(displayType=="wizard")||(displayType=="related_programs")||(displayType=="subscription_package")||(displayType=="series_svod")||(displayType=="channel_svod")){
			if(interimCheck(this.list[this.idx].period.newArrivalStart,this.list[this.idx].period.newArrivalEnd))setImg("bt_alist","images/bt_alist-n2.png");
			else setImg("bt_alist","images/bt_alist-n.png");
		}else setImg("bt_alist","images/bt_alist-n.png");
		hideElem("csr_left01");
		hideElem("csr_right01");
	}
	for(i=0;i<this.unit;i++){
		if(i<this.list.length){
			if(!this.focusflg[i]){
				if(this.idx==i){
					if(this.onfocus)setTxtCol("list"+i+"t","0","189 191");
					else setTxtCol("list"+i+"t","138","154 162");
				}else{setTxtCol("list"+i+"t","163","160 154");}
			}else{
				if(this.idx==i){
					if(this.onfocus) setTxtCol("list"+i+"t","0","189 191");
					else setTxtCol("list"+i+"t","138","154 162");
				}else{
					if(this.onfocus) setTxtCol("list"+i+"t","174","171 166");
					else setTxtCol("list"+i+"t","174","171 166");
				}
			}
		}
	}
	showElem("bt_alist");
	if(!isNaN(gSpeedUpTimerId)){
		browser.clearTimer(gSpeedUpTimerId);
		gSpeedUpTimerId=NaN;
	}
	if(!this.focusflg[this.idx]){
		setText("ld_text0","");
		hideElem("bg_icon");
		this.hideDetail();
		gSideKey=true;
		return;
	}
	setText("ld_text0",this.get().basicDescription.synopsis);
	showElem("bg_icon");
	gSideKey=false;// 縦方向の動きを制限
	if(this.oldidx!=this.idx) this.hideDetail();
	gSpeedUpTimerId = browser.setInterval("lashowDetail();",700,1);
}
function lashowDetail(){
	if(isNaN(gSpeedUpTimerId))return;
	else{
		browser.clearTimer(gSpeedUpTimerId);
		gSpeedUpTimerId=NaN;
	}
	if(gState.downbox==null) return;
	if(gState.downbox.objtype=="lista"){
		if(!gFOff)lockScreen();
		gState.downbox.showDetail();
		if(!gFOff)unlockScreen();
	}
	gSideKey=true;
}
function LA_addIdx(idx,puls,flg){
	var i;
	if(puls){
		if(flg){
			for(i=idx;i<this.focusflg.length;i++)return this.setIdx(i);
		}else{
			for(i=idx;i<this.focusflg.length;i++){if(this.focusflg[i])return this.setIdx(i);}
		}
	}else{
		if(flg){
			for(i=idx;i>=0;i--)return this.setIdx(i);
		}else{
			for(i=idx;i>=0;i--){if(this.focusflg[i])return this.setIdx(i);}
		}
	}
	return false;
}
function LA_setIdx(num){
	if(num>=this.list.length ) return false;
	if(num<0) return false;
	this.oldidx=this.idx;
	this.idx=num;
	return true;
}
function LA_getListFunc(ispid, mode, age){
	var retList = null;
	if(this.crid==""&&this.sort==""&&this.displayType=="") return new PageInformation(0,new Array());
	if(this.crid!=null){
		if(this.sort!=null){
			if(this.displayType!=null){
				retList=this.func(this.crid,this.displayType,this.sort,this.nowPage,ispid, mode, age);
			}else{
				retList=this.func(this.crid,this.sort,this.nowPage,ispid, mode, age);
			}
		}else{
			retList=this.func(this.crid,this.nowPage,ispid, mode, age);
		}
	}else{
		retList=this.func(this.nowPage,ispid, mode, age);
	}
	return retList;
}
function LA_getList(ispid, mode, age){
	if(this.func==null) return null;
	var retList = this.getListFunc(ispid, mode, age);
	if(retList!=null) return retList;
	var err=getErrStat();
	if(err==null) {
		retList = this.getListFunc(ispid, mode, age);
		if(retList!=null) return retList;
		err=getErrStat();
	}
	if(err==null){
		showLoginErr();
	}else if(gTitleSide==true){
		showPopup(new Array("ホームへ"),gohome,"エラー",err[1],err[0]);
	}else{
		showPopup(new Array("閉じる"),lakeep,"エラー",err[1],err[0]);
	}
	lockScreen();
	return -1;
}
function LA_load(ispid, mode, age){
	var retList=this.getList(ispid, mode, age);
	if(retList==null){
		retList=new PageInformation(0,new Array());
	}else if(retList==-1){
		this.hidden();
		this.totalCount=0;
		this.list=new Array();
		this.nowPage=0;
		this.maxPage=0;
		this.focusflg=new Array();
		return false;
	}
	this.totalCount=retList.totalCount;
	this.list=retList.contentList;

	this.focusflg=new Array();
	for(var i=0;i<this.list.length;i++){
		this.focusflg[i]=interimCheck(this.list[i].period.displayStart,this.list[i].period.displayEnd);
	}

	var max=this.maxPage;
	this.maxPage = (this.totalCount%this.unit)?(this.totalCount/this.unit)+1:(this.totalCount/this.unit);
	if(this.idx>=this.list.length)this.addIdx(this.list.length-1,false,false);
	if(!this.focusflg[this.idx]){
		if(!this.addIdx(this.idx,false,false)){
			if(!this.addIdx(this.idx,true,false)){this.idx=0;}
		}
	}

	if((max!=0)&&(max!=this.maxPage)&&this.nowPage!=0){
		this.nowPage=0;this.idx=0;
		return this.load(ispid,mode,age);
	}
	return true;
}

function LA_setListIcon(info,i) {
	if(info == null || info.displayType == "wizard"){
		hideElem("list_icon"+i);
		return;
	}
	if(info.displayType=="tv_channel") {
		if(info.broadCastEvent&&!hasTvViewLicense(info.broadCastEvent.licenseId,info.broadCastEvent.tierbit)){
			if(!dateCheck(info.period.availabilityStart)){
				setImg("list_icon"+i,"images/icon_34.png");
				showElem("list_icon"+i);
				return;
			}else{
				setImg("list_icon"+i,"images/icon_13.png");
				showElem("list_icon"+i);
				return;
			}
		}
		hideElem("list_icon"+i);
		return;
	}

	if(info.icon.purchase==1&&!dateCheck(info.period.availabilityStart)){
		setImg("list_icon"+i,"images/icon_34.png");
		showElem("list_icon"+i);
		return;
	}else if(info.icon.free==1){
		setImg("list_icon"+i,"images/icon_26.png");
		showElem("list_icon"+i);
		return;
	}else if(info.icon.purchase==1){
		setImg("list_icon"+i,"images/icon_13.png");
		showElem("list_icon"+i);
		return;
	}else if(info.icon.series==1){
		setImg("list_icon"+i,"images/icon_14.png");
		showElem("list_icon"+i);
		return;
	}
	hideElem("list_icon"+i);
	return;
}

function LA_show(ispid, mode, age){
	var i=0;
	setImg("base","images/bg_ptn01.png");
	showElem("base");
	if(!gFOff){
		unlockScreen();
		keyOff();
		lockScreen();
	}
	if(this.displayType=="video_package"||this.displayType=="channel_package"||this.displayType=="subscription_package"||this.displayType=="channel_svod"||this.displayType=="series_svod"){
		if(gState.upbox!=null){
			var ret=getShowBtnData(gState.upbox.info);
			setText("subtitle",ret.priod_text);
			setText("d_period_r",ret.priod_text_r);
		}
	}else if(this.displayType=="karaoke_package"){
		if(gState.upbox!=null){
			var ret=getShowKaraokeBtnData(gState.upbox.info);
			setText("subtitle",ret.priod_text);
			setText("d_period_r",ret.priod_text_r);
		}
	}
	if(!this.load(ispid, mode, age)) return false;
	if(this.list.length==0){this.hidden(); return true;}
	if(getElementById("body").normalStyle.usedKeyList!="basic data-button numeric-tuning")getElementById("body").normalStyle.usedKeyList="basic data-button numeric-tuning";
	for(i=0;i<this.unit;i++){
		if(i<this.list.length){
			setText("list"+i+"t",this.list[i].basicDescription.title);
			if(!this.focusflg[i]){
				setImg("list"+i,"images/bt_alist0"+(i+1)+"-g.png");
				setTxtCol("list"+i+"t","163","160 154");
				hideElem("list_icon"+i);
			}else{
				var displayType=this.list[i].displayType;
				if((displayType=="video_program")||(displayType=="video_series")||(displayType=="video_package")
					||(displayType=="wizard")||(displayType=="related_programs")||(displayType=="subscription_package")||(displayType=="series_svod")||(displayType=="channel_svod")){
					if(interimCheck(this.list[i].period.newArrivalStart,this.list[i].period.newArrivalEnd))setImg("list"+i,"images/bt_alist0"+(i+1)+"-n.png");
					else setImg("list"+i,"images/bt_alist0"+(i+1)+".png");
				}else setImg("list"+i,"images/bt_alist0"+(i+1)+".png");
//				setImg("list"+i,"images/bt_alist0"+(i+1)+".png");
				if(this.idx==i){
					if(this.onfocus) setTxtCol("list"+i+"t","0","189 191");
					else setTxtCol("list"+i+"t","138","154 162");
				}else{
					if(this.onfocus) setTxtCol("list"+i+"t","174","171 166");
					else setTxtCol("list"+i+"t","174","171 166");
				}
				this.setListIcon(this.list[i],i);
			}
			showElem("list"+i);
		}else{
			setText("list"+i+"t","");
			hideElem("list"+i);
			hideElem("list_icon"+i);
		}
	}
	showElem("value01");
	setText("value01t",this.totalCount);
	var page=(this.nowPage+1)+"/"+(this.maxPage);
	if(this.maxPage==0)page="0/1";
	showElem("value02");
	setText("value02t",page);
	if(this.maxPage>1){
		if(this.nowPage==0)hideElem("page_prv01");
		else showElem("page_prv01");
		if(this.nowPage==this.maxPage-1)hideElem("page_nxt01");
		else showElem("page_nxt01");
	}else{
		hideElem("page_prv01");
		hideElem("page_nxt01");
	}
	var sortleft=new Array("58px","188px","318px","448px");
	for(i=0;i<this.sort_key.length;i++){
		if(this.sort_keyflg[i]){
			showElem("guide_sort0"+String(i+1));
			if(this.sort==this.sort_key[i]) {
				getElementById("guide_sort_f").normalStyle.left=sortleft[i];
				showElem("guide_sort_f");
			}
		}
	}
	this.movefocus();
	showElem("list");
	return true;
}
function LA_showDetail(){
	var obj = this.get();
	if(obj==null) return;
	var icon = obj.icon;
	if(icon==null) return;
	// プラン
	if(obj.displayType!="tv_channel"){
		if(obj.displayType!="channel_package"){
			if(icon.basic==1){
				setImg("ld_icon0","images/icon_02.png");
				showElem("ld_icon0");
			}else if(icon.basic==2){
				setImg("ld_icon0","images/icon_32.png");
				showElem("ld_icon0");
			}else{ hideElem("ld_icon0");}
			if(icon.option!=""){
				setImg("ld_icon1",icon.option);
				showElem("ld_icon1");
			}else{ hideElem("ld_icon1");}
		}
		// 音声
		if(icon.multi==1){
			setImg("ld_icon2","images/icon_08.png");
			showElem("ld_icon2");
		}else if(icon.multi==2){
			setImg("ld_icon2","images/icon_33.png");
			showElem("ld_icon2");
		}else hideElem("ld_icon2");
		// 字幕
		if(icon.caption==1) showElem("ld_icon3");
		else hideElem("ld_icon3");
	}
	// コピー制御
	if(icon.copy==1){
		setImg("ld_icon4","images/icon_05.png");
		showElem("ld_icon4");
	}else if(icon.copy==2){
		setImg("ld_icon4","images/icon_06.png");
		showElem("ld_icon4");
	}else if(icon.copy==3){
		setImg("ld_icon4","images/icon_07.png");
		showElem("ld_icon4");
	}else{ hideElem("ld_icon4"); }
	// ハイビジョン
	if(icon.hd==1) showElem("ld_icon5");
	else hideElem("ld_icon5");
	// 視聴制限
	var age = Number(obj.basicDescription.parentalRate);
	if(obj.displayType=="tv_channel"){
		if(obj.basicDescription.isAdult==1){
			setImg("ld_icon6","images/icon_24.png");
			showElem("ld_icon6");
		}
	}else if(12<=age && age<20 ){
		setImg("ld_icon6","images/icon_"+(age+4)+".png");
		showElem("ld_icon6");
	}else if(20<=age){
		setImg("ld_icon6","images/icon_24.png");
		showElem("ld_icon6");
	}else{ hideElem("ld_icon6");}
	// 配信ステータス
	if(icon.delivery==2){
//		var now = obj.period.availabilityStart;
		setImg("ld_icon7","images/icon_10.png");
//		if(now!=null) setText("ld_text1",padding("  ",now[1])+"/"+padding("  ",now[2]));
		showElem("ld_icon7");
	}else if(icon.delivery==1){
		setText("ld_text1","");
		hideElem("ld_icon7");
		var start=obj.period.availabilityStart;
		var end=obj.period.availabilityEnd;
		if(start==null&&end==null){
			setImg("ld_icon7","images/icon_12.png");
			showElem("ld_icon7");
		}else if(start!=null&&!(dateCheck(start))){
			setImg("ld_icon7","images/icon_10.png");
			setText("ld_text1",padding("  ",start[1])+"/"+padding("  ",start[2])+"〜");
			showElem("ld_icon7");
		}else if(end!=null){
			if(dateCheck(end)){
				setImg("ld_icon7","images/icon_12.png");
				showElem("ld_icon7");
			}else{
				var day=subDate(end,new Date(),4);
				if(!isNaN(day)&&day<30){
					setText("ld_text1","〜"+padding("  ",end[1])+"/"+padding("  ",end[2]));
					setImg("ld_icon7","images/icon_11.png");
					showElem("ld_icon7");
				}
			}
		}
	}else if(icon.delivery==3||icon.delivery==4){
		setImg("ld_icon7","images/icon_12.png");
		setText("ld_text1","");
		showElem("ld_icon7");
	}else{
		setText("ld_text1","");
		hideElem("ld_icon7");
	}
	if(obj.basicDescription.thumbMiddle!="") setImg("list_jpg",obj.basicDescription.thumbMiddle);
	else setImg("list_jpg","images/noimage_02.jpg");
	showElem("list_jpg");
	setText("ld_text2",obj.basicDescription.copyrightImage);
}
function LA_hideDetail(){
	var i;
	setText("ld_text1","");
	setText("ld_text2","");
	for(i=0;i<8;i++){
		hideElem("ld_icon"+i);
	}
	setImg("list_jpg","images/noimage_02.jpg");
	hideElem("list_jpg");
}
function LA_hidden(){
	var i;
	this.hideDetail();
	setText("subtitle","");
	setText("d_period_r","");
	setText("ld_text0","");
	hideElem("bg_icon");
	for(i=0;i<this.unit;i++){
		setText("list"+i+"t","");
		hideElem("list"+i);
		hideElem("list_icon"+i);
		setTxtCol("list"+i+"t","163","160 154");
	}
	hideElem("value01");
	hideElem("value02");
	setText("value01t","");
	setText("value02t","");
	hideElem("page_prv01");
	hideElem("page_nxt01");
	hideElem("csr_left01");
	hideElem("csr_right01");
	hideElem("bt_alist");
	hideElem("list_jpg");
	hideElem("list");
	hideElem("guide_sort01");
	hideElem("guide_sort02");
	hideElem("guide_sort03");
	hideElem("guide_sort04");
	hideElem("guide_sort_f");
	getElementById("body").normalStyle.usedKeyList ="basic data-button";
}
function LA_get(){
	if(this.list==null||this.list.length==0) return null;
	return this.list[this.idx];
}
function LA_numClick(code){
	var num = (code-5)-1;
	if(!this.setIdx(num)) return;
	this.movefocus();
	gPlaySound=false;
	this.focus(-1);
	playSound(7);
	unlockScreen();
	browser.sleep(300);
	lockScreen();
	var obj=gState.downbox.get();
	if(obj!=null && !interimCheck(obj.period.displayStart,obj.period.displayEnd)){
		lista_blur();
		showPopup(new Array("閉じる"),lakeep,"エラー","\r\n提供期間外のためご利用いただけません。\r\n\r\n状態番号：19034","");
		unlockScreen();
		return;
	}
	gPlaySound=false;
	showByContentInformation(obj.crid,obj.displayType,true);
}
function LA_colorClick(code){
	var idx=code-21;
	if(this.list.length==0) return;
	if(0<=idx&&idx<4){
		if(this.sort_keyflg[idx]){
			playSound(7);
			this.sort=this.sort_key[idx];
			var getup = new UpGetData(this.crid,this.sort,this.displayType);
			this.init(this.unit,getup,this.func);
			if(this.show(gState.ispid,gState.mode,gState.age)){
				gPlaySound=false;
				defaultFocus2();
			}
			return;
		}
	}
}
function LA_chgPage(num,ispid,mode,age){
	if(this.maxPage<=1) return;
	playSound(9);
	this.nowPage+=num;
	if(this.nowPage<0) this.nowPage=this.maxPage-1;
	if(this.maxPage<=this.nowPage) this.nowPage=0;

	showElem("loading2");
	var page=(this.nowPage+1)+"/"+(this.maxPage);
	if(this.maxPage==0)page="0/1";
	showElem("value02");
	setText("value02t",page);

	if(!isNaN(gSpeedUpTimerId)){
		browser.clearTimer(gSpeedUpTimerId);
		gSpeedUpTimerId=NaN;
	}
	gUpDownKey=false;
	gSpeedUpTimerId = browser.setInterval("lachgPage();",1000,1);
}
function lachgPage(){
	if(isNaN(gSpeedUpTimerId))return;
	else{
		browser.clearTimer(gSpeedUpTimerId);
		gSpeedUpTimerId=NaN;
	}
	if(gState.downbox==null) return;
	if(gState.downbox.objtype!="lista") return;
	lockScreen();
	if(gState.downbox.show(gState.ispid,gState.mode,gState.age)){
		gState.downbox.hideDetail();
		if(!gState.downbox.isfocus()){
			gPlaySound=false;
			if(gState.upbox.isfocus()) gState.upbox.focus(-1);
			else scFocus();
		}
	}
	hideElem("loading2");
	gUpDownKey=true;// 縦方向の動きを解放
	unlockScreen();
}

function lista_blur(){
	var i;
	if(gState.downbox==null) return;
	if(gState.downbox.list==null) return;
	if(gState.downbox.list.length==0) return;
	gState.downbox.onfocus=false;
	var displayType=gState.downbox.list[gState.downbox.idx].displayType;
	if((displayType=="video_program")||(displayType=="video_series")||(displayType=="video_package")
		||(displayType=="wizard")||(displayType=="related_programs")||(displayType=="subscription_package")||(displayType=="series_svod")||(displayType=="channel_svod")){
		if(interimCheck(gState.downbox.list[gState.downbox.idx].period.newArrivalStart,gState.downbox.list[gState.downbox.idx].period.newArrivalEnd))setImg("bt_alist","images/bt_alist-n2.png");
		else setImg("bt_alist","images/bt_alist-n.png");
	}else setImg("bt_alist","images/bt_alist-n.png");
	for(i=0;i<gState.downbox.unit;i++){
		if(i<gState.downbox.list.length){
			if(!gState.downbox.focusflg[i]){
				if(gState.downbox.idx==i){
					if(gState.downbox.onfocus)setTxtCol("list"+i+"t","0","189 191");
					else setTxtCol("list"+i+"t","138","154 162");
				}else{setTxtCol("list"+i+"t","163","160 154");}
			}else{
				if(gState.downbox.idx==i){
					if(gState.downbox.onfocus) setTxtCol("list"+i+"t","0","189 191");
					else setTxtCol("list"+i+"t","138","154 162");
				}else{
					if(gState.downbox.onfocus) setTxtCol("list"+i+"t","174","171 166");
					else setTxtCol("list"+i+"t","174","171 166");
				}
			}
		}
	}
	hideElem("csr_left01");
	hideElem("csr_right01");
}
function listkey(){
	var code = document.currentEvent.keyCode;
	var id = document.currentEvent.target.id;
	lockScreen();
	if(code==1){
		if(!gUpDownKey) {unlockScreen();return;}
		if(gState.downbox.addIdx(gState.downbox.idx-1,false,true)){
			playSound(9);
			gState.downbox.movefocus();
		}else{
			if(gState.upbox.isfocus()){
				lista_blur();
				gState.upbox.focus(code);
			}else{
				lista_blur();
				scFocus();
			}
		}
	}else if(code==2){
		if(!gUpDownKey) {unlockScreen();return;}
		if(gState.downbox.addIdx(gState.downbox.idx+1,true,true)){
			playSound(9);
			gState.downbox.movefocus();
		}else{
			lista_blur();
			scFocus();
		}
	}else if(code==3){
		if(!gSideKey) {unlockScreen();return;}
		if(gState.downbox!=null) gState.downbox.chgPage(-1,gState.ispid,gState.mode,gState.age);
	}else if(code==4){
		if(!gSideKey) {unlockScreen();return;}
		if(gState.downbox!=null) gState.downbox.chgPage(1,gState.ispid,gState.mode,gState.age);
	}else if( (code >= 5) && (code <= 14) ){
		if(!gSideKey||!gUpDownKey) {unlockScreen();return;}
		if(gState.downbox!=null&&(code-5)<=gState.downbox.list.length&&code>5){
			lista_blur();
			gState.downbox.numClick(code);
		}
	}else if(code==18){
		if(!gSideKey||!gUpDownKey) {unlockScreen();return;}
		playSound(7);
		var obj=gState.downbox.get();
		if(obj!=null && !interimCheck(obj.period.displayStart,obj.period.displayEnd)){
			lista_blur();
			showPopup(new Array("閉じる"),lakeep,"エラー","\r\n提供期間外のためご利用いただけません。\r\n\r\n状態番号：19034","");
			unlockScreen();
			return;
		}
		gPlaySound=false;
		showByContentInformation(obj.crid,obj.displayType,true);
	}else if(21<=code && code<=24){
		if(!gSideKey||!gUpDownKey) {unlockScreen();return;}
		if(gState.downbox!=null){
			if(gState.downbox.list==null||gState.downbox.list.length==0) {unlockScreen();return;}
			gState.downbox.colorClick(code);
		}
	}else if(code==19){
		if(!gSideKey||!gUpDownKey) {unlockScreen();return;}
		lista_blur();
		returnFunc();
	}
	unlockScreen();
}
function subDateArr(arr1,arr2){
	if(arr1==null) return NaN;
	if(arr1.length!=6)return NaN;
	if(arr2==null) return NaN;
	if(arr2.length!=6)return NaN;
	if(arr1[0] < arr2[0] ) return 1;
	else if(arr1[0] > arr2[0] ) return -1;
	if(arr1[1] < arr2[1] ) return 1;
	else if(arr1[1] > arr2[1] ) return -1;
	if(arr1[2] < arr2[2] ) return 1;
	else if(arr1[2] > arr2[2] ) return -1;
	if(arr1[3] < arr2[3] ) return 1;
	else if(arr1[3] > arr2[3] ) return -1;
	if(arr1[4] < arr2[4] ) return 1;
	else if(arr1[4] > arr2[4] ) return -1;
	if(arr1[5] < arr2[5] ) return 1;
	else if(arr1[5] > arr2[5] ) return -1;
	return 0;
}
function sortFromDateIdxArr(arr){
	var i;
	var retarr=new Array();
	var sortarr=new Array();
	var tmparr;
	var tgt;
	for(i=0;i<arr.length;i++){
		sortarr[i]=padding("0000",arr[i][1][0])+","+padding("00",arr[i][1][1])+","+padding("00",arr[i][1][2])+","+
			padding("00",arr[i][1][3])+","+padding("00",arr[i][1][4])+","+padding("00",arr[i][1][5])+","+arr[i][0];
	}
	sortarr.sort();
	for(i=0;i<arr.length;i++){
		tmparr=sortarr[i].split(",");
		retarr[i]=new Array();
		retarr[i][0]=parseInt(tmparr[6],10);
		retarr[i][1]=new Array();
		retarr[i][1][0]=parseInt(tmparr[0],10);
		retarr[i][1][1]=parseInt(tmparr[1],10);
		retarr[i][1][2]=parseInt(tmparr[2],10);
		retarr[i][1][3]=parseInt(tmparr[3],10);
		retarr[i][1][4]=parseInt(tmparr[4],10);
		retarr[i][1][5]=parseInt(tmparr[5],10);
	}
	return retarr;
}
/* 購入ポップアップ構造 */
var gBuyPopData=null;
function BuyPopData(){
	this.plan=new Array(); // １〜２個の購入ライセンスが入る
	this.term==new Array(); // 期間表示用文字列(this.planに対応)
	this.idx=0;
	this.state=0; // 購入ステート
	this.displayType="";
	this.cid="";
	this.pin=null;
	this.resultConfirm=null;
	this.resultBuyLicense=null;
	this.init=BP_init;
	this.show=BP_show;
	this.hidden=BP_hidden;
	this.click=BP_click;
	this.pushBuyBtn=BP_pushBuyBtn;
	this.buyContent=BP_buyContent;
	this.keydown=BP_keydown;
	this.numClick=BP_numClick;
	this.close=BP_close;
	this.clickPlay=BP_clickPlay;
	this.updataTerms=BP_updataTerms;
	this.programUrl="";
	this.mcLicenses="";
	this.page=0;
	this.maxpage=0;
	this.url="";
}
function BP_init(license,term,displayType,cid){
//	gPlaySound=false;
	this.plan=license;
	this.term=term;
	this.displayType=displayType;
	this.cid=cid;
	this.idx=0;
	this.state=-1;
	this.resultBuyLicense=null;
	this.resultConfirm=null;
	this.programUrl="";
	this.mcLicenses="";
	this.page=0;
	this.maxpage=0;
	this.url="";
}
function BP_hidden(){
	hideElem("terms");
	hideElem("bt_pulist0");
	hideElem("bt_pulist1");
	hideElem("bt_0");
	hideElem("bt_1");
	hideElem("bt_2");
	hideElem("bt_linecode");
	setText("buybox_title","");
	setText("buybox_msg0","");
	setText("buybox_msg1","");
	setText("bt_pulist0pt","");
	setText("bt_pulist1pt","");
	setText("bt_pulist0kt","");
	setText("bt_pulist1kt","");
	setText("bt_0t","");
	setText("bt_1t","");
	setText("bt_2t","");
	setText("bt_linecodet","");
	setText("termst","");
	setText("termsp","");
	setText("termspt","");
	getElementById("body").normalStyle.usedKeyList="basic data-button special-1";
	hideElem("buybox");
	getElementById("bt_1").normalStyle.top="239px";
	getElementById("bt_2").normalStyle.top="239px";
	getElementById("bt_1t").normalStyle.top="247px";
	getElementById("bt_2t").normalStyle.top="247px";
}
function BP_show(){
	if(this.plan==null||this.term==null) return false;
	this.hidden();
	getElementById("body").normalStyle.usedKeyList="basic data-button special-1 numeric-tuning";

	if(this.state==-1){
		if((this.displayType=="video_program"||this.displayType=="video_package"||this.displayType=="series_svod"||this.displayType=="subscription_package")&&
			gState.upbox!=null&&gState.upbox.info!=null&&gState.upbox.info.extraObject!=null&&gState.upbox.info.extraObject[EO_KEY_REGULATION_URL]!=""&&gState.upbox.info.extraObject[EO_KEY_REGULATION_URL]!="undefine"){
			this.url=gState.upbox.info.extraObject[EO_KEY_REGULATION_URL];
			this.state=3;
			gPlaySound=false;
			return this.show();// 規約ポップアップ表示
		}else{
			this.state=0;
			return this.show();
		}
	}else if(this.state==0){
		if(this.plan.length==1){	// 表示処理を走らせない
			return this.pushBuyBtn(this.plan[this.idx].purchaseId,this.cid,this.displayType);
		}else{
			setText("buybox_title","選択リスト");
			setText("buybox_msg0","\r\n下記リストからお選びください。");
			for(var i=0;i<2;i++){
				var ledate=this.term[i][1];
				if(ledate){
					var day = subDate(ledate,new Date(),4);
					var period_str="　　　　　　　　　　　　　　　";
					if(!isNaN(day)){
						if(0<=day&&day<7){
							if((ledate[3]==23&&ledate[4]==59&&ledate[5]==59)){
								period_str="● "+String(ledate[1])+"/"+String(ledate[2])+"まで購入可能";
							}else{
								period_str="● "+String(ledate[1])+"/"+String(ledate[2])+" "+padding("00",ledate[3])+":"+padding("00",ledate[4])+"まで購入可能";
							}
						}else if(7<=day&&day<30){
							if((ledate[3]==23&&ledate[4]==59&&ledate[5]==59)){
								period_str="● "+String(ledate[1])+"/"+String(ledate[2])+"まで購入可能";
							}else{
								period_str="● "+String(ledate[1])+"/"+String(ledate[2])+" "+padding("00",ledate[3])+":"+padding("00",ledate[4])+"まで購入可能";
							}
						}
					}
				}
				// 期間表示処理
				setText("bt_pulist"+i+"pt","■ "+this.plan[i].price+"円(税込)／"+this.plan[i].quantityRange+this.plan[i].quantityUnit);
				setText("bt_pulist"+i+"kt",period_str);
				showElem("bt_pulist"+i);
			}
			showElem("bt_0");
			setText("bt_0t","戻る");
			buypopfocus("bt_pulist0");
		}
	}else if(this.state==1){
		var title="購入のご確認";
		var comment="■ "+this.plan[this.idx].price+"円(税込)／"+this.plan[this.idx].quantityRange+this.plan[this.idx].quantityUnit+"\r\n購入暗証番号を入力してください。\r\n上記金額が課金されます。";
		var btn1="購入する";
		var btn2="購入をやめる";

		if(this.resultConfirm.vzoneFlag==1){
			title="無料視聴のご確認";
			comment="本数限定で無料視聴できます\r\n"+this.plan[this.idx].quantityRange+this.plan[this.idx].quantityUnit+"　視聴可能\r\n※その後は再度購入が必要です\r\n購入暗証番号を入力してください。";
			btn1="無料視聴する";
			btn2="無料視聴しない";
		}

		setText("buybox_title",title);
		setText("buybox_msg0",comment);
		showElem("bt_linecode");
		setText("bt_linecodet","−−−−");
		showElem("bt_1");
		setText("bt_1t",btn1);
		showElem("bt_2");
		setText("bt_2t",btn2);
		buypopfocus("bt_linecode");
	}else if(this.state==2){
		var title="購入のご確認";
		var comment="\r\n\r\n■ "+this.plan[this.idx].price+"円(税込)／"+this.plan[this.idx].quantityRange+this.plan[this.idx].quantityUnit+"\r\n\r\n購入しますか？";
		var btn1="購入する";
		var btn2="購入をやめる";

		if(this.resultConfirm.vzoneFlag==1){
			title="無料視聴のご確認";
			comment="\r\n\r\n本数限定で無料視聴できます\r\n"+this.plan[this.idx].quantityRange+this.plan[this.idx].quantityUnit+"　視聴可能\r\n※その後は再度購入が必要です";
			btn1="無料視聴する";
			btn2="無料視聴しない";
		}

		setText("buybox_title",title);
		setText("buybox_msg1",comment);
		showElem("bt_1");
		setText("bt_1t",btn1);
		showElem("bt_2");
		setText("bt_2t",btn2);
		buypopfocus("bt_2");
	}else if(this.state==3){
		var title="利用規約";
		var btn1="同意する";
		var btn2="同意しない";

		if(!this.updataTerms()) return;
		showElem("terms");
		setText("buybox_title",title);
		showElem("bt_1");
		setText("bt_1t",btn1);
		showElem("bt_2");
		setText("bt_2t",btn2);
		getElementById("bt_1").normalStyle.top="249px";
		getElementById("bt_2").normalStyle.top="249px";
		getElementById("bt_1t").normalStyle.top="257px";
		getElementById("bt_2t").normalStyle.top="257px";
		buypopfocus("bt_1");
	}else{return false;}
	showElem("buybox");
	return true;
}
function BP_updataTerms(){
	var terms=getTerms(this.url,this.page);
	if(terms==null) return false;
	var comment=terms.regulation;
	this.maxpage=terms.totalCount;
	setText("termst",comment);
	setText("termsp",padding("  ",Number(this.page+1))+"/"+this.maxpage);
	if(this.maxpage>1)setText("termspt","リモコンの上下キーで規約本文のページが切り替わります。");
	return true;
}
function getTerms(url,page){
	var terms = getRegulationInformation(url,page);
	if(terms!=null){
		if(terms.totalCount==0) {
			terms.totalCount=1;
			terms.regulation="";
		}
		return terms;
	}
	var ret = getErrStat();
	if(ret==null){
		terms = getRegulationInformation(url,page);
		if(terms!=null){
			if(terms.totalCount==0) {
				terms.totalCount=1;
				terms.regulation="";
			}
			return terms;
		}
	}
	if(ret==null){
		showLoginErr();
	}else{
		showPopup(new Array("閉じる"),goDetail,"エラー",ret[1],ret[0]);
	}
	return null;
}
function BP_close(){
	gPlaySound=false;
	this.hidden();this.state=-1;this.pin=null;
	this.resultConfirm=null;
	this.resultBuyLicense=null;
	this.page=0;
}
function BP_clickPlay(){
	var state="";
	if(this.displayType=="tv_channel")state="tPlay";
	else if(this.displayType=="video_program")state="vPlay";
	else if(this.displayType=="channel_package"||this.displayType=="video_package"||this.displayType=="subscription_package"||this.displayType=="channel_svod"||this.displayType=="series_svod")state="pList";
	else if(this.displayType=="karaoke_package") state="karaoke";
	// mcLicenses更新
	if(this.mcLicenses!=null&&(this.displayType=="tv_channel"||this.displayType=="channel_package"||this.displayType=="channel_svod")) {
		if(this.displayType=="tv_channel"){showElem("loading2");unlockScreen();lockScreen();}
		if(browser.getIPTVLicense("marlin_iptv_es",IP_SERVICE_PROVIDER_ID,this.mcLicenses)!=1){
//			return;
		}
	}
	if(state=="vPlay"){
		if(this.programUrl!=""){
			if(gState.downbox.info.contentDetail.stopposition!=""&&String(gState.downbox.info.contentDetail.stopposition)!="0.0"){
				// レジューム再生有り
				detail_blur(0);
				gResumeUrl=this.programUrl;
				showPopup(new Array("続きから視聴","最初から視聴"),goResume,"ご確認","\r\n\r\nこの作品を再生します。\r\n前回の視聴終了地点："+getStopString(gState.downbox.info.contentDetail.stopposition),"");
				this.close();
				return;
			}else{
				// レジューム再生無し(従来通り)
				unlockScreen();
				lockScreen();
				setReturnDataOnQuery();
				gState.return_timing="return";
				gState.return_bmltype=0;
				browser.launchIPTVContent(this.programUrl,gState.getUrl(BASE_URI+gState.curBml),0);
				gState.return_timing="none";
			}
		}
		goDetail(0);
	}else if(state=="pList"){
		if(gState.downbox){
			var info=gState.downbox.info;
			this.close();
			if(info.displayType=="video_package") showPackList(info,true,searchVODMemberOf);
			else showPackList(info,true,searchCHSVODMemberOf);
		}
	}else if(state=="tPlay"&&gState.downbox!=null&&gState.downbox.info!=null){
		showElem("loading2");
		unlockScreen();
		lockScreen();
		if(gState.downbox.info.broadCastEvent!=null&&gState.downbox.info.broadCastEvent.serviceId!="") epgTuneProc(gState.downbox.info.broadCastEvent.serviceId);
		hideElem("loading2");
		goDetail(0);
	}else if(state=="karaoke"){
		// カラオケトップへ遷移
		launchKaraokeTop();
	}
}
function showPackList(info,flg,func){
	showTema(gScreenState+1);
	var new_info=getConDet(info.crid,info.displayType,gState.ispid,gState.mode,gState.age);
	if(new_info==null) return -1;
	gState.downbox.init(new_info);
	showList(new_info,flg,func);
}
function playContent(id){
//	playSound(7);
	gBuyPopData.clickPlay();
}
function BP_click(id){
	if(this.state==0){
		buypopblur(id);
		playSound(7);
		if(id=="bt_0"){this.close();defaultFocus2();this.resultConfirm=null;} // 戻る
		else{
			var idx=parseInt(id.substring(9),10);
			if(isNaN(idx)||idx>=this.plan.length) return;
			this.idx=idx;
			return this.pushBuyBtn(this.plan[this.idx].purchaseId,this.cid,this.displayType);
		}
	}else if(this.state==1){
		if(id=="bt_linecode"){
			playSound(7);
			if(this.pin!=null&&this.pin.length==4){
				gPlaySound=false;
				buypopblur(id);
				buypopfocus("bt_1");
			}
		}else if(id=="bt_1"){
			playSound(7);
			if(this.pin!=null&&this.pin.length==4){
				buypopblur(id);
				if(this.buyContent(this.pin,this.displayType)){
					// 購入完了
					this.clickPlay();
				}
			}else{
				gPlaySound=false;
				buypopblur(id);
				buypopfocus("bt_linecode");
			}
		}else if(id=="bt_2"){playSound(7);buypopblur(id);this.close();defaultFocus2();this.resultConfirm=null;} // 戻る
	}else if(this.state==2){
		playSound(7);
		buypopblur(id);
		if(id=="bt_1"){
			if(this.buyContent(this.pin,this.displayType)){
				// 購入完了
				this.clickPlay();
			}
		}
		else if(id=="bt_2"){this.close();defaultFocus2();this.resultConfirm=null;} // 戻る
	}else if(this.state==3){
		playSound(7);
		buypopblur(id);
		if(id=="bt_1"){
			this.state=0;
			gPlaySound=false;
			return this.show();
		}
		else if(id=="bt_2"){this.close();defaultFocus2();this.resultConfirm=null;} // 戻る
	}
	return false;
}
function BP_numClick(code){
	var num = (code-5);
	if(this.pin==null)this.pin="";
	if(this.pin.length>=4)return false;
	this.pin+=String(num);
	playSound(9);
	var msk="＊＊＊＊";
	var txt=msk.substring(0,this.pin.length);
	setText("bt_linecodet",padding2("−−−−",txt));
	if(this.pin.length>=4)return true;
	else return false;
}
function BP_keydown(id,code){
	if(code==1){
		if(this.state==0){
			buypopblur(id);
			if(id=="bt_pulist0") buypopfocus("bt_0");
			else if(id=="bt_pulist1") buypopfocus("bt_pulist0");
			else if(id=="bt_0") buypopfocus("bt_pulist1");
		}else if(this.state==1){
			buypopblur(id);
			if(id=="bt_1") buypopfocus("bt_linecode");
			if(id=="bt_2") buypopfocus("bt_linecode");
			else if(id=="bt_linecode") buypopfocus("bt_1");
		}else if(this.state==3){
			if(this.maxpage<=1) return;
			this.page--;
			if(this.page<0) this.page=this.maxpage-1;
			playSound(7);
			this.updataTerms();
		}
	}else if(code==2){
		if(this.state==0){
			buypopblur(id);
			if(id=="bt_pulist0") buypopfocus("bt_pulist1");
			else if(id=="bt_pulist1") buypopfocus("bt_0");
			else if(id=="bt_0") buypopfocus("bt_pulist0");
		}else if(this.state==1){
			buypopblur(id);
			if(id=="bt_1") buypopfocus("bt_linecode");
			if(id=="bt_2") buypopfocus("bt_linecode");
			else if(id=="bt_linecode") buypopfocus("bt_1");
		}else if(this.state==3){
			if(this.maxpage<=1) return;
			this.page++;
			if(this.maxpage<=this.page) this.page=0;
			playSound(7);
			this.updataTerms();
		}
	}else if(code==3){
		if(this.state==1){
			if(id=="bt_linecode"){
				if(this.pin==null||this.pin=="") return;
				this.pin=this.pin.substring(0,this.pin.length-1);
				playSound(9);
				var msk="＊＊＊＊";
				var txt=msk.substring(0,this.pin.length);
				setText("bt_linecodet",padding2("−−−−",txt));
			}else if(id=="bt_2"){buypopblur(id); buypopfocus("bt_1");}
			else if(id=="bt_1"){buypopblur(id); buypopfocus("bt_2");}
		}else if(this.state==2||this.state==3){
			buypopblur(id);
			if(id=="bt_1") buypopfocus("bt_2");
			else if(id=="bt_2") buypopfocus("bt_1");
		}
	}else if(code==4){
		if(this.state==1){
			if(id=="bt_2"){buypopblur(id); buypopfocus("bt_1");}
			else if(id=="bt_1"){buypopblur(id); buypopfocus("bt_2");}
		}else if(this.state==2||this.state==3){
			buypopblur(id);
			if(id=="bt_1") buypopfocus("bt_2");
			else if(id=="bt_2") buypopfocus("bt_1");
		}
	}else if( (code >= 5) && (code <= 14) ){//数字キー
		if(this.state==1&&id=="bt_linecode"){
			if(this.numClick(code)){
				gPlaySound=false;
				buypopblur(id);
				buypopfocus("bt_1");
			}
		}
	}else if(code==18){
		this.click(id);
	}else if(code==19){
		if(this.state==1){
			if(id!="bt_linecode") return;
			if(this.pin==null||this.pin=="") return;
			this.pin=this.pin.substring(0,this.pin.length-1);
			playSound(9);
			var msk="＊＊＊＊";
			var txt=msk.substring(0,this.pin.length);
			setText("bt_linecodet",padding2("−−−−",txt));
		}
	}
}
// 購入ボタンが押された時の関数
function BP_pushBuyBtn(purchaseId,cid,displayType){
	this.resultConfirm=buyConfirmProc(purchaseId,cid,displayType);
	if(this.resultConfirm==null) return false;
	if(this.resultConfirm.nextcom=="buy_license"){
		if(this.resultConfirm.requestPin==1){
			this.state=1;
			gPlaySound=false;
			return this.show(); // PIN入力あり購入ポップアップ表示
		}else if(this.resultConfirm.requestPin==0){
			this.state=2;
			gPlaySound=false;
			return this.show(); // PIN入力なし購入ポップアップ表示
		}
	}else if(this.resultConfirm.nextcom=="buy_complete"){
		// 視聴ボタン制御
		this.programUrl=this.resultConfirm.programUrl;
		this.mcLicenses=this.resultConfirm.mcLicenses;
		showPopup(new Array("再生"),playContent,"再生開始","\r\n\r\n\r\n見放題対象となりますので無料でご覧になれます。","");
		return true;
	}
	showPopup(new Array("閉じる"),goDetail,"エラー",setErrMsg(getBmlErr("50","59")),"");
	return false;
}
// 購入処理
function BP_buyContent(pin,displayType){
	if(this.resultConfirm==null){
		// 購入情報なしエラーホップアップ表示
		return false;
	}
	this.resultBuyLicense=buyLicenseProc(this.resultConfirm,pin,displayType);
	if(this.resultBuyLicense==null) return false;
	if(this.resultBuyLicense.nextcom=="buy_complete"){
		// 購入成功
		this.programUrl=this.resultBuyLicense.programUrl;
		this.mcLicenses=this.resultBuyLicense.mcLicenses;
		return true;
	}
	showPopup(new Array("閉じる"),goDetail,"エラー",setErrMsg(getBmlErr("51","59")),"");
	return false;
}
function goDetail(id){
	if(gBuyPopData){
		gBuyPopData.close();
		gBuyPopData.resultConfirm=null;
		defaultFocus2();
	}
}
// 購入確認関数
function buyConfirmProc(purchaseId,cid,displayType){
	var drmId=getDRMID("marlin_iptv_es");
	var arr=browser.checkIPTVServiceRegistrationInfo(IP_SERVICE_PROVIDER_ID);
	if(drmId!=null&&String(drmId)!="NaN"&&arr!=null&&arr[0]!=""){
		drmId=String(drmId.indexOf("0x")==0?drmId.substring(2):drmId).toLowerCase();

		var buyInfo=buyConfirm(purchaseId,cid,displayType,drmId,arr[0]);
		if(buyInfo!=null) return buyInfo;
		var ret = getErrStat();
		if(ret==null){
			var buyInfo=buyConfirm(purchaseId,cid,displayType,drmId,arr[0]);
			if(buyInfo!=null) return buyInfo;
			ret = getErrStat();
		}
		// サーバエラーホップアップ表示
		showPopup(new Array("閉じる"),goDetail,"エラー",String(ret[1]),String(ret[0]));
		gBuyPopData.close();
		gPlaySound=true;
	}else{
		// 基本情報取得失敗ポップアップ表示
		if(drmId==null||String(drmId)=="NaN") showPopup(new Array("閉じる"),goDetail,"エラー",setErrMsg(getBmlErr("50","29")),"");
		else if(arr==null||arr[0]=="") showPopup(new Array("閉じる"),goDetail,"エラー",setErrMsg(getBmlErr("50","39")),"");
	}
	return null;
}
function buyLicenseProc(resultConfirm,pin,displayType){
	var drmId=getDRMID("marlin_iptv_es");
	var arr=browser.checkIPTVServiceRegistrationInfo(IP_SERVICE_PROVIDER_ID);
	if(drmId!=null&&String(drmId)!="NaN"&&arr!=null&&arr[0]!=""){
		drmId=String(drmId.indexOf("0x")==0?drmId.substring(2):drmId).toLowerCase();

		var buyInfo=buyLicense(resultConfirm,pin,displayType,drmId,arr[0]);
		if(buyInfo!=null) return buyInfo;
		var ret = getErrStat();
		if(ret==null){
			var buyInfo=buyLicense(resultConfirm,pin,displayType,drmId,arr[0]);
			if(buyInfo!=null) return buyInfo;
			ret = getErrStat();
		}
		// サーバエラーホップアップ表示
		var errArr=getErrors();
		var idx=errArr.length-1;
		showPopup(new Array("閉じる"),goDetail,"エラー",String(ret[1]),String(ret[0]));
		gBuyPopData.close();
		gPlaySound=true;
	}else{
		// 基本情報取得失敗ポップアップ表示
		if(drmId==null||String(drmId)=="NaN") showPopup(new Array("閉じる"),goDetail,"エラー",setErrMsg(getBmlErr("51","29")),"");
		else if(arr==null||arr[0]=="") showPopup(new Array("閉じる"),goDetail,"エラー",setErrMsg(getBmlErr("51","39")),"");
	}
	return null;
}
function buypopfocus(id){
	playSound(9);
	if(id!="bt_linecode"){
		if(id.indexOf("bt_pulist")==0){setTxtCol(id+"pt","0","189 191");setTxtCol(id+"kt","0","189 191");}
		else setTxtCol(id+"t","0","189 191");
	}
	var img=id+"-f.png";
	if(id=="bt_0"||id=="bt_1") img="bt_2-f.png";
	else if(id=="bt_pulist0"||id=="bt_pulist1") img="bt_pulist-f.png";
	setImg(id,"images/"+img);
	setFcs(id);
}
function buypopblur(id){
	if(id!="bt_linecode"){
		if(id.indexOf("bt_pulist")==0){setTxtCol(id+"pt","7","171 167");setTxtCol(id+"kt","7","171 167");}
		else setTxtCol(id+"t","7","171 167");
	}
	var img=id+".png";
	if(id=="bt_0"||id=="bt_1") img="bt_2.png";
	else if(id=="bt_pulist0"||id=="bt_pulist1") img="bt_pulist.png";
	setImg(id,"images/"+img);
}
function buykey(){
	var code=document.currentEvent.keyCode;
	var id=document.currentEvent.target.id;
	lockScreen();
	gBuyPopData.keydown(id,code);
	unlockScreen();
}
function padding2( format , str ){return str + format.substring( 0, format.length - String(str).length );}
function numUpper(num){
	var list=new Array("０","１","２","３","４","５","６","７","８","９");
	num=String(num);
	var str="";
	for(var i=0;i<num.length;i++) str+=list[Number(num.charAt(i))];
	return str;
}
function addBookmarkProc(info){
	var drmId=getDRMID("marlin_iptv_es");
	var arr=browser.checkIPTVServiceRegistrationInfo(IP_SERVICE_PROVIDER_ID);
	if(drmId!=null&&String(drmId)!="NaN"&&arr!=null&&arr[0]!=""){
		drmId=String(drmId.indexOf("0x")==0?drmId.substring(2):drmId).toLowerCase();
		var abret=addBookmark(info,drmId,arr[0]);
		if(abret!=null) return abret;
		var ret = getErrStat();
		if(ret==null){
			abret=addBookmark(info,drmId,arr[0]);
			if(abret!=null) return abret;
			ret = getErrStat();
		}
		// サーバエラーホップアップ表示
		var tp=String(ret[0]).charAt(1);
		if(tp=="5")showPopup(new Array("閉じる"),bookmarkBack,"ご確認",String(ret[1]),"");
		else showPopup(new Array("閉じる"),bookmarkBack,"エラー",String(ret[1]),String(ret[0]));
	}else{
		// 基本情報取得失敗ポップアップ表示
		if(drmId==null||String(drmId)=="NaN") showPopup(new Array("閉じる"),bookmarkBack,"エラー",setErrMsg(getBmlErr("094","19")),"");
		else if(arr==null||arr[0]=="") showPopup(new Array("閉じる"),bookmarkBack,"エラー",setErrMsg(getBmlErr("094","29")),"");
	}
	return null;	
	
}
function bookmarkBack(id){
	gPlaySound=false;
	if(gState.downbox!=null){
		if(gState.downbox.objtype=="detail") detail_focus(2);
		else if(gState.upbox.objtype=="title") gState.upbox.focus(1);
		else defaultFocus2();
	}else{
		defaultFocus();
	}
}
]]></script>
</head>
<body id="body" onload="onload();" onunload="onunload();">
<div id="basebox" style="width:960px;height:540px;">
	<object id="bg" type="image/X-arib-png" data="images/bg_hanyo.png" style="width:960px;height:540px;"/>
	<object id="logo" type="image/X-arib-png" data="images/logo.png" style="width:270px;height:62px;visibility:hidden;"/>
	<object id="temaIcon" type="image/X-arib-png" data="images/pos-pr.png" style="left:269px;top:37px;width:110px;height:25px;visibility:hidden;"/>
	<object id="temaIconSub" type="image/X-arib-png" data="images/pos-2nd.png" style="left:379px;top:37px;width:150px;height:25px;visibility:hidden;"/>
	<p id="temaIconSub_t" class="temaIconSub" style="left:403px;top:42px;width:128px;height:16px;"><![CDATA[]]></p>
</div>
<div id="clock" style="left:706px;top:41px;width:192px;height:16px;">
	<p id="clock0" class="clocktext"><![CDATA[]]></p>
	<p id="clock1" class="clocktext" style="left:16px;"><![CDATA[]]></p>
	<p id="clock2" class="clocktext" style="left:32px;"><![CDATA[]]></p>
	<p id="clock3" class="clocktext" style="left:48px;"><![CDATA[]]></p>
	<p id="clock4" class="clocktext" style="left:64px;width:32px;"><![CDATA[]]></p>
	<p id="clock5" class="clocktext" style="left:100px;width:32px;"><![CDATA[]]></p>
	<p id="clock6" class="clocktext" style="left:120px;"><![CDATA[]]></p>
	<p id="clock7" class="clocktext" style="left:136px;width:8px;"><![CDATA[]]></p>
	<p id="clock8" class="clocktext" style="left:144px;"><![CDATA[]]></p>
</div>
<div id="shortcut" style="left:627px;top:471px;width:286px;height:36px;">
	<object id="scbtn" type="image/X-arib-png" data="images/bt_s_bk.png" style="width:70px;height:36px;" onkeydown="sckey();"/>
</div>
<div id="upbox" style="top:62px;width:960px;height:406px;visibility:hidden;">
	<object id="base" type="image/X-arib-png" data="images/bg_ptn03.png" style="width:960px;height:406px;"/>
	<object id="bg_ctg01" type="image/X-arib-png" data="images/bg_ctg01.png" style="top:10px;width:959px;height:36px;"/>
	<object id="bg_ctg02" type="image/X-arib-png" data="images/bg_ctg02.png" style="top:50px;width:959px;height:28px;"/>
	<object id="bg_ctg05" type="image/X-arib-png" data="images/bg_ctg05.png" style="top:10px;width:959px;height:36px;visibility:hidden;" onkeydown="titlekey();"/>
	<object id="bg_ctg06" type="image/X-arib-png" data="images/bg_ctg06.png" style="top:50px;width:959px;height:28px;visibility:hidden;"/>

	<div style="left:100px;top:18px;width:760px;height:20px;">
		<p id="title" class="title" style="width:760px;height:20px;"><![CDATA[]]></p>
	</div>
	<p id="subtitle" class="subtitle" style="left:104px;top:58px;width:752px;height:16px;"><![CDATA[]]><span id="d_period_r" style="color-index:212;grayscale-color-index:211 213;"><![CDATA[]]></span></p>
	<div id="subtitle2_base" style="top:49px;width:960px;height:32px;background-color-index:146;visibility:hidden;" />
	<p id="subtitle2" style="font-size:16px;color-index:7;grayscale-color-index:171 163;left:168px;top:49px;width:544px;height:32px;"><![CDATA[]]></p>
	<object id="btn_book" type="image/X-arib-png" data="images/bt_plain01.png" style="left:728px;top:49px;width:128px;height:32px;visibility:hidden;" onkeydown="titlekey();"/>
	<p id="btn_bookt" class="dbtn" style="left:736px;top:57px;width:112px;height:16px;text-align:center;"><![CDATA[]]></p>
	<object id="csrt0" type="image/X-arib-png" data="images/csr_left01.png" style="left:70px;top:16px;width:25px;height:25px;visibility:hidden;"/>
	<object id="csrt1" type="image/X-arib-png" data="images/csr_right01.png" style="left:865px;top:16px;width:25px;height:25px;visibility:hidden;"/>
	<object id="bg_ctg03" type="image/X-arib-png" data="images/bg_ctg03.png" style="top:10px;width:959px;height:36px;visibility:hidden;" onkeydown="genrekey();"/>
	<object id="bg_ctg04" type="image/X-arib-png" data="images/bg_ctg04.png" style="top:50px;width:959px;height:28px;visibility:hidden;" onkeydown="genrekey();"/>
	<p id="ctgmt0" class="ctg" style="left: 20px;top:18px;width:160px;height:20px;"><![CDATA[]]></p>
	<p id="ctgmt1" class="ctg" style="left:210px;top:18px;width:160px;height:20px;"><![CDATA[]]></p>
	<div style="left:400px;top:18px;width:160px;height:20px;">
		<p id="ctgmt2" class="ctgf" style="width:160px;height:20px;"><![CDATA[]]></p>
	</div>
	<p id="ctgmt3" class="ctg" style="left:590px;top:18px;width:160px;height:20px;"><![CDATA[]]></p>
	<p id="ctgmt4" class="ctg" style="left:780px;top:18px;width:160px;height:20px;"><![CDATA[]]></p>
	<p id="ctgst0" class="ctg" style="left:22px;top:54px;width:280px;height:20px;"><![CDATA[]]></p>
	<div style="left:340px;top:54px;width:280px;height:20px;">
		<p id="ctgst1" class="ctgf" style="width:280px;height:20px;"><![CDATA[]]></p>
	</div>
	<p id="ctgst2" class="ctg" style="left:658px;top:54px;width:280px;height:20px;"><![CDATA[]]></p>
	<object id="csrm0" type="image/X-arib-png" data="images/csr_left03.png" style="top:16px;width:18px;height:25px;visibility:hidden;"/>
	<object id="csrm1" type="image/X-arib-png" data="images/csr_left01-g.png" style="left:183px;top:16px;width:25px;height:25px;visibility:hidden;"/>
	<object id="csrm2" type="image/X-arib-png" data="images/csr_left02.png" style="left:369px;top:13px;width:30px;height:30px;visibility:hidden;"/>
	<object id="csrm3" type="image/X-arib-png" data="images/csr_right02.png" style="left:561px;top:13px;width:30px;height:30px;visibility:hidden;"/>
	<object id="csrm4" type="image/X-arib-png" data="images/csr_right01-g.png" style="left:753px;top:16px;width:25px;height:25px;visibility:hidden;"/>
	<object id="csrm5" type="image/X-arib-png" data="images/csr_right03.png" style="left:942px;top:16px;width:18px;height:25px;visibility:hidden;"/>
	<object id="csrs0" type="image/X-arib-png" data="images/csr_left04.png" style="top:52px;width:18px;height:23px;visibility:hidden;"/>
	<object id="csrs1" type="image/X-arib-png" data="images/csr_left05.png" style="left:308px;top:50px;width:28px;height:28px;visibility:hidden;"/>
	<object id="csrs2" type="image/X-arib-png" data="images/csr_right05.png" style="left:624px;top:50px;width:28px;height:28px;visibility:hidden;"/>
	<object id="csrs3" type="image/X-arib-png" data="images/csr_right04.png" style="left:942px;top:52px;width:18px;height:23px;visibility:hidden;"/>
</div>
<div id="list" style="top:62px;width:960px;height:450px;visibility:hidden;">
	<object id="list_jpg" type="image/jpeg" data="images/noimage_02.jpg" style="left:83px;top:91px;width:240px;height:135px;visibility:hidden;"/>
	<object id="list0" type="image/X-arib-png" data="images/bt_alist01.png" style="left:382px;top:86px;width:474px;height:30px;visibility:hidden;"/>
	<object id="list1" type="image/X-arib-png" data="images/bt_alist02.png" style="left:382px;top:116px;width:474px;height:30px;visibility:hidden;"/>
	<object id="list2" type="image/X-arib-png" data="images/bt_alist03.png" style="left:382px;top:146px;width:474px;height:30px;visibility:hidden;"/>
	<object id="list3" type="image/X-arib-png" data="images/bt_alist04.png" style="left:382px;top:176px;width:474px;height:30px;visibility:hidden;"/>
	<object id="list4" type="image/X-arib-png" data="images/bt_alist05.png" style="left:382px;top:206px;width:474px;height:30px;visibility:hidden;"/>
	<object id="list5" type="image/X-arib-png" data="images/bt_alist06.png" style="left:382px;top:236px;width:474px;height:30px;visibility:hidden;"/>
	<object id="list6" type="image/X-arib-png" data="images/bt_alist07.png" style="left:382px;top:266px;width:474px;height:30px;visibility:hidden;"/>
	<object id="list7" type="image/X-arib-png" data="images/bt_alist08.png" style="left:382px;top:296px;width:474px;height:30px;visibility:hidden;"/>
	<object id="list8" type="image/X-arib-png" data="images/bt_alist09.png" style="left:382px;top:326px;width:474px;height:30px;visibility:hidden;"/>
	<object id="bt_alist" type="image/X-arib-png" data="images/bt_alist-n.png" style="left:382px;top:86px;width:474px;height:30px;visibility:hidden;" onkeydown="listkey();"/>
	<object id="list_icon0" type="image/X-arib-png" data="images/icon_13.png" style="left:827px;top:90px;width:22px;height:22px;visibility:hidden;"/>
	<object id="list_icon1" type="image/X-arib-png" data="images/icon_13.png" style="left:827px;top:120px;width:22px;height:22px;visibility:hidden;"/>
	<object id="list_icon2" type="image/X-arib-png" data="images/icon_13.png" style="left:827px;top:150px;width:22px;height:22px;visibility:hidden;"/>
	<object id="list_icon3" type="image/X-arib-png" data="images/icon_13.png" style="left:827px;top:180px;width:22px;height:22px;visibility:hidden;"/>
	<object id="list_icon4" type="image/X-arib-png" data="images/icon_13.png" style="left:827px;top:210px;width:22px;height:22px;visibility:hidden;"/>
	<object id="list_icon5" type="image/X-arib-png" data="images/icon_13.png" style="left:827px;top:240px;width:22px;height:22px;visibility:hidden;"/>
	<object id="list_icon6" type="image/X-arib-png" data="images/icon_13.png" style="left:827px;top:270px;width:22px;height:22px;visibility:hidden;"/>
	<object id="list_icon7" type="image/X-arib-png" data="images/icon_13.png" style="left:827px;top:300px;width:22px;height:22px;visibility:hidden;"/>
	<object id="list_icon8" type="image/X-arib-png" data="images/icon_13.png" style="left:827px;top:330px;width:22px;height:22px;visibility:hidden;"/>
	<p id="list0t" class="alist" style="left:412px;top:91px;width:400px;height:20px;"><![CDATA[]]></p>
	<p id="list1t" class="alist" style="left:412px;top:121px;width:400px;height:20px;"><![CDATA[]]></p>
	<p id="list2t" class="alist" style="left:412px;top:151px;width:400px;height:20px;"><![CDATA[]]></p>
	<p id="list3t" class="alist" style="left:412px;top:181px;width:400px;height:20px;"><![CDATA[]]></p>
	<p id="list4t" class="alist" style="left:412px;top:211px;width:400px;height:20px;"><![CDATA[]]></p>
	<p id="list5t" class="alist" style="left:412px;top:241px;width:400px;height:20px;"><![CDATA[]]></p>
	<p id="list6t" class="alist" style="left:412px;top:271px;width:400px;height:20px;"><![CDATA[]]></p>
	<p id="list7t" class="alist" style="left:412px;top:301px;width:400px;height:20px;"><![CDATA[]]></p>
	<p id="list8t" class="alist" style="left:412px;top:331px;width:400px;height:20px;"><![CDATA[]]></p>
	<object id="page_prv01" type="image/X-arib-png" data="images/page_prv01.png" style="left:353px;top:89px;width:27px;height:264px;visibility:hidden;"/>
	<object id="page_nxt01" type="image/X-arib-png" data="images/page_nxt01.png" style="left:858px;top:89px;width:27px;height:264px;visibility:hidden;"/>
	<object id="csr_left01" type="image/X-arib-png" data="images/csr_left01.png" style="left:354px;top:209px;width:25px;height:25px;visibility:hidden;"/>
	<object id="csr_right01" type="image/X-arib-png" data="images/csr_right01.png" style="left:859px;top:209px;width:25px;height:25px;visibility:hidden;"/>
	<object id="value01" type="image/X-arib-png" data="images/value01.png" style="left:584px;top:379px;width:60px;height:14px;visibility:hidden;"/>
	<object id="value02" type="image/X-arib-png" data="images/value02.png" style="left:770px;top:379px;width:60px;height:14px;visibility:hidden;"/>
	<p id="value01t" style="font-size:16px;color-index:173;grayscale-color-index:15 160;text-align:center;left:648px;top:377px;width:112px;height:16px;"><![CDATA[]]></p>
	<p id="value02t" style="font-size:16px;color-index:173;grayscale-color-index:15 160;text-align:center;left:825px;top:377px;width:56px;height:16px;"><![CDATA[]]></p>
	<object id="guide_sort01" type="image/X-arib-png" data="images/guide_sort01.png" style="left:62px;top:420px;width:130px;height:22px;visibility:hidden;"/>
	<object id="guide_sort02" type="image/X-arib-png" data="images/guide_sort02.png" style="left:192px;top:420px;width:130px;height:22px;visibility:hidden;"/>
	<object id="guide_sort03" type="image/X-arib-png" data="images/guide_sort03.png" style="left:322px;top:420px;width:130px;height:22px;visibility:hidden;"/>
	<object id="guide_sort04" type="image/X-arib-png" data="images/guide_sort04.png" style="left:452px;top:420px;width:130px;height:22px;visibility:hidden;"/>
	<object id="guide_sort_f" type="image/X-arib-png" data="images/guide_sort_f.png" style="left:58px;top:416px;width:126px;height:29px;visibility:hidden;"/>
	<object id="bg_icon" type="image/X-arib-png" data="images/bg_icon.png" style="left:81px;top:335px;width:178px;height:22px;visibility:hidden;"/>
	<object id="ld_icon0" type="image/X-arib-png" data="images/icon_02.png" style="left:81px;top:335px;width:22px;height:22px;visibility:hidden;"/>
	<object id="ld_icon1" type="image/X-arib-png" data="images/icon_03.png" style="left:107px;top:335px;width:22px;height:22px;visibility:hidden;"/>
	<object id="ld_icon2" type="image/X-arib-png" data="images/icon_08.png" style="left:133px;top:335px;width:22px;height:22px;visibility:hidden;"/>
	<object id="ld_icon3" type="image/X-arib-png" data="images/icon_09.png" style="left:159px;top:335px;width:22px;height:22px;visibility:hidden;"/>
	<object id="ld_icon4" type="image/X-arib-png" data="images/icon_05.png" style="left:185px;top:335px;width:22px;height:22px;visibility:hidden;"/>
	<object id="ld_icon5" type="image/X-arib-png" data="images/icon_01.png" style="left:211px;top:335px;width:22px;height:22px;visibility:hidden;"/>
	<object id="ld_icon6" type="image/X-arib-png" data="images/icon_16.png" style="left:237px;top:335px;width:22px;height:22px;visibility:hidden;"/>
	<object id="ld_icon7" type="image/X-arib-png" data="images/icon_10.png" style="left:270px;top:335px;width:22px;height:22px;visibility:hidden;"/>
	<p id="ld_text0" style="font-size:20px;line-height:24px;color-index:173;grayscale-color-index:169 154;left:81px;top:233px;width:264px;height:94px;"><![CDATA[]]></p>
	<p id="ld_text1" style="font-size:16px;color-index:173;grayscale-color-index:169 154;left:293px;top:339px;width:56px;height:16px;"><![CDATA[]]></p>
	<p id="ld_text2" style="font-size:16px;color-index:15;grayscale-color-index:142 131;left:81px;top:364px;width:400px;height:32px;"><![CDATA[]]></p>
</div>
<div id="detail" style="top:62px;width:960px;height:406px;visibility:visible;">
	<object id="dt_jpg" type="image/jpeg" data="images/noimage_03.jpg" style="left:82px;top:90px;width:480px;height:270px;visibility:hidden;"/>
	<object id="btn0" type="image/X-arib-png" data="images/bt_buy.png" style="left:747px;top:90px;width:128px;height:48px;visibility:hidden;" onkeydown="detailkey();"/>
	<object id="bt_kist" type="image/X-arib-png" data="images/bt_kist.png" style="left:747px;top:143px;width:120px;height:32px;visibility:hidden;" onkeydown="detailkey();"/>
	<object id="btn1" type="image/X-arib-png" data="images/bt_plain01.png" style="left:747px;top:179px;width:128px;height:32px;visibility:hidden;" onkeydown="detailkey();"/>
	<object id="btn2" type="image/X-arib-png" data="images/bt_plain01.png" style="left:747px;top:209px;width:128px;height:32px;visibility:hidden;" onkeydown="detailkey();"/>
	<object id="btn3" type="image/X-arib-png" data="images/bt_plain01.png" style="left:747px;top:239px;width:128px;height:32px;visibility:hidden;" onkeydown="detailkey();"/>
	<object id="btn4" type="image/X-arib-png" data="images/bt_plain01.png" style="left:747px;top:269px;width:128px;height:32px;visibility:hidden;" onkeydown="detailkey();"/>
	<object id="btn5" type="image/X-arib-png" data="images/bt_plain01.png" style="left:747px;top:299px;width:128px;height:32px;visibility:hidden;" onkeydown="detailkey();"/>
	<object id="btn6" type="image/X-arib-png" data="images/bt_plain01.png" style="left:747px;top:329px;width:128px;height:32px;visibility:hidden;" onkeydown="detailkey();"/>
	<p id="bt_kistt" class="kist" style="left:811px;top:151px;width:48px;height:16px;"><![CDATA[]]></p>
	<p id="btn1t" class="dbtn" style="left:755px;top:187px;width:112px;height:16px;"><![CDATA[]]></p>
	<p id="btn2t" class="dbtn" style="left:755px;top:217px;width:112px;height:16px;"><![CDATA[]]></p>
	<p id="btn3t" class="dbtn" style="left:755px;top:247px;width:112px;height:16px;"><![CDATA[]]></p>
	<p id="btn4t" class="dbtn" style="left:755px;top:277px;width:112px;height:16px;"><![CDATA[]]></p>
	<p id="btn5t" class="dbtn" style="left:755px;top:307px;width:112px;height:16px;"><![CDATA[]]></p>
	<p id="btn6t" class="dbtn" style="left:755px;top:337px;width:112px;height:16px;"><![CDATA[]]></p>
	<object id="d_icon0" type="image/X-arib-png" data="images/icon_01.png" style="left:576px;top:93px;width:22px;height:22px;visibility:hidden;"/>
	<object id="d_icon1" type="image/X-arib-png" data="images/icon_02.png" style="left:600px;top:93px;width:22px;height:22px;visibility:hidden;"/>
	<object id="d_icon2" type="image/X-arib-png" data="images/icon_04.png" style="left:624px;top:93px;width:22px;height:22px;visibility:hidden;"/>
	<object id="d_icon3" type="image/X-arib-png" data="images/icon_05.png" style="left:648px;top:93px;width:22px;height:22px;visibility:hidden;"/>
	<object id="d_icon4" type="image/X-arib-png" data="images/icon_08.png" style="left:672px;top:93px;width:22px;height:22px;visibility:hidden;"/>
	<object id="d_icon5" type="image/X-arib-png" data="images/icon_09.png" style="left:696px;top:93px;width:22px;height:22px;visibility:hidden;"/>
	<object id="d_icon6" type="image/X-arib-png" data="images/icon_13.png" style="left:720px;top:93px;width:22px;height:22px;visibility:hidden;"/>
	<object id="d_icon7" type="image/X-arib-png" data="images/icon_10.png" style="left:576px;top:117px;width:22px;height:22px;visibility:hidden;"/>
	<p id="d_synopsys" style="font-size:20px;line-height:24px;color-index:173;grayscale-color-index:169 154;left:581px;top:143px;width:160px;height:240px;"><![CDATA[]]></p>
	<p id="d_period" style="font-size:16px;color-index:173;grayscale-color-index:15 161;left:600px;top:120px;width:56px;height:16px;"><![CDATA[]]></p>
	<p id="d_copyright" style="font-size:16px;color-index:15;grayscale-color-index:142 131;left:80px;top:364px;width:400px;height:32px;"><![CDATA[]]></p>
</div>

<div id="buybox" style="left:180px;top:118px;width:600px;height:310px;visibility:hidden;">
	<object id="bg_popup" type="image/X-arib-png" data="images/bg_popup.png" style="width:600px;height:310px;"/>
	<object id="bg_puttl" type="image/X-arib-png" data="images/bg_puttl.png" style="left:27px;top:26px;width:546px;height:24px;"/>
	<object id="terms" type="image/X-arib-png" data="images/bg_terms.png" style="left:27px;top:26px;width:546px;height:212px;visibility:hidden;"/>
	<object id="bt_pulist0" type="image/X-arib-png" data="images/bt_pulist.png" style="left:23px;top:140px;width:554px;height:30px; visibility:hidden;" onkeydown="buykey();"/>
	<object id="bt_pulist1" type="image/X-arib-png" data="images/bt_pulist.png" style="left:23px;top:170px;width:554px;height:30px; visibility:hidden;" onkeydown="buykey();"/>
	<object id="bt_0" type="image/X-arib-png" data="images/bt_2.png" style="left:222px;top:239px;width:156px;height:36px; visibility:hidden;" onkeydown="buykey();"/>
	<object id="bt_1" type="image/X-arib-png" data="images/bt_2.png" style="left:137px;top:239px;width:156px;height:36px; visibility:hidden;" onkeydown="buykey();"/>
	<object id="bt_2" type="image/X-arib-png" data="images/bt_2.png" style="left:307px;top:239px;width:156px;height:36px; visibility:hidden;" onkeydown="buykey();"/>
	<object id="bt_linecode" type="image/X-arib-png" data="images/bt_linecode-f.png" style="left:175px;top:168px;width:250px;height:55px; visibility:hidden;" onkeydown="buykey();"/>

	<p id="buybox_title" style="left:40px;top:28px;width:520px;height:20px;font-size:20px;color-index:7;grayscale-color-index:171 163;text-align:center;"><![CDATA[]]></p>
	<p id="buybox_msg0" style="left:40px;top:60px;width:520px;height:96px;font-size:20px;color-index:173;grayscale-color-index:169 154;text-align:center;line-height:24px;"><![CDATA[]]></p>
	<p id="buybox_msg1" style="left:40px;top:58px;width:520px;height:168px;font-size:20px;color-index:173;grayscale-color-index:169 154;text-align:center;line-height:24px;"><![CDATA[]]></p>
	<p id="bt_pulist0pt" style="left:30px;top:145px;width:260px;height:20px;font-size:20px;color-index:7;grayscale-color-index:171 167;"><![CDATA[]]></p>
	<p id="bt_pulist1pt" style="left:30px;top:175px;width:260px;height:20px;font-size:20px;color-index:7;grayscale-color-index:171 167;"><![CDATA[]]></p>
	<p id="bt_pulist0kt" style="left:300px;top:145px;width:260px;height:20px;font-size:20px;color-index:7;grayscale-color-index:171 167;"><![CDATA[]]></p>
	<p id="bt_pulist1kt" style="left:300px;top:175px;width:260px;height:20px;font-size:20px;color-index:7;grayscale-color-index:171 167;"><![CDATA[]]></p>
	<p id="bt_0t" class="pbtn" style="left:230px;top:247px;width:140px;height:20px;text-align:center;"><![CDATA[]]></p>
	<p id="bt_1t" class="pbtn" style="left:145px;top:247px;width:140px;height:20px;text-align:center;"><![CDATA[]]></p>
	<p id="bt_2t" class="pbtn" style="left:315px;top:247px;width:140px;height:20px;text-align:center;"><![CDATA[]]></p>
	<p id="bt_linecodet" style="left:252px;top:185px;width:96px;height:24px;font-size:24px;color-index:0;grayscale-color-index:156 170;text-align:center;"><![CDATA[]]></p>
	<p id="termst" style="left:44px;top: 62px;width:515px;height:140px;font-size:16px;line-height:20px;color-index:173;grayscale-color-index:169 154;"><![CDATA[]]></p>
	<p id="termspt" style="left:44px;top:218px;width:448px;height:16px;font-size:16px;color-index:173;grayscale-color-index:173 170;"><![CDATA[]]></p>
	<p id="termsp" style="left:508px;top:218px;width:48px;height:16px;font-size:16px;color-index:173;grayscale-color-index:173 170;text-align:right;"><![CDATA[]]></p>
</div>
<div id="pop" style="left:180px;top:118px;width:600px;height:310px;visibility:hidden;">
	<object type="image/X-arib-png" data="images/bg_popup.png" style="width:600px;height:310px;"/>
	<object id="titBase" type="image/X-arib-png" data="images/bg_puttl.png" style="left:27px;top:26px;width:546px;height:24px;"/>
	<object id="pbtn0" type="image/X-arib-png" data="images/bt_2.png" style="top:239px;width:156px;height:36px;visibility:hidden;" onkeydown="popkey();"/>
	<object id="pbtn1" type="image/X-arib-png" data="images/bt_2.png" style="top:239px;width:156px;height:36px;visibility:hidden;" onkeydown="popkey();"/>
	<object id="pbtn2" type="image/X-arib-png" data="images/bt_2.png" style="top:239px;width:156px;height:36px;visibility:hidden;" onkeydown="popkey();"/>
	<p id="ptitle" style="left:40px;top:28px;width:520px;height:20px;font-size:20px;color-index:7;grayscale-color-index:171 163;text-align:center;"><![CDATA[]]></p>
	<p id="ptext" style="left:40px;top:60px;width:520px;height:168px;font-size:20px;line-height:24px;color-index:173;grayscale-color-index:169 154;text-align:center;"><![CDATA[]]></p>
	<p id="pbtn0t" class="pbtn" style="top:247px;width:140px;height:20px;"><![CDATA[]]></p>
	<p id="pbtn1t" class="pbtn" style="top:247px;width:140px;height:20px;"><![CDATA[]]></p>
	<p id="pbtn2t" class="pbtn" style="top:247px;width:140px;height:20px;"><![CDATA[]]></p>
</div>
<div id="default" style="width:2px;height:2px;nav-index:0;" onkeydown="dummyFocus();"/>
<div id="loading2" style="left:290px;top:233px;width:380px;height:74px;">
	<object type="image/X-arib-png" data="images/load2.png" style="width:380px;height:74px;"/>
</div>
</body>
</bml>
